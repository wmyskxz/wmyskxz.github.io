<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#3.0.0-rc.1'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
      <meta name="robots" content="noindex,follow">
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>归档：2019/6 - 我没有三颗心脏的博客</title>
  

  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  

  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
    
      
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-light.css">

    
  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  
  
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body>
  
  
  
  <div class="cover-wrapper">
    <cover class='cover ' style="display: none;">
      <div class='cover-body'>
  <div class='a'>
    
    
      <p class="title">我没有三颗心脏</p>
    
    
      <p class="subtitle">分享知识&技术&成长&思考</p>
    
  </div>
  <div class='b'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="search here..." />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation search'>
      <div class='list-h'>
        
          
            <a href="/"
              
              
              id="home">
              <i class='fas fa-rss fa-fw'></i><p>博客</p>
            </a>
          
            <a href="/categories/"
              
              
              id="categories">
              <i class='fas fa-folder-open fa-fw'></i><p>分类</p>
            </a>
          
            <a href="/tags/"
              
              
              id="tags">
              <i class='fas fa-tags fa-fw'></i><p>标签</p>
            </a>
          
            <a href="/archives/"
              
              
              id="archives">
              <i class='fas fa-archive fa-fw'></i><p>归档</p>
            </a>
          
            <a href="/about/"
              
              
              id="about">
              <i class='fas fa-info-circle fa-fw'></i><p>关于</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

      <div class="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
    </cover>
    <header class="l_header shadow blur">
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-NavBar@3x.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  </div>
  


  <div class="l_body">
    <div class='body-wrapper' id="pjax-container">
      
        <!--此文件用来存放一些不方便取值的变量--> 
<!--思路大概是将值藏到重加载的区域内--> 
 
 
 
<div id="pjax-data" style="display: none"> 
  <div id="pjax-ispage">false</div> 
  <div id="pjax-pageTitle"></div> 
  <div id="pjax-enable-cover">true</div> 
  <div id="pjax-comment-path">none</div> 
  <div id="pjax-comment-placeholder">none</div> 
</div> 
 
 
<script> 
  // 处理封面 此时 jquery 还没加载 
  if ("blog" == "none") { // 移除封面 
    document.getElementsByClassName('cover')[0].style.display = "none"; 
    document.getElementsByClassName('l_body')[0].classList.add("nocover"); 
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.add("show"); 
  } else { 
    if ("blog" == "blog") { // 半屏 
      document.getElementsByClassName('cover')[0].classList.remove("full"); 
      document.getElementsByClassName('cover')[0].classList.add("half"); 
      document.getElementsByClassName('scroll-down')[0].style.display = "none"; 
    } else if ("blog" == "docs") { // 全屏 
      document.getElementsByClassName('cover')[0].classList.remove("half"); 
      document.getElementsByClassName('cover')[0].classList.add("full"); 
      document.getElementsByClassName('scroll-down')[0].style.display = ""; 
    } 
    document.getElementsByClassName('cover')[0].style.display = ""; 
    document.getElementsByClassName('l_body', 'show')[0].classList.remove("nocover"); 
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.remove("show"); 
  } 
</script> 

      
      

<div class='l_main'>
	
		
  <section class="post-list ">
    
      
        
          
        
          
        
          
        
          
        
          
        
          
        
      
    
    
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2019/06/13/tu-xie-tui-jian-ling-yu-qu-dong-she-ji-xue-xi-shu-chu/">
      【吐血推荐】领域驱动设计学习输出
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>学习笔记</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2019年6月13日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-19dda0f538f5c90c.png" alt=""></p>
<h1 id="一、Hello-DDD"><a href="#一、Hello-DDD" class="headerlink" title="一、Hello DDD"></a>一、Hello DDD</h1><hr>
<p>刚开始接触学习<strong>「DDD - 领域驱动」</strong>的时候，我被各种新颖的概念所吸引：「领域」、「领域驱动」、「子域」、「聚合」、「聚合根」、「值对象」、「通用语言」…..总之一大堆有关的、无关的概念从我的脑海经过，其中不乏让我陷入思考的地方，我原以为我会很开心地 <em>“享用”</em> 这些新知识带给我的营养（参照下图）</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-a7db610ac865f917.gif" alt=""></p>
<p>可事实上，我为学习<strong>「DDD - 领域驱动」</strong>付出了很多的精力，我尝试用「DDD CRUD」、「DDD vs CRUD」、「Domain-Driven Design」、「DDD CQRS」、「领域驱动设计」等等一系列的关键字搜集我想要的资料<em>（翻遍了 Google 前排的所有文章&amp;手动感谢谷歌让我能获得一些精彩的文章）</em>，可似乎都不太近人意，一方面这个「新概念」我对它的困惑太多了，另一方面真正「落地」并实践起来的经验有很少是可以直接借鉴的，再结合一些实际的场景（没有人解答），我感到更加困惑。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-951d48e4bd0c1804.png" alt=""></p>
<h2 id="传统开发面临的问题"><a href="#传统开发面临的问题" class="headerlink" title="传统开发面临的问题"></a>传统开发面临的问题</h2><p>我们先来讨论一下传统开发面临的一些问题吧，就先从传统开发中被广泛应用于 Web 开发的传统三层框架：「MVC」 开始说起吧。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-a43a3e25fe7b0ec5.png" alt=""></p>
<ul>
<li>图片来源：<a href="https://draveness.me/mvx" target="_blank" rel="noopener">https://draveness.me/mvx</a></li>
</ul>
<p>传统的「MVC」模型把框架分成了三层：显示层、控制层、模型层，而传统的模型层又被拆分成了业务层（Service）和数据访问层（DAO,Data Access Object）。</p>
<p>显示层负责显示用户界面、控制层负责处理业务逻辑、而模型则负责与数据库通信，对数据进行持久化的操作。这样的结构不仅结构松散，而且各个模块职责分离，有什么问题呢？</p>
<p>让我们来看一个实际的例子吧。</p>
<p>假设我们做了一个会议室预定系统，我们的一个设备坏了。我们需要通知预定这个会议室的所有人，于是我们需要发邮件，伪代码如下：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EquipmentServiceImpl</span> <span class="token keyword">implements</span> <span class="token class-name">EquipmentService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Autowired</span> <span class="token keyword">private</span> EmailService emailService<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Autowired</span> <span class="token keyword">private</span> EquipmentRepository equipmentRepository<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEquipmentBroken</span><span class="token punctuation">(</span>Long id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Equipment equipment <span class="token operator">=</span> equipmentRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
        equipment<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span>Equipment<span class="token punctuation">.</span>StatusEnum<span class="token punctuation">.</span>BROKEN<span class="token punctuation">)</span><span class="token punctuation">;</span>

        emailService<span class="token punctuation">.</span><span class="token function">sendEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>问题来了，如果我们后来发现设备坏了并且需要更改可用库存的数量，这时候我们是不是要在这里加入 <code>InventoryService</code> 库存服务的代码呢？后来如果经理说设备坏了应该通知他才对啊，所以我们要不要加入 <code>emailService.sendEmailTo(Manager)</code> 这样的代码呢？</p>
<p>就算不考虑职责单一原则和关注分离原则，程序员也会疯掉的，这样做 <strong>Service 太重了</strong>，并且糟糕的是它可能还不止考虑这些，还有权限、事务等等一系列的事情等着 Service 层去做，如此产生了大量的依赖和循环依赖，当业务复杂度上升时，直接导致了服务层所含的代码过于庞大和复杂、测试成本直线上升，并且各个 <strong>Service 的逻辑散落在各处，维护的成本也非常大。</strong></p>
<p>我相信很多公司正在经历这样的事情，并且问题还远不止于此。</p>
<p>最近我就经历过另一种问题。作为实习生刚入公司的我接到产品了一个需求，虽然有正规的需求文档可以供我阅读，但对于业务还不熟悉的我读起来就感觉是：摁，我想要这个页面这样。</p>
<p>当产品经历耐心的过来给我解释的时候，我仍然感到无奈，因为他尽可能详细地在描述他想要在哪一个页面的哪一个地方加上什么东西的同时，我看着眼前屏幕上的一堆模型和代码，感到无从下手，只能找来大佬帮忙充当一下 “翻译”。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-ccf30547eff91150.png" alt=""></p>
<p>必须承认自己对业务的生疏是主要的原因，但根本原因还是：<strong>开发与产品之间的「沟通」不能保持一致，双方对于同一事物的「表达和理解」有很大的区别。</strong>产品看到的是实际的「业务场景」，而开发则更关注背后的「实现逻辑」。</p>
<h2 id="CRUD-的各种问题"><a href="#CRUD-的各种问题" class="headerlink" title="CRUD 的各种问题"></a>CRUD 的各种问题</h2><p>上面或许有说得不对的地方，但这样的现象确实的存在。（例如我审视了一下我之前写过的代码，突然感慨幸好自己之前都是独立开发且功能简单，嘻嘻嘻）</p>
<p>另一个想要讨论的问题是关于后端开发者常常拿来自嘲的<strong>「CRUD」</strong>。经常有开发人员苦着脸说：每天除了写「BUG」，就一直在写「CRUD」代码，没有很大长进。当然这只是一种自嘲，但可能写「BUG」是真的，也可能没有长进是真的，当然两个都可能都是真的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-79b7e120129a23bc.png" alt=""></p>
<p><strong>「CRUD」</strong> 其实对应的是数据库中的增删改查的操作。现实的情况中，只有极少有企业不用到数据库，数据库就像是现代软件开发的一剂灵丹妙药，不仅提供可靠、快速、大容量的存储服务，还支持强大的事务管理机制，满足了大部分场景中对数据的一致性需求。</p>
<p>数据库如此的强大，以至于我们从接触软件开发开始就一直使用「CRUD」的模式进行开发。我们的「潜意识」中就形成了<strong>「以数据为中心」</strong>的开发模式，这没有什么不好，并且大多数情况下是适用的，这里只是讨论：<strong>「CRUD」有什么问题？</strong></p>
<h3 id="问题一：面向对象和数据库天然阻抗"><a href="#问题一：面向对象和数据库天然阻抗" class="headerlink" title="问题一：面向对象和数据库天然阻抗"></a>问题一：面向对象和数据库天然阻抗</h3><p>面向对象编程的语言和数据库都是我们几乎“最熟悉”的东西了，我们甚至使用他们编织出了绝大多数复杂多样的网络应用，为什么说它们之间存在着天然阻抗？</p>
<p>当然我觉得这里有一点「强行找不同」的味道，但也不失为一种思考和讨论。并且我觉得还是有点道理的。</p>
<p><strong>A1：对象和关系数据库累赘转换</strong></p>
<p>在一个面向对象的系统中，对象是数据的承载方式，每一个 DAO 对象都对应着关系数据库中的一条数据。</p>
<p>但通常视图层只显示完整实体对象的一小部分数据，那么其余的「无关数据」你准备怎么处理呢？</p>
<ul>
<li>是否要把对象中包含的「所有数据」一起返回给视图层？</li>
<li>是否需要创建一个新的专用的「数据传输对象」？</li>
<li>或者你想直接把「无关数据」字段设置成 <code>null</code>？</li>
</ul>
<p>显然，在绝大多数应用中都采取了第二种方案，于是我们看到各种冗余、繁多的「传输层对象」，随着时间的推移，系统中堆积的「传输层对象」越来越多，不仅增加了系统的「复杂度」，而且还降低了我们的「开发效率」。我猜这也是人们说 Java 复杂的一方面原因吧。</p>
<p>更重要的是，万一有一个字段发生变化，更改量就很大。（当然这也有解决方案）</p>
<p><strong>A2：继承关系的尴尬实现</strong></p>
<p>继承是面向对象的一个重要特性，而关系数据库却难以复现对象世界中的继承关系。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-c4b44d5e9200ca97.png" alt=""></p>
<p>我们来试着还原一下上面的继承关系吧。</p>
<p>如果我们按照把 <code>Student</code> 和 <code>Professor</code> 建成两张表，问题就是：<strong>关系数据库分割了两个对象的共性 <code>Person</code>。</strong>从语义上说：也就是将一个对象分割成两个部分了；而且当你要获取这个对象时，需要两次Select。同样道理增删改查都要两次。</p>
<p>如果我们把 <code>Student</code> 和 <code>Professor</code> 合并成一张表，问题就是：<strong>会产生许多空白字段。</strong>这很容易理解。</p>
<p>这些都反映了面向对象和关系数据库天然不匹配，只能一方作出妥协，并且大部分情况是面相对象作出妥协。</p>
<p><strong>A3：类的复杂关系实现</strong></p>
<p>当我们需要创建一个部门（Department），而一个部门将拥有多个教授（Professor）这样一个模型的时候，我们发现面向对象和关系数据库「表达方式」的是两种不同的形式：</p>
<ul>
<li>面向对象：<br>我是一个部门，在我里面有很多的教授；</li>
<li>关系数据库，由于外键会在 Professor 上：<br>我是一个教授，我属于那个部门。</li>
</ul>
<h3 id="问题二：是一种数据模型，与业务脱节"><a href="#问题二：是一种数据模型，与业务脱节" class="headerlink" title="问题二：是一种数据模型，与业务脱节"></a>问题二：是一种数据模型，与业务脱节</h3><p>没有一个「真实的人」会在支付一笔订单的时候说：（大概意思..）</p>
<p>=&gt; 先通过我这个订单的编号找到原始在系统上的记录；<br>=&gt; 把支付金额改成我实际支付的金额；<br>=&gt; 把这个订单的状态修改成已支付<br>=&gt; ……..</p>
<p>而一个「真实的人」会直接说：我为这笔订单付了xxx钱。</p>
<p>关系型数据库（Relational Database）的核心实体就是数据表，核心操作就是在定义好的数据表上的「CRUD」操作。这套东西实在是太好用了，也太深入人心了，以至于你能在好多地方都能看到这种将<strong>关系模式直接用作业务模式</strong>的系统：</p>
<p>比如我之前写的所有东西。（就拿我写的个人博客为例吧：<a href="https://github.com/wmyskxz/MyBlog" target="_blank" rel="noopener">https://github.com/wmyskxz/MyBlog</a>）</p>
<p>问题出在：我的「Entity层」只是数据库表结构的一种映射用于承载数据，我的「DAO层」只是封装了对「Entity层」的增删改查，我的「Controller层」只是简单的把地址和对应「Service层」的对应方法做了关联返回结果给「视图层」，而我的「Service层」则大部分工作也只是在做一些「查询」、「拼接数据」的工作，<strong>这样的系统是声称套上了业务的外衣，而实则只是「皇帝的新衣」，几乎无法保证业务逻辑的正确性、完整性。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-4b7a0fb015946040.png" alt=""></p>
<p>我还记得朋友问过我一个问题，大意就是有一部分的系统其实只是对数据库的简单封装，感觉就像是系统只是数据库的「简单代理」一样。我一开始有点儿感同身受，但现在回过头想，只是我们当时做的东西太简单了而已。简单的系统也就是对数据库的「CRUD」。</p>
<p>但这还不是重点，<strong>重点是大部分的「CRUD工程师」对「业务理解」出了问题。</strong></p>
<p>让我们拿国际象棋举个例子：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-e5ff8c684db798b5.png" alt=""></p>
<ul>
<li>图片引自：<a href="https://zhuanlan.zhihu.com/p/25442175" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25442175</a></li>
</ul>
<p>作为一枚「CRUD工程师」，在完成了左边部分的数据库设计和右边的数据展现之后，往往就认为已经万事大吉了。但这样的产品交付之后，对现实中使用它的用户提出了很多的潜在要求。「CRUD工程师」从来不会提示你这些潜在需求，谁会对自己并不知道的事情加以说明呢？</p>
<p>简而言之，这样的一个国际象棋程序，自身对国际象棋规则完全是一窍不通的。就是拿出个表格给你，随你填成啥样。在这件事情上，完全指望使用者不犯错，这是何等的心大！</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-fce81976500bb9a7.png" alt=""></p>
<ul>
<li>图片引自：<a href="https://zhuanlan.zhihu.com/p/25442175" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25442175</a></li>
</ul>
<p>于是，这个国际象棋程序完全有可能出现 <strong>Bad case</strong> 的这种诡异情况：黑色骑士（knight）走出一个华丽的斜线，和其中一个白色兵（pawn）共处一室（什么鬼？！）「国际象棋填表系统」并不会阻止你这样做，因为它并没有正确与错误之分。</p>
<p>这时候，「CRUD工程师」被客户、老板抓出来收拾残局了。经过一番调研，原来客户是想把黑色骑士走到 6d，并吃掉（capture）另一个白色兵。“产品已经够简单的了，客户怎么都这么蠢？”「CRUD工程师」嘀咕道，“哎，这工作坑真是多啊”。</p>
<ul>
<li>原片段摘自：<a href="https://zhuanlan.zhihu.com/p/25442175" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25442175</a></li>
</ul>
<h3 id="问题三：CRUD-缺少意图（intent）"><a href="#问题三：CRUD-缺少意图（intent）" class="headerlink" title="问题三：CRUD 缺少意图（intent）"></a>问题三：CRUD 缺少意图（intent）</h3><p>事实上我们可以使用「CRUD」架构很好的服务绝大多数的应用。但是正如上面提到的问题所说的那样，当系统的「复杂度」上升的时候，<strong>「CRUD」可能会缺少一件事：意图（intent）。</strong></p>
<p>例如：</p>
<p>我们想要改变一个 Customer 的地址，在「CRUD」体系中，我们只需要发出更新语句就能实现。<strong>但是我们无法弄清楚这种变化是由不正确的操作引起的，还是客户真的转移到了另一个城市。</strong>也许我们有一个业务场景，需要再重新定位时触发对外部系统的通知。在这种情况下，「CRUD」显得有所缺失。</p>
<h3 id="问题四：实施协作“困难”"><a href="#问题四：实施协作“困难”" class="headerlink" title="问题四：实施协作“困难”"></a>问题四：实施协作“困难”</h3><p>在大多数的「CRUD」应用中，最新的更改将覆盖其他用户并行执行的其他更改。也就是说如果一个团队中的两个人同时对同一个文件的同一行进行修改，那么合并代码的时候就会产生「冲突」。</p>
<p>在上面我们论述了在传统「CRUD」这样的矛盾是如何产生的：散落在各处分散的逻辑代码。</p>
<h3 id="问题五：被人诟病的「U」"><a href="#问题五：被人诟病的「U」" class="headerlink" title="问题五：被人诟病的「U」"></a>问题五：被人诟病的「U」</h3><p>「CRUD」中的「U」指的是「更新」操作。通常在我们的系统中「U」作为一种通用的方法可以更新资源的任何字段，然后使用新版本覆盖掉旧版本。</p>
<p>并且现在由于「REST」的流行，大多数的「API」都是围绕「资源模型」来进行「CRUD」操作的，这样做不仅确实极大地方便了开发人员的工作，并且借由「HTTP动词」和「资源URI」结合起来有很好的可读性。</p>
<p>但这有什么问题呢？</p>
<p>我们考虑一个简单的「银行账户」资源的问题。当我们需要把账户的余额更新为想要的数量的时候，我们应该允许客户端直接调用更新方法吗？任何余额调整的动作都应该作为某种类型的交易事务被记录下来才对，例如「充值」、「取钱」，还是「转账」？另外账户是否存在？可能变更吗？等等一系列问题都可能使你的通用「U」变得臃肿难以维护。</p>
<p>基于上述的多种多样的「场景」，我们的通用「U」方法被推向了尴尬的境地。事实上这可能属于设计的问题，不知道一般的公司中是如何解决的，至少在我之前写的代码中，我是这样实现的。（并且可能觉得没有什么问题）</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-21dd9bfce6f20059.png" alt=""></p>
<p>另外也有的人说「CRUD」限制了描述业务的语言的问题。因为增删改查只有四个动词，而我们实际的业务场景可能更加复杂。</p>
<h3 id="问题六：提供变更历史记录的操作很复杂"><a href="#问题六：提供变更历史记录的操作很复杂" class="headerlink" title="问题六：提供变更历史记录的操作很复杂"></a>问题六：提供变更历史记录的操作很复杂</h3><p>还有一个问题：「CRUD」会丢失应用程序的历史记录。例如，如果用户在一段时间内多次变更记录，我们则无法再跟踪单个更改。更糟糕的是，甚至无法确定该条目是否曾经被改变过。</p>
<p>当然，这可以通过为最后更新的时间戳添加字段来处理，但这只会帮助我们能够获得最新的更新。如果你对整个历史感兴趣，事情就会变得复杂：你必须从一开始就额外引入一组字段or一张新表。</p>
<p>这里的问题是：由于你不知道将来会询问哪些关于你数据的问题，因此你无法针对相应的情况对表做出优化。因为你收集太多或者太少的数据，似乎都存在一定问题。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>现在早已经不再是 PC Web 的时代了，原生 APP、移动 Web 等等多种客户端技术在近几年爆发（IOS、Android、JavaScript、…），青出于蓝而胜于蓝。原先「MVC」中的视图（Web页面）渲染工作，面临被新技术的完全替代。「CRUD工程师」手中的系统们，面临向「SOA」的转型。</p>
<p>夜深人静，四下无人的时候，「CRUD工程师」再次陷入深深的困惑：一边是臃肿不堪的模型和控制器层，另一边是逐渐收缩和服务化的视图层，难道建表、写表、读表就要成为我的唯一主题了吗？</p>
<p>「CRUD工程师」认为自己没有创造任何东西，他们只是数据库表的搬运工。而如果不是「CRUD」，业务系统后端工程师的价值在哪里？</p>
<p><strong>理解并抽象出业务逻辑，建立满足需求的业务模型，以此设计实现出可靠的系统，并有效地控制复杂性。</strong>这才是大部分业务系统后端工程师的工作重点，也是解决他们工作中遇到的问题和难点的关键。</p>
<ul>
<li>观点来自：<a href="https://zhuanlan.zhihu.com/p/25442175" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25442175</a></li>
</ul>
<p>爱因斯坦说：“如果给我 1 个小时解答一道决定我生死的问题，我会花 55 分钟来弄清楚这道题到底是在问什么。一旦清楚了它到底在问什么，剩下的 5 分钟足够回答这个问题。”</p>
<p>虽然目前为止我们还不太了解「DDD」是如何帮助我们解决传统开发中的各种问题，但是听说「DDD - 领域驱动设计」似乎是能够用来设计和实现业务逻辑的一剂良药。</p>
<p>所以<strong>「Hello - DDD」</strong>。</p>
<h1 id="二、DDD-是什么？"><a href="#二、DDD-是什么？" class="headerlink" title="二、DDD 是什么？"></a>二、DDD 是什么？</h1><hr>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-3cde57d290206fce.png" alt=""></p>
<p>「DDD」的全称是「Domain-driven Design」，即「领域驱动设计」。是由「Eric Evans」最早提出的综合软件系统分析和设计的面向对象建模方法，如今已经发展为一种针对大型复杂系统的领域建模与分析方法。</p>
<p>它完全改变了传统软件开发工程师针对数据库进行的建模方法，从而<strong>将要解决的业务概念和业务规则转换为软件系统中的类型以及类型的属性与行为，通过合理运用面向对象的封装、继承、多态等设计要素，</strong>降低或隐藏整个系统的业务复杂性，并使得系统具有更好的扩展性，应对纷繁多变的现实业务问题。</p>
<ul>
<li><strong>总结：</strong> 目前为止，您只需要知道「DDD」是一种致力于降低或隐藏整个系统业务复杂性，让系统具有更好扩展，应对纷杂繁多的现实也问题的架构方法就行了。</li>
</ul>
<h2 id="DDD-简史"><a href="#DDD-简史" class="headerlink" title="DDD 简史"></a>DDD 简史</h2><p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-ed16840d6b42a368.png" alt=""></p>
<ul>
<li>图片引自：<a href="https://www.jianshu.com/p/e1b32a5ee91c" target="_blank" rel="noopener">https://www.jianshu.com/p/e1b32a5ee91c</a></li>
</ul>
<p>领域驱动设计这个概念出现在 2003 年，那个时候的软件还处在从 CS 到 BS 转换的时期，敏捷宣言也才发表 2 年。但是「Eric Evans」作为在企业级应用工作多年的技术顾问，敏锐的发现了在软件开发业界内（尤其是企业级应用）开始涌现的一股思潮，他把这股思潮称为领域驱动设计，同时还出版了一本书，在书中分享了自己在设计软件项目时采用的建模方法，并为设计决策者提供了一个框架。</p>
<p>但是从那以后「DDD」并没有和「敏捷」一样变得更加流行，如果要问原因，我觉得一方面是这套方法里面有很多的新名词新概念，比如说「聚合」，「限界上下文」，「值对象」等等，要理解这些抽象概念本身就比较困难，所以学习和应用「DDD」的曲线是非常陡峭的。另一方面，做为当时唯一的“官方教材”《领域驱动设计》，阅读这本书是一个非常痛苦的过程，在内容组织上经常会出现跳跃，所以很多人都是刚读了几页就放下了。</p>
<p>虽然入门门槛有些高，但是对于喜欢智力挑战的软件工程师们来说，这就是一个难度稍为有一点高的玩具，所以在小范围群体内，逐渐有一批人开始能够掌控这个玩具，并且可以用它来指导设计能够控制业务复杂性的软件应用出来了。虽然那时候大部分的软件应用都是单体的，但是使用「DDD」依然可以设计出来容易维护而且快速响应需求变化的单体应用出来。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-e72138fae7c0647f.png" alt=""></p>
<p>到了 2013 年，随着各种分布式的基础设施逐渐成熟，而「SOA架构」应用在实践中又不是那么顺利，Martin Fowler 和 James Lewis 把当时出现的一种新型分布式架构风潮总结成<strong>微服务架构</strong>。</p>
<p>然后微服务这股风就呼呼的吹了起来，这时候软件工程师们发现一个问题，就是虽然指导微服务架构的应用具有什么特征，但是如何把原来的大单体拆分成微服务是完全不知道怎么做了。</p>
<p>然后熟悉「DDD」方法的工程师发现，由于「DDD」可以有效的从业务视角对软件系统进行拆解，并且「DDD」特别契合微服务的一个特征：<strong>围绕业务能力构建。</strong>所以用「DDD」拆分出来的微服务是比较合理的而且能够实现高内聚低耦合，这样接着微服务「DDD」迎来了它的第二春。</p>
<h2 id="DDD-思辨"><a href="#DDD-思辨" class="headerlink" title="DDD 思辨"></a>DDD 思辨</h2><p>从计算机发明以来，人类用过表达世界变化的词有：电子化，信息化，数字化。这些词里面都有一个 “化” 字，代表着转变，而这些转变就是人类在逐渐的把原来在物理世界中的一个个概念一个个工作，迁移到虚拟的计算机世界。</p>
<p>但是在转变的过程中，由于两个世界的底层逻辑以及底层语言不一致，就必须要有一个翻译和设计的过程。这个翻译过程从软件诞生的第一天起就天然存在，而由于有了这个翻译过程，业务和开发之间才总是想两个对立的阶级一样，觉得对方是难以沟通的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-fed8d5183efb82be.png" alt=""></p>
<p>于是乎有些软件工程界的大牛就开始思考，能不能有一种方式来减轻这个翻译过程呢。然后就发明了<strong>「面向对象语言」</strong>，开始尝试让计算机世界有物理世界的对象概念。面向对象还不够，这就有了<strong>「DDD」</strong>，「DDD」定义了一些基本概念，然后尝试让业务和开发都能够理解这些概念名词，然后让「领域专家」（这里你可以理解为熟悉业务的人）使用这些概念名词来描述业务，而由于使用了规定的概念名词，开发就可以很好的理解领域业务，并能够按照领域业务设计的方式进行软件实现。</p>
<p><strong>这就是DDD的初衷：让业务架构绑定系统架构。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-074f2a0cf9af27ad.png" alt=""></p>
<p>后来发现这个方法不仅仅可以做好翻译，还可以帮助业务划分领域边界，可以明确哪个领域是自己的核心价值所在，以后应该重点发展哪个领域。甚至可以作为组织进行战略规划的参考。而能够做到这点，其实背后的原因是物理世界和虚拟世界的融合。</p>
<h1 id="三、为什么使用-DDD？"><a href="#三、为什么使用-DDD？" class="headerlink" title="三、为什么使用 DDD？"></a>三、为什么使用 DDD？</h1><hr>
<h2 id="DDD-帮助解决微服务拆分困境"><a href="#DDD-帮助解决微服务拆分困境" class="headerlink" title="DDD 帮助解决微服务拆分困境"></a>DDD 帮助解决微服务拆分困境</h2><p>上面介绍了使用DDD可以做到绑定业务架构和系统架构，这种绑定对于微服务来说有什么关系呢。所谓的微服务拆分困难，其实<strong>根本原因是不知道边界在什么地方。</strong>而使用DDD对业务分析的时候，首先会使用<strong>「聚合」</strong>这个概念把<strong>关联性强的业务概念划分在一个边界下</strong>，并限定「聚合」和「聚合」之间只能通过<strong>「聚合根」</strong>来访问，这是<strong>第一层边界。</strong></p>
<p>然后在<strong>「聚合」</strong>基础之上根据<strong>「业务相关性」</strong>、<strong>「业务变化频率」</strong>、<strong>「组织结构」</strong>等等约束条件来定义<strong>「限界上下文」</strong>，这是<strong>第二层边界。</strong>有了这两层边界作为约束和限制，微服务的边界也就清晰了，拆分微服务也就不再困难了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-dbcf1008e2c507fc.png" alt=""></p>
<h2 id="DDD-帮助应对系统复杂性"><a href="#DDD-帮助应对系统复杂性" class="headerlink" title="DDD 帮助应对系统复杂性"></a>DDD 帮助应对系统复杂性</h2><p>解决复杂和大规模软件的武器可以被粗略地归为三类：「抽象」、「分治」和「知识」。</p>
<ul>
<li><p><strong>分治：</strong> 把问题空间分割为规模更小且易于处理的若干子问题。分割后的问题需要足够小，以便一个人单枪匹马就能够解决他们；其次，必须考虑如何将分割后的各个部分装配为整体。分割得越合理越易于理解，在装配成整体时，所需跟踪的细节也就越少。即更容易设计各部分的协作方式。评判什么是分治得好，即高内聚低耦合。</p>
</li>
<li><p><strong>抽象：</strong> 使用抽象能够精简问题空间，而且问题越小越容易理解。举个例子，从北京到上海出差，可以先理解为使用交通工具前往，但不需要一开始就想清楚到底是高铁还是飞机，以及乘坐它们需要注意什么。</p>
</li>
<li><p><strong>知识：</strong> 顾名思义，「DDD」可以认为是知识的一种。</p>
</li>
</ul>
<p>「DDD」提供了这样的知识手段，让我们知道如何抽象出「限界上下文」以及如何去「分治」。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-2637ede9fbab8b87.png" alt=""></p>
<ul>
<li>图片来源：<a href="https://servicecomb.apache.org/cn/docs/crm-part-I/" target="_blank" rel="noopener">https://servicecomb.apache.org/cn/docs/crm-part-I/</a></li>
</ul>
<p>另外一个感受就是我们可以使用<strong>「领域事件」</strong>来应对多样的变化。参考上面提到发邮件的例子，我们可以把它改造成这样：</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setEquipmentBroken</span><span class="token punctuation">(</span>Long id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    Equipment equipment <span class="token operator">=</span> equipmentRepository<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    equipment<span class="token punctuation">.</span><span class="token function">broken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    eventBus<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EquipmentBrokenEvent</span><span class="token punctuation">(</span>equipment<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>这样，通知会议室预订者的模块就会去通知相应的人员，而不用我们自己操心了。</p>
<p><strong>更为重要的是，「DDD」架构区别于传统的方式。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-0e67eae3bac2643d.png" alt=""></p>
<ul>
<li>图片引自：<a href="https://blog.pragmatists.com/domain-driven-design-vs-anemic-model-how-do-they-differ-ffdee9371a86" target="_blank" rel="noopener">https://blog.pragmatists.com/domain-driven-design-vs-anemic-model-how-do-they-differ-ffdee9371a86</a></li>
</ul>
<p>我们需要先了解一个概念：<strong>「贫血模型」。</strong>也就是只有属性的类，贫血的意思就是没有行为，像木乃伊一样。这种模型唯一的作用就是将一些 ORM 映射到对应的数据库上，而我们的「服务层」通过「DAO层」加载这些「贫血模型」进行一些拼接之类的操作，功能越复杂，这种操作就越频繁，这是我们的软件复杂度上升的直接原因。</p>
<p>而「DDD」则把大多数的业务逻辑都包含在了「聚合」、「实体」、「值对象」里面，简单理解也就是实现了对象自治，把之前暴露出来的一些业务操作隐藏进了「域」之中。每个不同的区域之间只能通过对外暴露的统一的聚合根来访问，这样就做了收权的操作，这样数据的定义和更改的地方就聚集在了一处，很好的解决了复杂度的问题。</p>
<h2 id="DDD-帮助统一语言"><a href="#DDD-帮助统一语言" class="headerlink" title="DDD 帮助统一语言"></a>DDD 帮助统一语言</h2><p>在UML作为建模主流的时代，软件设计被明确分为面向对象分析（OOA），面向对象设计（OOD）和面向对象编码（OOP）阶段。实际操作中OOD的工作往往被OOA和OOP各自承担一部分，并同时存在分析模型和设计模型两个割裂的模型。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-a807a47aee3ab0fd.png" alt=""></p>
<p>而<strong>领域驱动设计的核心是建立统一的领域模型。</strong>领域模型在软件架构中处于核心地位，软件开发过程中，必须以建立领域模型为中心，以保障领域模型的忠实体现。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-87e243ee8dc411ed.png" alt=""></p>
<ul>
<li>图片来源：<a href="http://kaelzhang81.github.io/2017/10/20/DDD%E4%B9%8B-%E9%81%93%E6%9C%AF%E5%99%A8/" target="_blank" rel="noopener">http://kaelzhang81.github.io/2017/10/20/DDD%E4%B9%8B-%E9%81%93%E6%9C%AF%E5%99%A8/</a></li>
</ul>
<p>简单理解起来的话，也就是把<strong>业务人员和开发人员的语言统一起来</strong>，用代码来感受一下大概就是：</p>
<pre class=" language-java"><code class="language-java">userService<span class="token punctuation">.</span><span class="token function">love</span><span class="token punctuation">(</span>Jack<span class="token punctuation">,</span> Rose<span class="token punctuation">)</span>  <span class="token operator">=</span><span class="token operator">></span>  Jack<span class="token punctuation">.</span><span class="token function">love</span><span class="token punctuation">(</span>Rose<span class="token punctuation">)</span>
companyService<span class="token punctuation">.</span><span class="token function">hire</span><span class="token punctuation">(</span>company<span class="token punctuation">,</span>employee<span class="token punctuation">)</span>  <span class="token operator">=</span><span class="token operator">></span>  Company<span class="token punctuation">.</span><span class="token function">hire</span><span class="token punctuation">(</span>employee<span class="token punctuation">)</span></code></pre>
<h1 id="四、领域驱动设计过程"><a href="#四、领域驱动设计过程" class="headerlink" title="四、领域驱动设计过程"></a>四、领域驱动设计过程</h1><hr>
<p>领域驱动设计强调领域模型的重要性，并通过模型驱动设计来保障领域模型与程序设计的一致。从业务需求中提炼出统一语言（Ubiquitous Language），再基于统一语言建立领域模型；这个领域模型会指导着程序设计以及编码实现；最后，又通过重构来发现隐式概念，并运用设计模式改进设计与开发质量。这个过程如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-c56bc9ff6de47f68.png" alt=""></p>
<ul>
<li>图片来源：<a href="http://zhangyi.xyz/overview-of-ddd/" target="_blank" rel="noopener">http://zhangyi.xyz/overview-of-ddd/</a></li>
</ul>
<p>这个过程是一个覆盖软件全生命周期的设计闭环，每个环节的输出都可以作为下一个环节的输入，而在其中扮演重要指导作用的则是“领域模型”。这个设计闭环是一个螺旋上升的迭代设计过程，领域模型会在这个迭代过程中逐渐演进，在保证模型完整性与正确性的同时，具有新鲜的活力，使得领域模型能够始终如一的贯穿领域驱动设计过程，阐释着领域逻辑，指导着程序设计，验证着编码质量。</p>
<p>如果仔细审视这个设计闭环，我们发现在针对问题域和业务期望提炼统一语言，并通过统一语言进行领域建模时，可能会面临高复杂度的挑战。这是因为对于一个复杂的软件系统而言，我们要处理的问题域实在太庞大了。在为问题域寻求解决方案时，需要从宏观层次划分不同业务关注点的子领域，然后再深入到子领域中从微观层次对领域进行建模。<strong>宏观层次是战略的层面，微观层次是战术的层面，只有将战略设计与战术设计结合起来，才是完整的领域驱动设计。</strong></p>
<h2 id="战略设计-Do-Right-Things"><a href="#战略设计-Do-Right-Things" class="headerlink" title="战略设计 (Do Right Things)"></a>战略设计 (Do Right Things)</h2><h3 id="Ubiquitous-language"><a href="#Ubiquitous-language" class="headerlink" title="Ubiquitous language"></a>Ubiquitous language</h3><p>领域驱动开发让业务专家(Domain Expert)和开发人员一起来梳理业务，而双方有效沟通的方式是使用通用语言，在这个项目里，一开始我们就定义了很多词汇表, 就是我们自己的<strong>通用语言。</strong></p>
<h3 id="Bounded-Context-和-Domain"><a href="#Bounded-Context-和-Domain" class="headerlink" title="Bounded Context 和 Domain"></a>Bounded Context 和 Domain</h3><p>有了通用语言，词汇表 每一个词汇一定是有边界的，不同的边界内是不一样，比如你爱人在你家这个 Bounded Context 是你的 Wife, 但是如果她是一个老师，那么在学校这个边界里就是一个 Teacher. 我们经过多次讨论，采取的方法是拆成多个子系统（Bounded Context,是不是很像现在的微服务？)，每个子系统进行自治。</p>
<p>随后我们把一个个业务抽象为领域对象(Domain Model), 每一个 Domain 对领域进行自治。而模型里的属性和行为表达为业务专家都可以理解的代码，用比如<code>Job.Publish()</code>. 虽然这里面最终产生了聚合根、实体、值对象等，但是我们和业务专家沟通的时候尽量不要说这些词汇，比如我们可以说， 在招聘这块儿，职位是不是必须经过公司进行管理，那样我们就知道 Job 是属于公司这个聚合根。 对领域进行“通用”（类名，方法名等都用自然语言表达）建模，业务人员可以直接读懂我们的代码，从而可以知道是否表达了业务需求。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-1be8bb46520b9323.png" alt=""></p>
<h2 id="战术设计-Do-Things-Right"><a href="#战术设计-Do-Things-Right" class="headerlink" title="战术设计 (Do Things Right)"></a>战术设计 (Do Things Right)</h2><p>在战术设计方面，由于业务行为和规则都在领域里，而且系统被拆分成多个子系统，这对技术实现上带来了非常大的挑战，尤其是大部分人都是有牢固的基于数据驱动开发的思想。 技术上有不同实现方式。</p>
<h3 id="Event-Sourcing"><a href="#Event-Sourcing" class="headerlink" title="Event Sourcing"></a>Event Sourcing</h3><p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-760768e5888b007c.png" alt=""></p>
<p>Event Sourcing 就是我们不记录数据的最终状态，我们记录对数据的每一次改变(Event)，而读取的时候我们把这些改变从头再来一遍来取得数据状态，比如你有100块钱，现在剩下10块了，我们记录的不是money.total=10, 而是记录你每一次取钱的记录，然后从100块开始一步步重放你取钱的过程，来得到10.</p>
<p>一开始，我们写的过程中，时常回想起数据驱动的好，（每次开始一个新东西的时候，是不是很熟悉的感觉？)，觉得用Event Sourcing各种麻烦，直到后来随着系统的复杂性不断增加，我们才感觉到带来了非常大的好处, 这个随后单独来说。</p>
<h3 id="CQRS"><a href="#CQRS" class="headerlink" title="CQRS"></a>CQRS</h3><p>由于使用了 Event Sourcing, 对数据查询，尤其是跨业务(Aggregate)的查询非常麻烦，很难像关系数据那样有查询优势，CQRS是解决这一问题非常好的方法，CQRS让查询和写入分开，把界面需要查询的数据进行原样写入，原样的意思就是界面显示什么样的，就提前保存成什么样的，类似于原来的缓存，没有任何join操作，这样查询是非常高效的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-0e43e52965ed4273.png" alt=""></p>
<ul>
<li>图片来源：<a href="http://vitiy.info/how-to-make-simple-cqrs-implementation-without-event-sourcing/" target="_blank" rel="noopener">http://vitiy.info/how-to-make-simple-cqrs-implementation-without-event-sourcing/</a></li>
</ul>
<h2 id="演进的领域驱动设计过程"><a href="#演进的领域驱动设计过程" class="headerlink" title="演进的领域驱动设计过程"></a>演进的领域驱动设计过程</h2><p>战略设计会控制和分解战术设计的边界与粒度，战术设计则以实证角度验证领域模型的有效性、完整性与一致性，进而以演进的方式对之前的战略设计阶段进行迭代，从而形成一种螺旋式上升的迭代设计过程，如下图所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%90%E5%90%90%E8%A1%80%E6%8E%A8%E8%8D%90%E3%80%91%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1%E5%AD%A6%E4%B9%A0%E8%BE%93%E5%87%BA/7896890-b25cf801f5bc6f6d.png" alt=""></p>
<p>面对客户的业务需求，由领域专家与开发团队展开充分的交流，经过需求分析与知识提炼，获得清晰的问题域。通过对问题域进行分析和建模，识别限界上下文，利用它划分相对独立的领域，再通过上下文映射建立它们之间的关系，辅以分层架构与六边形架构划分系统的逻辑边界与物理边界，界定领域与技术之间的界限。之后，进入战术设计阶段，深入到限界上下文内对领域进行建模，并以领域模型指导程序设计与编码实现。若在实现过程中，发现领域模型存在重复、错位或缺失时，再进而对已有模型进行重构，甚至重新划分限界上下文。</p>
<p>两个不同阶段的设计目标是保持一致的，它们是一个连贯的过程，彼此之间又相互指导与规范，并<strong>最终保证一个有效的领域模型和一个富有表达力的实现同时演进。</strong></p>
<h1 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h1><hr>
<p>结合自己的学习经过，本篇有意识的避免了繁杂纷乱的「新概念」。如果有兴趣详细了解「DDD」中的那些概念，可以参照这篇文章：<a href="http://qinghua.github.io/ddd/" target="_blank" rel="noopener">http://qinghua.github.io/ddd/</a></p>
<p>借大佬的总结来收个尾吧：领域驱动开发好处多多，概念比较多，门槛相对较高，对人员要求较高，团队里至少需要有领路人，不然代价会比较大。 尤其慎用Event Sourcing, 而领域驱动尤其适合业务相对复杂的项目。 对那些很小的项目，CRUD仍然是好的选择。</p>
<h1 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h1><hr>
<ul>
<li>浅谈 MVC、MVP 和 MVVM 架构模式：<a href="https://draveness.me/mvx" target="_blank" rel="noopener">https://draveness.me/mvx</a></li>
<li>上善若水的博客：<a href="http://deshui.wang/" target="_blank" rel="noopener">http://deshui.wang/</a></li>
<li>CRUD工程师晋级之路：<a href="https://zhuanlan.zhihu.com/p/25442175" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/25442175</a></li>
<li>对象和数据库的天然阻抗：<a href="https://www.jdon.com/mda/oo-reltaion2.html" target="_blank" rel="noopener">https://www.jdon.com/mda/oo-reltaion2.html</a></li>
<li>Commands &amp; Events instead of CRUD — Part 1: Commands：<a href="https://hackernoon.com/commands-events-instead-of-crud-part-1-commands-17f4c7aee33b" target="_blank" rel="noopener">https://hackernoon.com/commands-events-instead-of-crud-part-1-commands-17f4c7aee33b</a></li>
<li>汤雪华的博客：<a href="https://www.cnblogs.com/netfocus/" target="_blank" rel="noopener">https://www.cnblogs.com/netfocus/</a></li>
<li>There is No U in CRUD：<a href="http://jlhood.com/there-is-no-u-in-crud/" target="_blank" rel="noopener">http://jlhood.com/there-is-no-u-in-crud/</a></li>
<li>Event sourcing vs CRUD：<a href="https://community.risingstack.com/event-sourcing-vs-crud/" target="_blank" rel="noopener">https://community.risingstack.com/event-sourcing-vs-crud/</a></li>
<li>阿里盒马领域驱动设计实践：<a href="https://www.infoq.cn/article/alibaba-freshhema-ddd-practice" target="_blank" rel="noopener">https://www.infoq.cn/article/alibaba-freshhema-ddd-practice</a></li>
<li>DDD战略篇：架构设计的响应力：<a href="https://zhuanlan.zhihu.com/p/30878497" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/30878497</a></li>
<li>使用DDD来构建你的REST API，而不是CRUD：<a href="http://blog.didispace.com/use-ddd-design-rest-api/" target="_blank" rel="noopener">http://blog.didispace.com/use-ddd-design-rest-api/</a></li>
<li>DDD &amp; co., part 1: What’s wrong with CRUD：<a href="https://www.thenativeweb.io/blog/2017-10-25-09-46-ddd-and-co-part-1-whats-wrong-with-crud/" target="_blank" rel="noopener">https://www.thenativeweb.io/blog/2017-10-25-09-46-ddd-and-co-part-1-whats-wrong-with-crud/</a></li>
<li>DDD的终极大招——By Experience：<a href="https://insights.thoughtworks.cn/ddd-by-experience/" target="_blank" rel="noopener">https://insights.thoughtworks.cn/ddd-by-experience/</a></li>
<li>领域驱动设计概览：<a href="http://zhangyi.xyz/overview-of-ddd/" target="_blank" rel="noopener">http://zhangyi.xyz/overview-of-ddd/</a></li>
<li>Refactoring from anemic model to DDD：<a href="https://blog.pragmatists.com/refactoring-from-anemic-model-to-ddd-880d3dd3d45f" target="_blank" rel="noopener">https://blog.pragmatists.com/refactoring-from-anemic-model-to-ddd-880d3dd3d45f</a></li>
<li>为什么DDD是设计微服务的最佳实践：<a href="https://www.jianshu.com/p/e1b32a5ee91c" target="_blank" rel="noopener">https://www.jianshu.com/p/e1b32a5ee91c</a></li>
<li>领域驱动设计在互联网业务开发中的实践：<a href="https://kb.cnblogs.com/page/586236/" target="_blank" rel="noopener">https://kb.cnblogs.com/page/586236/</a></li>
</ul>
<hr>
<p>按照惯例黏一个尾巴：</p>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2019/06/11/shi-si-yi-ren-de-kou-fu-zhi-yu-shi-ru-he-bei-man-zu-de/">
      十四亿人的口腹之欲，是如何被满足的？
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/%E5%A5%BD%E5%A5%87%E6%98%9F%E4%BA%BA/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>好奇星人</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2019年6月11日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105506.png" alt=""></p>
<blockquote>
<p>​​转自公众号<strong>“观方翻译”</strong></p>
</blockquote>
<p>今天分享一个我逛Quora看到的帖子。有人问了个问题：<strong>中国是怎么生产这么多粮食，足够养活十多亿人的？是靠进口还是自给自足？</strong></p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105627.png" alt=""></p>
<p><strong>剑桥大学博士 Janus Dongye</strong> 的回答（和他以前许多回答一样）让人拍案叫绝。</p>
<p><strong>以下为正文：</strong></p>
<p>眼见方为实。打开你的谷歌地球，从天上看看中国大地上到底在发生什么。西方媒体一般不会报道这些东西。</p>
<p>哪些地方值得留意，我会一一指给你看。</p>
<p>包括以下这些坐标点：</p>
<p><strong>地点一：福建宁德港（东经119°57’45.2”，北纬26°43’02.8”）</strong></p>
<p>我们的第一站是福建省的沿海地区。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720113653.png" alt=""></p>
<p>把地图放大一点，可以看到海面上漂着上百万个房子和网箱</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105536.png" alt=""></p>
<p>从浙江到广东，这段1000多英里的海岸线上，你几乎到处都可以看到类似的网箱。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105552.png" alt=""></p>
<p>那是什么？那是中国的“海鲜农场”。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105601.png" alt=""></p>
<p>与其出海捕野生海鲜，不如在同一个地方养海鲜。这样一来花较少的精力就能养出鱼、虾、蟹、龙虾、贝类等，挣的钱还多。</p>
<p>中国农民不只海水养殖，任何开阔的水域，水库、河流、湖泊都能养水产品。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105610.png" alt=""></p>
<p>想象一下，每个网箱养几十条鱼或螃蟹，加在一起是多大的规模。</p>
<p>那中国的海鲜消费量是多少呢？</p>
<p>据估计每年全球海鲜消费总量1.44亿吨，中国是最大的海鲜消费国，以6500万吨占全球总量的45%，接下去是欧盟（1300万吨）、日本（740万吨）、美国（710万吨）和印度（480万吨）。</p>
<p>中国和印度人口差不多，但中国的海鲜消费量是印度的12倍——尽管印度的地理条件更理想，位于渔业资源丰富热带，两面围绕着温暖的海洋。</p>
<p>在中国每年消费的6500万吨海鲜里，只有1500万吨是捕捞的，其余5000万吨都来自水产养殖农场。而日本90%的海鲜都来自捕捞。多亏了海鲜养殖，普通中国百姓可以买到便宜的海鲜，日常三餐可以吃得起海鲜。下面是典型中国家庭的团圆饭，你可以看到很多食材都是海鲜。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105844.png" alt=""></p>
<p>这样一桌供全家人享用的海鲜大餐，价格仅在120美元左右。</p>
<p><strong>地点二：浙江湖州南浔（东经120°09’02.9”，北纬30°46’14.5”）</strong></p>
<p>下一站是长江、太湖和钱塘江一带的洪泛平原。丰富的淡水资源带来了河流上游大量的养分，使这个地区成为养育1亿人口的鱼米之乡。这也是中国人口密度最高的地区之一。它比较类似孟加拉国、印度西孟加拉邦和越南西贡的洪泛平原。</p>
<p>与另外那些人口稠密的洪泛平原相比，中国人做了什么不寻常的事呢？</p>
<p>与种植水稻相比，养殖水产品可以卖出更高的价格，致富更快。拉近一点，你会看到这里有上百万个鱼塘。除了鱼塘，你还可以看到周围种了很多树。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105851.png" alt=""></p>
<p>这些树是桑树，是用来养蚕的。两千年来，这片地区的中国人发展出许多高度复杂且可持续的农业生态系统。其中最著名的当属桑基鱼塘，见下图：</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105857.png" alt=""></p>
<p>在完全不知道“可持续发展”这个概念的情况下，中国农民利用这个鱼-桑-蚕组成的生态系统已经有几千年历史。如今，这个系统发展成对同一片土地的多次循环利用：</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105906.png" alt=""></p>
<p>但要在鱼塘里养更多鱼，你得有增氧泵才行。它能向水里注入空气，使鱼有足够的氧气维持呼吸。下图中，每个鱼塘中间的白点就是一个增氧泵。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105915.png" alt=""></p>
<p>要在每个鱼塘里安装增氧泵，就必须处处通电。怎么向增氧泵供电呢？当然是太阳能电池板。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105923.png" alt=""></p>
<p>在地方政府的推动和专家的帮助下，农民和渔民开始学习最先进的太阳能技术和可持续发展技术。</p>
<p>中国地方政府为什么对推广高科技这么上心？因为官员晋升和政绩挂钩。光伏鱼塘完全符合可持续发展的理念，所以有利于地方官员晋升。</p>
<p>从这一点你就可以理解中国为何能生产全球84%的丝绸、66%的淡水鱼，太阳能发电量占全球总量25.8%。在浙江和江苏的农村地区，人们几乎每天都吃鱼。有人说这是他们脑子聪明的秘诀。</p>
<p>另一种生态循环是莲藕和养鱼。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105934.png" alt=""></p>
<p>在某些鱼塘里，你可以同时种菜，其中最常见的是种莲藕。中国每年莲藕产量达1100万吨，占全球总产量90%，出口量占全球60%。不光中国人爱吃藕，韩国、日本、越南也是进口莲藕的大户。</p>
<p>藕是我最喜欢的素菜之一，希望中国能加大推广力度，让全世界人民都吃上这种美味。</p>
<p>第三种生态循环是芥菜-蜜蜂-鱼虾。</p>
<p>同样的方法也可以用来种油菜。农民们冬天从河床上把养分含量高的淤泥挖出来堆在岸边，然后在这种泥里种不同的作物，比如油菜或芋头，不用施化肥。经过上千年的耕种，这里的农田是这样的：</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105945.png" alt=""></p>
<p><strong>地点三：江苏省兴化市垛田镇（东经119°51’50.4”，北纬32°56’51.9”）</strong></p>
<p>这里没有路，你得坐船才能在里面穿行。也正是因为这种生态系统，中国才成为全世界头号菜籽油生产国，产量占全球总量的22%。</p>
<p>有了油菜花，就能大规模养蜂。中国蜂蜜产量占全球30%。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105952.png" alt=""><br><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720105957.png" alt=""></p>
<p>实际上，美国消费的蜂蜜有1/3直接或间接来自中国。为了避免关税，中国蜂蜜出口商先出口到印度、菲律宾和马来西亚，再在当地重新贴标改成当地产品，然后再出口到美国。其他产业也有类似的操作。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110210.png" alt=""></p>
<p>除了蜂蜜，这里还是中国著名的大闸蟹产区。大闸蟹的价格可以卖到每公斤60美元左右，只有中等收入人群才吃得起。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110217.png" alt=""></p>
<p><strong>地点四：山东省寿光市（东经118°44’14.7”，北纬36°44’15.9”）</strong></p>
<p>接下来要去的是山东平原。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110224.png" alt=""></p>
<p>放大一点，我们就能在平原上找到上百万个“闪光”的小屋。看看周围，它们无处不在。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110233.png" alt=""></p>
<p>这是什么？原来是控制温度湿度的蔬菜水果大棚。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110238.png" alt=""></p>
<p>大棚里，不管什么季节都能做到蔬菜水果一年多熟。这意味着蔬菜水果产量比传统农田高出几倍。</p>
<p>比方说，大棚里种莴笋，从播种到收割需要52天，这样一年可以种七轮，效率高了七倍。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110245.png" alt=""></p>
<p>所以，大棚种植在有限空间内极大提高了农作物产量，这对中国人而言简直太棒了。为了推广这种方法，华北地区地方政府要求农民从农村合作银行贷款搭建大棚。</p>
<p>此外，还要求农民在大棚内安装物联网监控系统。通过再教育培训，农民们学会了用手机监控温室内部环境参数，比如二氧化碳浓度、光线强度、土壤温度等等。</p>
<p><img src="http://psxw1ax9x.bkt.clouddn.com/FjW84F3VtFUsxNeHQLEobjr82KHe" alt=""></p>
<p>联合国粮农组织的数据显示，中国蔬果产量和消费量在7亿吨左右，是世界总量的40%。印度大部分国民是素食者，可耕地面积大于中国，但全国蔬果产量是1.8亿吨，中国是它的3.8倍。秘诀就是大棚种植。</p>
<p>有了大棚蔬菜，中国人享用的蔬菜品种比世界任何地方的人都要多，价格还更便宜。查询维基百科就会发现，<strong>除了热带特产以外，中国每一种蔬菜产量几乎都是世界第一，而且跟第二名拉开的差距还不小。</strong>许多东亚特有的蔬菜甚至都没有上榜，比如韭菜。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110252.png" alt=""></p>
<p>与蔬菜类似，中国除热带水果外的各种水果产量几乎都是世界第一，远超第二名。</p>
<p>有一次我邀请一个黑人朋友来我家夏夜烧烤，拿了很多西瓜招待他，被开玩笑说我种族歧视，我给他看了这张统计表：</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110259.png" alt=""></p>
<p>在日本，一只西瓜大约卖2000日元（18美元），在中国，买一只更大的瓜只要10块人民币（1.5美元）。中国新疆的西瓜特别甜，如果你喜欢吃西瓜或任何一种瓜果，都应该去一趟哈密。</p>
<p><strong>地点五：西藏拉萨（东经91°09’18.6”，北纬29°41’52.3”）</strong></p>
<p>下面还是大棚，但是是西藏的大棚。把谷歌地球移到西藏任何城镇，都能看到大棚。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110306.png" alt=""></p>
<p>政府让藏民在青藏高原上建了很多大棚，藏民们在大棚里种番茄种得不亦乐乎，去寺庙的时间少了，让某个大和尚觉得不高兴了。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110313.png" alt=""></p>
<p>结果呢？过去十年西藏蔬菜价格下降90%，不用再从邻省运了。多数西藏人终于吃得起西瓜了。谁不喜欢吃瓜呢？</p>
<p>历史上多数藏人只吃牦牛肉、奶、乳制品和面食。在那样的恶劣气候条件下什么都种不出来。只有喇嘛才吃得起蔬菜。现在中国政府让大家都吃得上蔬菜水果了。</p>
<p><strong>地点六：新疆伊犁可克达拉（东经80°35’21.5”，北纬43°43’51.2”）</strong></p>
<p>可克达拉是北疆的一个县级市，西边是哈萨克斯坦的阿拉木图地区。下图黄线标出的是中哈边境线。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110412.png" alt=""></p>
<p>明显看出，中国一侧的绿色农田更多，哈萨克斯坦一侧基本就是荒原。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110419.png" alt=""></p>
<p>其实这里的土地很贫瘠，土壤酸性太高，水资源太少，种不了什么农作物。只能指望雪山上冰川融化时流下来的水。对哈萨克斯坦人来说，这样的种植业成本太高，而且本身市场也不大。所以哈萨克斯坦人决定干脆啥也不种。</p>
<p>中国这一侧呢，所有荒地都被一支特别的政府组织——新疆生产建设兵团给耕种了。现在新疆生产建设兵团成了一个管辖260万员工和农民的国企，里面有汉族人也有维吾尔族人。因为有了如此庞大的规模，边际运营成本下降，而且跟内地广大市场直接对接。</p>
<p>过去30年来，新疆生产建设兵团每年都派农业学生去以色列学习沙漠气候条件下最先进的农业技术。这些学生回到中国后把滴灌法等先进技术付诸实践。当技术条件成熟可以市场应用时，他们把新开垦的土地卖给当地各族农民，或直接请他们加入合作社。</p>
<p>当地的维吾尔族和哈萨克族人为了节约水资源和降低农业成本，接受培训学习汉语和最新的农业技术。每个村都有党员指导他们如何科学耕作。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110426.png" alt=""></p>
<p>滴灌法可以大大减少用水量，从而节约成本。在以色列和中国本土技术的帮助下，新疆的荒地成了高产的沃土。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110432.png" alt=""></p>
<p>那他们在这些新开辟的土地上种什么呢？</p>
<p>番茄、辣椒、瓜果、葡萄和棉花。这些作物都比麦子利润高。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110443.png" alt=""></p>
<p>新疆有充沛的日照和凉爽的夜晚，这使作物更加甘甜可口，买到内地和国外市场上的价格也就更高。中国消费者喜欢买新疆水果，因为它就是更好吃。</p>
<p>新疆的农业生产效率非常高，高到产量国内市场已经消化不了了。为了不让维吾尔农民吃价格下跌的亏，新疆生产建设兵团不依赖“自由市场”，而是积极开拓海外市场渠道，把农产品高价卖到国外去。</p>
<p>如果国内市场不需要这些农产品呢？</p>
<p>中国向美国学习，向国际商贸伙伴提要求，让它们买。这就是所谓的国家资本主义。中国领导人去哪个国家，都争取签自贸协议，让它们买中国产品。</p>
<p>不信吗？接下来便是证据。</p>
<p><strong>地点七：新疆巴音郭楞蒙古自治州和静县（东经86°36’15.4”，北纬42°18’36.1”）</strong></p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110451.png" alt=""></p>
<p>沙漠里这些红色的地块是什么呢？</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110457.png" alt=""></p>
<p>放大一点，你会看到这些是番茄田，种着无数番茄。这么大的规模，想象一下产量有多高。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110504.png" alt=""><br><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110509.png" alt=""></p>
<p>你吃意大利面、土耳其烤肉或薯条的时候，可能就在吃新疆番茄。当然，可能不是从新疆直接进口的，而是跟蜂蜜一样，经由第三国转销的。</p>
<p>中国每年番茄产量达5630万吨，出口量占全球1/3。其中1400万吨来自新疆。从全球最大的番茄酱生产商就能看出来：中粮集团（第2）、新疆中基实业（第3）、内蒙富源农产品（第6）、亨氏（第7）、新疆天业（第15）。</p>
<p>这些公司基本都是新疆生产建设兵团和中国政府的分销商，这部分利润多数返还给了新疆农民。最近中国政府还试图通过一带一路把新疆番茄卖到东欧去。2019年3月习近平主席访问意大利，说不定今后意大利也会对新疆番茄感兴趣。这些事西方媒体是不会报道的。</p>
<p>除了番茄和辣椒，中国还是世界最大的葡萄产国，产量占全球19.1%，最好的葡萄来自新疆吐鲁番。当然，酿造葡萄酒的技术确实不怎么样。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110516.png" alt=""></p>
<p>最后，聊聊水稻、小麦和玉米等主要作物吧。这是最重要的粮食，因为不只人要吃，还是猪、鸡、牛等产肉产奶的禽类畜类的饲料。</p>
<p>我们来比较一下全球最大的粮食产区吧：</p>
<ul>
<li>可耕地（千平方公里）：中国1086、印度1579、欧盟1091、美国1631</li>
<li>大米（百万吨）：中国208.1、印度169.5、欧盟3.1、美国9.2</li>
<li>小麦（百万吨）：中国134.3、印度98.5、欧盟150.2、美国47.3</li>
<li>玉米（百万吨）：中国257.3、印度26.0、欧盟60.9、美国366.2</li>
</ul>
<p>可以看出，中国总体上是最大的粮食生产国。但对14亿人口而言，这个量足够让人“吃得饱”，但离“吃得好”、人均粮食消耗量达到欧美发达国家水平，还有很长的路要走。</p>
<p>目前，中国可耕地面积不足以支持让14亿人都“吃得好”，而且随着工业化和城镇化，可耕地面积还在减少。</p>
<p><strong>地点八：河北省邢台市（东经 114°55’20.8”，北纬 37°35’54.1”）</strong></p>
<p>中国宝贵的土地资源是怎么使用的呢？下一站我们访问华北平原。这是中国大部分农作物的产地。（下图从上到下距离1500公里）</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110528.png" alt=""></p>
<p>这片平原上随便选个地方，比如四线城市邢台，这是个有700万人的“小”城市。（下图从上到下距离60公里）</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110534.png" alt=""></p>
<p>这听起来有点吓人，但实际上绿色的是农田，白色的点是村庄，每个村大约500人。比较大的白色区域是镇，人口从1万到10万不等。</p>
<p>可以看出，随着越来越多的人挣了钱，他们开始在原来的农田上盖房子，绿色的田野会越来越少。据估计，中国每年减少的可耕地面积在3000平方公里左右。这些农田变成了白色的混凝土。长期这样下去将造成灾难，因此中国政府在极力控制规管土地使用。但这种“城镇化”的势头巨大，管理起来难度相当高。</p>
<p><strong>地点九：甘肃省庆阳市（东经107°40’38.3”，北纬35°41’00.7”）</strong></p>
<p>从建国之初开始，可耕地资源匮乏的现实一直受到党和国家的高度重视。从毛泽东时代起，中共就组织群众开垦山地。这样的例子太多，就以黄土高原为例吧。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110541.png" alt=""></p>
<p>64万平方公里的黄土高原其实不适合种植农作物。但如果你放大看看，就会发现所有山谷、山坡都被开辟成了可耕地。从天上往下看，类似植物根须的地方便是农田。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110547.png" alt=""></p>
<p>再靠近一点，你可以看到所有的山丘都被改造成了梯田。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110553.png" alt=""></p>
<p>可人们发现，梯田太多会导致土地退化，雨季会发生泥石流等灾难。从1999年开始，中共意识到开辟太多农田不会显著提高产量，却会引发洪水和泥石流等自然灾害，所以发起了“退耕还林”运动。</p>
<p>农民们放弃那些产量低的农田，改在上面植树。放弃土地的农民会得到政府补贴，维持他们原来的收入。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110559.png" alt=""></p>
<p>上图可以看出造林的效果。这说明中国政府吸取了过去的经验教训，逐渐理解了可持续发展的的关键。</p>
<p>中国领导人曾经指出，“中国高度重视生态环境保护，秉持绿水青山就是金山银山的理念，倡导人与自然和谐共生，坚持走绿色发展和可持续发展之路。”</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110607.png" alt=""></p>
<p>这可不是空话，可以说每个字都落到了实处。许多外国人不清楚中国人民为什么支持领导人。其中一个原因就是他重组了中国政府机构，更关注环境了。比如说，如果某个地方环境太差，没有走可持续发展道路，负责环境的官员是可以“弹劾”市长的。</p>
<p>尽管退耕还林工程减少了中国的可耕地面积，尽管存在土地退化现象，但在大规模投资农业技术的帮助下，农业生产效率仍然得到了提升，国内粮食产量仍然在增长。</p>
<p>其中一项技术是耐盐碱水稻，使农民可以在盐碱地里种出水稻来。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110613.png" alt=""></p>
<p>尽管国内农作物产量提升，但中国仍然没有实现大米、小麦和玉米的自给自足，大约10%的粮食还是得靠从世界其他地区进口。但其实这部分进口粮食多数不是直接供人食用的。</p>
<p><em>例一：酿制啤酒和白酒</em></p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110621.png" alt=""></p>
<p>从2006年起，中国便成为了全球第一大啤酒生产国，每年产量达4654万千升，是美国产量的两倍有余。这个数字还在以每年4.9%的速度增长。除了进口小麦，中国的啤酒花也大部分靠从德国和美国进口。</p>
<p>中国同时也是全球最大的烈酒生产国。多数中国人喝不惯威士忌和伏特加，而比较青睐味道更芬芳浓郁的白酒。中国每年的白酒产量大约在1360万千升左右，比西方人喝的烈酒多得多。这还没有把私人酿的米酒算进去。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110628.png" alt=""></p>
<p>所以，中国有些地方的饮酒文化是外界根本不知道的，反正比英国和俄国人能喝。</p>
<p><em>例二：生猪和猪肉</em></p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110634.png" alt=""></p>
<p>上图反映出中国人有多喜欢吃猪肉。中国从美国和巴西进口的玉米有一部分被拿来做猪饲料，当然也有的用于鸡、牛等禽类畜类的养殖。</p>
<p><strong>结论</strong></p>
<p>中国可以喂饱中国人，而且不是让人吃米面等主食填饱肚子。中国与大多数发达国家相比，美食品种更多、价格更低。对社会上的穷人来说也是一样。这是我去过欧洲、美国、日本等许多地方之后的感受。</p>
<p>比方说，中国八人一桌吃20个菜，包括各种肉类、蔬菜和甜点，大家毫无宗教顾忌，过敏忌口，也不管什么个人空间。</p>
<p><img src="https://blog-1259634016.cos.ap-chengdu.myqcloud.com/img/20190720110641.png" alt=""></p>
<p>在山东，这样一桌菜大概要50美元左右。同样一桌菜在北京、上海、台北大概要150美元左右，在加州、日本、香港要300美元左右。这还没有算各种饮料和酒类。实际上，日本和美国加州大多数人基本不会有一次享受20道菜这种奢侈体验，但这在中国再正常不过了。</p>
<p>写了这么长的帖子，希望有助于大家涨知识，中国生产的粮食可远远不止“养活”十几亿口人而已。</p>
<p>谢谢阅读。</p>
<p>（完）</p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2019/06/11/wei-lai-ni-jiang-yue-lai-yue-nan-jiao-peng-you/">
      未来你将越来越难交朋友
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/%E6%9C%89%E8%B6%A3%E9%9B%86%E4%B8%AD%E8%90%A5/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>有趣集中营</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2019年6月11日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E6%9C%AA%E6%9D%A5%E4%BD%A0%E5%B0%86%E8%B6%8A%E6%9D%A5%E8%B6%8A%E9%9A%BE%E4%BA%A4%E6%9C%8B%E5%8F%8B/20190720104846.png" alt=""></p>
<blockquote>
<p>引自：每周分享第 59 期 - 阮一峰的网络日志<br>原文链接：<a href="http://www.ruanyifeng.com/blog/2019/06/weekly-issue-59.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2019/06/weekly-issue-59.html</a></p>
</blockquote>
<p>关于未来有很多预测，最新的<a href="https://www.perell.com/blog/fruits-of-friendship" target="_blank" rel="noopener">一种预测</a>是，<strong>未来你很难交朋友。</strong></p>
<p>那种可以交流内心的朋友，未来会越来越少。理由是，人们的生活变动和活动范围越来越大，很难与他人持续的、深入的接触。</p>
<p>一项调查发现，美国人成年后的20年中，平均要搬家6次，每个地方就住三年多。刚刚与别人熟悉了以后，你就要离开了，除非刻意，以后就很难再见面了。一位教授感叹：”我的曾祖父一生的生活圈是40平方公里，就在小镇过完一生。祖父的生活圈是400平方公里，最远就去了城里。父亲是4,000平方公里，我自己是40,000平方公里，不仅生活在东海岸和西海岸，足迹遍布全世界。”</p>
<p>深厚的友谊不是一蹴而就的，需要多次接触和反复交流。但是由于生活圈子越来越大，变动越来越快，结交好朋友的难度正在不断加大。<strong>这么说吧，友谊是一个静态累积的过程，但是我们的生活正变得越来越动态。</strong> 事实上，25%的美国人一个好朋友也没有。</p>
<p>未来人与人的直接接触将极其稀少，大多数时候都是跟机器打交道。现在，付款和点餐就已经是自助式，不需要人类接触了。未来我们与他人接触将越来越多在网上，你大多数交到的朋友将是网友。</p>
<p>这意味着，为了一个健康的、有着丰富社交的生活，你需要多在网上展示自己、接触他人。<strong>对于那些互联网上沉默寡言的人，未来的人生将会非常孤独。</strong></p>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2019/06/09/ni-xiang-liao-jie-de-springcloud-du-zai-zhe-li/">
      你想了解的「SpringCloud」都在这里
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/Spring-Cloud/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>Spring Cloud</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2019年6月9日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-1bb9ab18d3b811d8.png" alt=""></p>
<blockquote>
<p><strong>前言：</strong> 之前我们已经了解了<a href="https://www.jianshu.com/p/5368af76a0f8" target="_blank" rel="noopener">「什么是微服务？」</a>，现在我们开始了解「微服务」关键字下比较热门的「Spring Cloud」…</p>
</blockquote>
<h1 id="一、传统架构发展史"><a href="#一、传统架构发展史" class="headerlink" title="一、传统架构发展史"></a>一、传统架构发展史</h1><hr>
<blockquote>
<p>部分引用自：<a href="http://www.ityouknow.com/springcloud/2017/11/02/framework-and-springcloud.html" target="_blank" rel="noopener">从架构演进的角度聊聊Spring Cloud都做了些什么？ - 纯洁的微笑</a></p>
</blockquote>
<h2 id="单体架构"><a href="#单体架构" class="headerlink" title="单体架构"></a>单体架构</h2><p>单体架构在小微企业比较常见，典型代表就是一个应用、一个数据库、一个web容器就可以跑起来。</p>
<p>在两种情况下可能会选择单体架构：一是在企业发展的初期，为了保证快速上线，采用此种方案较为简单灵活；二是传统企业中垂直度较高，访问压力较小的业务。在这种模式下对技术要求较低，方便各层次开发人员接手，也能满足客户需求。</p>
<p>下面是单体架构的架构图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-97c4c079986d5325.png" alt=""></p>
<p>在单体架构中，技术选型非常灵活，优先满足快速上线的要求，也便于快速跟进市场。</p>
<h2 id="垂直架构"><a href="#垂直架构" class="headerlink" title="垂直架构"></a>垂直架构</h2><p>在单体架构发展一段时间后，公司的业务模式得到了认可，交易量也慢慢的大起来，这时候有些企业为了应对更大的流量，就会对原有的业务进行拆分，比如说：后台系统、前端系统、交易系统等。</p>
<p>在这一阶段往往会将系统分为不同的层级，每个层级有对应的职责，UI层负责和用户进行交互、业务逻辑层负责具体的业务功能、数据库层负责和上层进行数据交换和存储。</p>
<p>下面是垂直架构的架构图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-bed88a6d69bf4346.png" alt=""></p>
<h2 id="服务化架构"><a href="#服务化架构" class="headerlink" title="服务化架构"></a>服务化架构</h2><p>如果公司进一步的做大，垂直子系统会变的越来越多，系统和系统之间的调用关系呈指数上升的趋势。在这样的背景下，很多公司都会考虑服务的 SOA 化。<strong>SOA 代表面向服务的架构，将应用程序根据不同的职责划分为不同的模块</strong>，不同的模块直接通过特定的协议和接口进行交互。这样使整个系统切分成很多单个组件服务来完成请求，当流量过大时通过水平扩展相应的组件来支撑，所有的组件通过交互来满足整体的业务需求。</p>
<p>SOA服务化的优点是，它可以根据需求通过网络对松散耦合的粗粒度应用组件进行分布式部署、组合和使用。服务层是SOA的基础，可以直接被应用调用，从而有效控制系统中与软件代理交互的人为依赖性。</p>
<p>服务化架构是一套松耦合的架构，服务的拆分原则是服务内部高内聚，服务之间低耦合。</p>
<p>下面是服务化架构图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-9d1b9a96a112b4b7.png" alt=""></p>
<p>在这个阶段可以使用 WebService 或者 Dubbo 来服务治理。</p>
<p>我们发现从单体架构到服务化架构，应用数量都在不断的增加，慢慢的下沉的就成了基础组建，上浮的就成为业务系统。从上述也可以看出<strong>架构的本质就是不断的拆分重构</strong>：分的过程是把系统拆分为各个子系统/模块/组件，拆的时候，首先要解决每个组件的定位问题，然后才能划分彼此的边界，实现合理的拆分。合就是根据最终要求，把各个分离的组件有机整合在一起。拆分的结果使开发人员能够做到业务聚焦、技能聚焦，实现开发敏捷，合的结果是系统变得柔性，可以因需而变，实现业务敏捷。</p>
<h2 id="微服务架构"><a href="#微服务架构" class="headerlink" title="微服务架构"></a>微服务架构</h2><p><strong>微服务是一种软件架构风格，它是以专注于单一责任与功能的小型功能区块为基础</strong>，利用模组化的方式组合出复杂的大型应用程序，各功能区块使用与语言无关的 API（例如 REST）集相互通讯，且每个服务可以被单独部署，它具备以下三个核心特点：</p>
<ul>
<li><strong>微服务为大型系统而生。</strong>随着业务的快速增长，会带来系统流量压力和复杂度的上升，系统的可维护性和可扩展性成为架构设计的主要考虑因素，微服务架构设计理念通过小而美的业务拆分，通过分而自治来实现复杂系统的优雅设计实现。</li>
<li><strong>微服务架构是面向结果的。</strong>微服务架构设计风格的产生并非是出于学术或为标准而标准的设计，而是在软件架构设计领域不断演进过程中，面对实际工业界所遇到问题，而出现的面向解决实际问题的架构设计风格。</li>
<li><strong>专注于服务的可替代性来设计。</strong>微服务架构设计风格核心要解决的问题之一便是如何便利地在大型系统中进行系统组件的维护和替换，且不影响整体系统稳定性。</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-edd16c96b17343b5.png" alt=""></p>
<p><strong>SOA</strong> 与 <strong>微服务</strong> 的不同在于：</p>
<ul>
<li><strong>服务拆分粒度更细。</strong>微服务可以说是更细维度的服务化，小到一个子子模块，只要该模块依赖的资源与其他模块都没有关系，那么就可以拆分成一个微服务。</li>
<li><strong>服务独立部署。</strong>每个服务都严格遵循独立打包部署的准则，互不影响。比如一台物理机上可以部署多个 Docker 实例，每个 Docker 实例可以部署一个微服务的代码。</li>
<li><strong>服务独立维护。</strong>每个微服务都可以交由一个小团队甚至个人来开发、测试、发布和运维，并对整个生命周期负责。</li>
<li><strong>服务治理能力要求高。</strong>因为拆分为微服务之后，服务的数量变多，因此需要有统一的服务治理平台，来对各个服务进行管理。</li>
</ul>
<h1 id="二、引入-Spring-Cloud"><a href="#二、引入-Spring-Cloud" class="headerlink" title="二、引入 Spring Cloud"></a>二、引入 Spring Cloud</h1><hr>
<h2 id="什么是-Spring-Cloud"><a href="#什么是-Spring-Cloud" class="headerlink" title="什么是 Spring Cloud?"></a>什么是 Spring Cloud?</h2><p>Spring 全家桶在 Java 开发中拥有举足轻重的地位，其中的一系列产品不仅仅大大简化和方便了 Java 的开发，其中的 AOP 和 IoC 等一系列的理念也深刻地影响着 Java 程序员们。</p>
<p>Spring 全家桶产品众多，总结起来大概就是：</p>
<ul>
<li><strong>Spring</strong> 通常指 Spring IOC。</li>
<li><strong>Spring Framework</strong> 包含了 Spring IOC，同时包含了 Spring AOP，并实现与其它 J2EE 框架的整合。</li>
<li><strong>Spring Boot</strong> 是对 Spring Framework 的补充，让框架的集成变得更简单，致力于快速开发 独立的 Spring 应用。</li>
<li><strong>Spring Cloud</strong> 是基于 Spring Boot 设计的一套微服务规范，并增强了应用上下文。</li>
</ul>
<p>我们也不妨来看看官网的介绍：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-3267323e6d3b94bf.png" alt=""></p>
<p><strong>总结起来就是： Spring Cloud 是一系列框架的有序集合。</strong>我们能够使用基于 Spring Boot 设计的 Spring Cloud 方便快速的搭建起自己的可靠、协调一致的分布式系统。</p>
<h2 id="为什么是-Spring-Cloud？"><a href="#为什么是-Spring-Cloud？" class="headerlink" title="为什么是 Spring Cloud？"></a>为什么是 Spring Cloud？</h2><p>微服务的框架那么多比如：Dubbo、Kubernetes，为什么就要使用 Spring Cloud 的呢？</p>
<ul>
<li>产出于 Spring 大家族，Spring 在企业级开发框架中无人能敌，来头很大，可以保证后续的更新、完善。比如 Dubbo 现在就差不多死了</li>
<li>有 Spring Boot 这个独立干将可以省很多事，大大小小的活 Spring Boot 都搞的挺不错。</li>
<li>作为一个微服务治理的大家伙，考虑的很全面，几乎服务治理的方方面面都考虑到了，方便开发开箱即用。</li>
<li>Spring Cloud 活跃度很高，教程很丰富，遇到问题很容易找到解决方案。</li>
<li>轻轻松松几行代码就完成了熔断、均衡负载、服务中心的各种平台功能。</li>
</ul>
<h1 id="三、Spring-Cloud-能够帮我们做什么？"><a href="#三、Spring-Cloud-能够帮我们做什么？" class="headerlink" title="三、Spring Cloud 能够帮我们做什么？"></a>三、Spring Cloud 能够帮我们做什么？</h1><hr>
<p>前面我们说到了，「Spring Cloud」是一系列框架的集合，可以帮助我们解决分布式/微服务的各种问题，那么「Spring Cloud」究竟能帮助我们做什么呢？</p>
<p>SpringCloud的基础功能包括：</p>
<ul>
<li><strong>服务治理：</strong> Spring  Cloud Eureka</li>
<li><strong>客户端负载均衡：</strong> Spring Cloud Ribbon</li>
<li><strong>服务容错保护：</strong> Spring  Cloud Hystrix</li>
<li><strong>声明式服务调用：</strong> Spring  Cloud Feign</li>
<li><strong>API网关服务：</strong> Spring Cloud Zuul</li>
<li><strong>分布式配置中心：</strong> Spring Cloud Config</li>
</ul>
<p>当然 Spring Cloud 还包括一些高级的功能：</p>
<ul>
<li><strong>消息总线：</strong> Spring Cloud Bus</li>
<li><strong>消息驱动的微服务：</strong> Spring Cloud Stream</li>
<li><strong>分布式服务跟踪：</strong> Spring Cloud Sleuth</li>
</ul>
<h2 id="服务治理：Eureka"><a href="#服务治理：Eureka" class="headerlink" title="服务治理：Eureka"></a>服务治理：Eureka</h2><p>微服务很重要的一点就是「无状态」，也就是说每一个服务之间应该是独立的，所以当微服务架构搭起来之后各个独立的「微服务」之间应该如何<strong>通讯</strong>成了首要的问题。</p>
<p>假设我们的 A服务 需要访问 B服务，那么我们首先需要知道对方的 <strong>ip地址</strong>，所以我们调用起来可能就像：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-d736e62854e9f949.png" alt=""></p>
<p>似乎并没有什么问题，但是如果 B服务 的 <strong>ip地址</strong> 变更了，那么我们就只能手动的去更改 A服务 的配置，如果我们的服务有很多，并且不止 A服务 调用了 B服务，那么手动更改这些配置将会是一场噩梦。</p>
<p>Eureka 是 Netflix 开源的一款提供服务注册和发现的产品，它提供了完整的 Service Registry 和 Service Discovery 实现。也是 Spring Cloud 体系中最重要最核心的组件之一。</p>
<p>用大白话讲，Eureka 就是一个服务中心，将所有的可以提供的服务都注册到它这里来管理，其它各调用者需要的时候去注册中心获取，然后再进行调用，避免了服务之间的直接调用，方便后续的水平扩展、故障转移等。如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-44cc612bd6a8a064.png" alt=""></p>
<p>当然服务中心这么重要的组件一但挂掉将会影响全部服务，因此需要搭建 Eureka 集群来保持高可用性，生产中建议最少两台。随着系统的流量不断增加，需要根据情况来扩展某个服务，Eureka 内部已经提供均衡负载的功能，只需要增加相应的服务端实例既可。那么在系统的运行期间某个实例挂了怎么办？<strong>Eureka 内容有一个心跳检测机制，</strong> 如果某个实例在规定的时间内没有进行通讯则会自动被剔除掉，避免了某个实例挂掉而影响服务。</p>
<p>因此使用了Eureka就自动具有了注册中心、负载均衡、故障转移的功能。如果想对Eureka进一步了解可以参考这篇文章：<a href="http://www.ityouknow.com/springcloud/2017/05/10/springcloud-eureka.html" target="_blank" rel="noopener">注册中心Eureka</a></p>
<h2 id="客户端负载均衡：-Ribbon"><a href="#客户端负载均衡：-Ribbon" class="headerlink" title="客户端负载均衡： Ribbon"></a>客户端负载均衡： Ribbon</h2><p>Ribbon 是一个基于 HTTP 和 TCP 客户端的负载均衡器。Ribbon 可以在通过客户端中配置的 ribbonServerList 服务端列表去<strong>轮询访问</strong>以达到均衡负载的作用。</p>
<p>当 Ribbon 与 Eureka 联合使用时，ribbonServerList 会被 DiscoveryEnabledNIWSServerList 重写，扩展成<strong>从 Eureka 注册中心中获取服务端列表。</strong>同时它也会用 NIWSDiscoveryPing 来取代 IPing，<strong>它将职责委托给 Eureka 来确定服务端是否已经启动。</strong></p>
<ul>
<li>实战：</li>
</ul>
<p><a href="http://blog.didispace.com/springcloud2/" target="_blank" rel="noopener">Spring Cloud构建微服务架构（二）服务消费者 - http://blog.didispace.com/springcloud2/</a></p>
<h2 id="服务容错保护：-Hystrix"><a href="#服务容错保护：-Hystrix" class="headerlink" title="服务容错保护： Hystrix"></a>服务容错保护： Hystrix</h2><p>在微服务架构中通常会有多个服务层调用，基础服务的故障可能会导致级联故障，进而造成整个系统不可用的情况，这种现象被称为<strong>服务雪崩效应。</strong>服务雪崩效应是一种因“服务提供者”的不可用导致“服务消费者”的不可用,并将不可用逐渐放大的过程。</p>
<p>如下图所示：A作为服务提供者，B为A的服务消费者，C和D是B的服务消费者。A不可用引起了B的不可用，并将不可用像滚雪球一样放大到C和D时，雪崩效应就形成了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-2c62b2ffa85e86e7.png" alt=""></p>
<p>在这种情况下就需要整个服务机构具有<strong>故障隔离</strong>的功能，避免某一个服务挂掉影响全局。在 Spring Cloud 中 Hystrix 组件就扮演这个角色。</p>
<p>Hystrix 会在某个服务连续调用 N 次不响应的情况下，立即通知调用端调用失败，避免调用端持续等待而影响了整体服务。Hystrix 间隔时间会再次检查此服务，如果服务恢复将继续提供服务。</p>
<p>继续了解Hystrix可以参考：<a href="http://www.ityouknow.com/springcloud/2017/05/10/springcloud-eureka.html" target="_blank" rel="noopener">熔断器Hystrix</a></p>
<h2 id="Hystrix-Dashboard-和-Turbine"><a href="#Hystrix-Dashboard-和-Turbine" class="headerlink" title="Hystrix Dashboard 和 Turbine"></a>Hystrix Dashboard 和 Turbine</h2><p>当熔断发生的时候需要迅速的响应来解决问题，避免故障进一步扩散，那么对熔断的监控就变得非常重要。熔断的监控现在有两款工具：Hystrix-dashboard 和 Turbine</p>
<p>Hystrix-dashboard 是一款针对Hystrix进行实时监控的工具，通过 Hystrix Dashboard 我们可以直观地看到各 Hystrix Command 的请求响应时间, 请求成功率等数据。但是只使用 Hystrix Dashboard 的话, 你只能看到单个应用内的服务信息, 这明显不够. 我们需要一个工具能让我们汇总系统内多个服务的数据并显示到 Hystrix Dashboard 上, 这个工具就是 Turbine. 监控的效果图如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-de80387262f335c4.png" alt=""></p>
<p>想了解具体都监控了哪些指标，以及如何监控可以参考这篇文章：<a href="http://www.ityouknow.com/springcloud/2017/05/18/hystrix-dashboard-turbine.html" target="_blank" rel="noopener">熔断监控Hystrix Dashboard和Turbine</a></p>
<h2 id="声明式服务调用：Feign"><a href="#声明式服务调用：Feign" class="headerlink" title="声明式服务调用：Feign"></a>声明式服务调用：Feign</h2><p>上面我们介绍了 Ribbon 和 Hystrix 了，可以发现：这两个可以作为基础工具类广泛的嵌入到各个微服务中。为了<strong>简化我们的开发</strong>，Spring Cloud Feign 出现了！它基于 Netflix Feign 实现，整合了 Spring Cloud Ribbon 与 Spring Cloud Hystrix,  除了整合这两者的强大功能之外，它还提供了<strong>声明式的服务调用</strong>(不再通过RestTemplate)。</p>
<blockquote>
<p>Feign 是一种声明式、模板化的HTTP客户端。在 Spring Cloud 中使用 Feign, 我们可以做到使用HTTP请求远程服务时能与调用本地方法一样的编码体验，开发者完全感知不到这是远程方法，更感知不到这是个 HTTP 请求。</p>
</blockquote>
<p>下面就简单看看Feign是怎么优雅地实现远程调用的：</p>
<p><strong>服务绑定：</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// value --->指定调用哪个服务</span>
<span class="token comment" spellcheck="true">// fallbackFactory--->熔断器的降级提示</span>
<span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"MICROSERVICECLOUD-DEPT"</span><span class="token punctuation">,</span> fallbackFactory <span class="token operator">=</span> DeptClientServiceFallbackFactory<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">DeptClientService</span> <span class="token punctuation">{</span>

    <span class="token comment" spellcheck="true">// 采用Feign我们可以使用SpringMVC的注解来对服务进行绑定！</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/dept/get/{id}"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> Dept <span class="token function">get</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span> <span class="token keyword">long</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/dept/list"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>GET<span class="token punctuation">)</span>
    <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Dept<span class="token operator">></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">"/dept/add"</span><span class="token punctuation">,</span> method <span class="token operator">=</span> RequestMethod<span class="token punctuation">.</span>POST<span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span>Dept dept<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>Feign 中使用熔断器：</strong></p>
<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">/**
 * Feign中使用断路器
 * 这里主要是处理异常出错的情况(降级/熔断时服务不可用，fallback就会找到这里来)
 */</span>
<span class="token annotation punctuation">@Component</span> <span class="token comment" spellcheck="true">// 不要忘记添加，不要忘记添加</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DeptClientServiceFallbackFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token operator">&lt;</span>DeptClientService<span class="token operator">></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> DeptClientService <span class="token function">create</span><span class="token punctuation">(</span>Throwable throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DeptClientService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> Dept <span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">long</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Dept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDeptno</span><span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setDname</span><span class="token punctuation">(</span><span class="token string">"该ID："</span> <span class="token operator">+</span> id <span class="token operator">+</span> <span class="token string">"没有没有对应的信息,Consumer客户端提供的降级信息,此刻服务Provider已经关闭"</span><span class="token punctuation">)</span>
                        <span class="token punctuation">.</span><span class="token function">setDb_source</span><span class="token punctuation">(</span><span class="token string">"no this database in MySQL"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> List<span class="token operator">&lt;</span>Dept<span class="token operator">></span> <span class="token function">list</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> null<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">add</span><span class="token punctuation">(</span>Dept dept<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><strong>调用：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-151920f51a61863b.png" alt=""></p>
<ul>
<li>引用自：<br><a href="https://juejin.im/post/5b83466b6fb9a019b421cecc#heading-12" target="_blank" rel="noopener">外行人都能看懂的 Spring Cloud - https://juejin.im/post/5b83466b6fb9a019b421cecc#heading-12</a></li>
</ul>
<h2 id="API-网关服务：Zuul"><a href="#API-网关服务：Zuul" class="headerlink" title="API 网关服务：Zuul"></a>API 网关服务：Zuul</h2><p>在微服务架构模式下，<strong>后端服务的实例数一般是动态的，</strong>对于客户端而言很难发现动态改变的服务实例的访问地址信息。因此在基于微服务的项目中为了简化前端的调用逻辑，通常会引入 API Gateway 作为轻量级网关，同时 API Gateway 中也会实现相关的认证逻辑从而简化内部服务之间相互调用的复杂度。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-e3e021be95edbf77.png" alt=""></p>
<p>Spring Cloud 体系中支持 API Gateway 落地的技术就是 Zuul。Spring Cloud Zuul 路由是微服务架构中不可或缺的一部分，提供动态路由，监控，弹性，安全等的边缘服务。Zuul 是 Netflix 出品的一个基于 JVM 路由和服务端的负载均衡器。</p>
<p>它的具体作用就是<strong>服务转发，接收并转发所有内外部的客户端调用。</strong>使用 Zuul 可以作为资源的统一访问入口，同时也可以在网关做一些权限校验等类似的功能。</p>
<p>具体使用参考这篇文章：<a href="http://www.ityouknow.com/springcloud/2017/06/01/gateway-service-zuul.html" target="_blank" rel="noopener">服务网关zuul</a></p>
<h2 id="分布式配置中心：Config"><a href="#分布式配置中心：Config" class="headerlink" title="分布式配置中心：Config"></a>分布式配置中心：Config</h2><p>随着业务的不断发展，我们的「微服务」可能会越来越多，而<strong>每一个微服务都会有自己的配置文件，</strong>在研发过程中有测试环境、UAT环境、生产环境，因此每个微服务又对应至少三个不同环境的配置文件。这么多的配置文件，如果需要修改某个公共服务的配置信息，如：缓存、数据库等，难免会产生混乱，这个时候就需要引入 Spring Cloud 另外一个组件：Spring Cloud Config。</p>
<p><strong>Spring Cloud Config 是一个解决分布式系统的配置管理方案。</strong>它包含了 Client 和 Server 两个部分，Server 提供配置文件的存储、以接口的形式将配置文件的内容提供出去，Client 通过接口获取数据、并依据此数据初始化自己的应用。</p>
<p>其实就是 Server 端将所有的配置文件服务化，需要配置文件的服务实例去 Config Server 获取对应的数据。<strong>将所有的配置文件统一整理，避免了配置文件碎片化。</strong>配置中心git实例参考：<a href="http://www.ityouknow.com/springcloud/2017/05/22/springcloud-config-git.html" target="_blank" rel="noopener">配置中心git示例</a>；</p>
<p>如果服务运行期间改变配置文件，服务是不会得到最新的配置信息，需要解决这个问题就需要引入 Refresh。可以在服务的运行期间重新加载配置文件，具体可以参考这篇文章：<a href="http://www.ityouknow.com/springcloud/2017/05/23/springcloud-config-svn-refresh.html" target="_blank" rel="noopener">配置中心svn示例和refresh</a></p>
<p>当所有的配置文件都存储在配置中心的时候，配置中心就成为了一个非常重要的组件。<strong>如果配置中心出现问题将会导致灾难性的后果，因此在生产中建议对配置中心做集群，来支持配置中心高可用性。</strong>具体参考：<a href="http://www.ityouknow.com/springcloud/2017/05/25/springcloud-config-eureka.html" target="_blank" rel="noopener">配置中心服务化和高可用</a></p>
<h2 id="消息总线：Bus"><a href="#消息总线：Bus" class="headerlink" title="消息总线：Bus"></a>消息总线：Bus</h2><p>上面的 Refresh 方案虽然可以解决单个微服务运行期间重载配置信息的问题，但是在真正的实践生产中，可能会有 N 多的服务需要更新配置，如果每次依靠手动 Refresh 将是一个巨大的工作量，这时候 Spring Cloud 提出了另外一个解决方案：Spring Cloud Bus</p>
<p><strong>Spring Cloud Bus 通过轻量消息代理连接各个分布的节点。</strong>这会用在<strong>广播状态</strong>的变化（例如配置变化）或者其它的消息指令中。Spring Cloud Bus 的一个核心思想是<strong>通过分布式的启动器对Spring Boot应用进行扩展，也可以用来建立一个或多个应用之间的通信频道。</strong>目前唯一实现的方式是用 AMQP 消息代理作为通道。</p>
<p>Spring Cloud Bus 是轻量级的通讯组件，也可以用在其它类似的场景中。有了 Spring Cloud Bus 之后，当我们改变配置文件提交到版本库中时，会自动的触发对应实例的 Refresh，具体的工作流程如下：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-ff35d8cb86a33733.png" alt=""></p>
<p>也可以参考这篇文章来了解：<a href="http://www.ityouknow.com/springcloud/2017/05/26/springcloud-config-eureka-bus.html" target="_blank" rel="noopener">配置中心和消息总线</a></p>
<h2 id="消息驱动的微服务：Stream"><a href="#消息驱动的微服务：Stream" class="headerlink" title="消息驱动的微服务：Stream"></a>消息驱动的微服务：Stream</h2><p>Spring Cloud Stream 是一个用来为微服务应用构建消息驱动能力的框架。它可以基于 Spring Boot 来创建独立的、可用于生产的 Spring 应用程序。它通过使用 Spring Integration 来<strong>连接消息代理中间件以实现消息事件驱动的微服务应用。</strong></p>
<p>下图是官方文档中对于 Spring Cloud Stream 应用模型的结构图。从中我们可以看到，Spring Cloud Stream 构建的应用程序与消息中间件之间是通过绑定器 Binder 相关联的，绑定器对于应用程序而言起到了隔离作用，它使得不同消息中间件的实现细节对应用程序来说是透明的。所以对于每一个 Spring Cloud Stream 的应用程序来说，它不需要知晓消息中间件的通信细节，它只需要知道 Binder 对应用程序提供的概念去实现即可。如下图案例，在应用程序和 Binder 之间定义了两条输入通道和三条输出通道来传递消息，而绑定器则是作为这些通道和消息中间件之间的桥梁进行通信。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-07f3ff1255dfc531.png" alt=""></p>
<p>Spring Cloud Stream 为一些供应商的消息中间件产品提供了个性化的自动化配置实现，并且引入了发布-订阅、消费组以及消息分区这三个核心概念。简单的说，<strong>Spring Cloud Stream 本质上就是整合了 Spring Boot 和 Spring Integration，实现了一套轻量级的消息驱动的微服务框架。</strong>通过使用 Spring Cloud Stream，可以有效地简化开发人员对消息中间件的使用复杂度，让系统开发人员可以有更多的精力关注于核心业务逻辑的处理。由于 Spring Cloud Stream 基于 Spring Boot 实现，所以它秉承了 Spring Boot 的优点，实现了自动化配置的功能帮忙我们可以快速的上手使用，但是目前为止 Spring Cloud Stream 只支持 <strong>RabbitMQ</strong> 和 <strong>Kafka</strong> 两个著名的消息中间件的自动化配置：</p>
<ul>
<li>实战：<br><a href="http://blog.didispace.com/spring-cloud-starter-dalston-7-1/" target="_blank" rel="noopener">Spring Cloud构建微服务架构：消息驱动的微服务（入门）【Dalston版】 - http://blog.didispace.com/spring-cloud-starter-dalston-7-1/</a></li>
</ul>
<h2 id="分布式服务跟踪：Sleuth"><a href="#分布式服务跟踪：Sleuth" class="headerlink" title="分布式服务跟踪：Sleuth"></a>分布式服务跟踪：Sleuth</h2><p>随着服务的越来越多，对调用链的分析会越来越复杂，如服务之间的调用关系、某个请求对应的调用链、调用之间消费的时间等，<strong>对这些信息进行监控就成为一个问题。</strong>在实际的使用中我们需要监控服务和服务之间通讯的各项指标，这些数据将是我们改进系统架构的主要依据。因此分布式的链路跟踪就变的非常重要，Spring Cloud 也给出了具体的解决方案：Spring Cloud Sleuth 和 Zipkin</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-c68c2ef12cd4adae.png" alt=""></p>
<p>Spring Cloud Sleuth 为服务之间调用提供链路追踪。通过 Sleuth 可以很清楚的了解到一个服务请求经过了哪些服务，每个服务处理花费了多长时间。从而让我们可以很方便的理清各微服务间的调用关系。</p>
<p>Zipkin 是 Twitter 的一个开源项目，允许开发者收集 Twitter 各个服务上的监控数据，并提供查询接口</p>
<p>分布式链路跟踪需要 Sleuth + Zipkin 结合来实现，具体操作参考这篇文章：<a href="http://www.jianshu.com/p/c3d191663279" target="_blank" rel="noopener">分布式链路跟踪(Sleuth)</a></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我们从整体上来看一下Spring Cloud各个组件如何来配套使用：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BD%A0%E6%83%B3%E4%BA%86%E8%A7%A3%E7%9A%84%E3%80%8CSpringCloud%E3%80%8D%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C/7896890-eda069329a8b386d.png" alt=""></p>
<p>从上图可以看出 Spring Cloud 各个组件相互配合，合作支持了一套完整的微服务架构。</p>
<ul>
<li>其中 <strong>Eureka</strong> 负责服务的注册与发现，很好将各服务连接起来</li>
<li><strong>Hystrix</strong> 负责监控服务之间的调用情况，连续多次失败进行熔断保护。</li>
<li><strong>Hystrix dashboard,Turbine</strong> 负责监控 Hystrix 的熔断情况，并给予图形化的展示</li>
<li><strong>Spring Cloud Config</strong> 提供了统一的配置中心服务</li>
<li>当配置文件发生变化的时候，<strong>Spring Cloud Bus</strong> 负责通知各服务去获取最新的配置信息</li>
<li>所有对外的请求和服务，我们都通过 <strong>Zuul</strong> 来进行转发，起到 API 网关的作用</li>
<li>最后我们使用 <strong>Sleuth + Zipkin</strong> 将所有的请求数据记录下来，方便我们进行后续分析</li>
</ul>
<p>Spring Cloud 从设计之初就考虑了绝大多数互联网公司架构演化所需的功能，如服务发现注册、配置中心、消息总线、负载均衡、断路器、数据监控等。这些功能都是以插拔的形式提供出来，方便我们系统架构演进的过程中，可以合理的选择需要的组件进行集成，从而在架构演进的过程中会更加平滑、顺利。</p>
<p>微服务架构是一种趋势，Spring Cloud 提供了标准化的、全站式的技术方案，意义可能会堪比当前 Servlet 规范的诞生，有效推进服务端软件系统技术水平的进步。</p>
<blockquote>
<p>引用自：<a href="http://www.ityouknow.com/springcloud/2017/11/02/framework-and-springcloud.html" target="_blank" rel="noopener">从架构演进的角度聊聊Spring Cloud都做了些什么？ - http://www.ityouknow.com/springcloud/2017/11/02/framework-and-springcloud.html</a></p>
</blockquote>
<h1 id="四、Spring-Cloud-版本"><a href="#四、Spring-Cloud-版本" class="headerlink" title="四、Spring Cloud 版本"></a>四、Spring Cloud 版本</h1><hr>
<p>刚接触的「Spring Cloud」的童鞋可能会对它的版本感到奇怪，什么 <code>Angle</code>、<code>Brixton</code>、<code>Finchley</code>，这些都是啥啊？「为什么会有这么多种看起来不同的 Spring Cloud？」</p>
<p>从上面我们可以知道：<strong>Spring Cloud 是一个拥有诸多子项目的大型综合项目</strong>（功能不止上面的介绍），原则上其子项目也都维护着自己的发布版本号。那么每一个Spring Cloud的版本都会包含不同的子项目版本，<strong>为了要管理每个版本的子项目清单，避免版本名与子项目的发布号混淆，所以没有采用版本号的方式，而是通过命名的方式。</strong></p>
<p>这些版本名字采用了伦敦地铁站的名字，<strong>根据字母表的顺序来对应版本时间顺序，</strong>比如：最早的Release版本：Angel，第二个Release版本：Brixton，以此类推……</p>
<p>当一个项目到达发布临界点或者解决了一个严重的 BUG 后就会发布一个 “service Release” 版本， 简称 SR（X）版本，x 代表一个递增数字。</p>
<ul>
<li>引用自：<br><a href="http://blog.didispace.com/springcloud-version/" target="_blank" rel="noopener">聊聊Spring Cloud版本的那些事儿 - http://blog.didispace.com/springcloud-version/</a></li>
</ul>
<h2 id="Spring-Cloud-amp-Spring-Boot-版本对照表"><a href="#Spring-Cloud-amp-Spring-Boot-版本对照表" class="headerlink" title="Spring Cloud &amp; Spring Boot 版本对照表"></a>Spring Cloud &amp; Spring Boot 版本对照表</h2><p>通过查阅官网：<a href="https://spring.io/projects/spring-cloud" target="_blank" rel="noopener">https://spring.io/projects/spring-cloud</a>，我们可以看到一个「Release train Spring Boot compatibility」表：</p>
<table>
<thead>
<tr>
<th align="left"><strong>Release Train</strong></th>
<th align="left"><strong>Boot Version</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">Greenwich</td>
<td align="left">2.1.x</td>
</tr>
<tr>
<td align="left">Finchley</td>
<td align="left">2.0.x</td>
</tr>
<tr>
<td align="left">Edgware</td>
<td align="left">1.5.x</td>
</tr>
<tr>
<td align="left">Dalston</td>
<td align="left">1.5.x</td>
</tr>
</tbody></table>
<p>上表可以看出，最新的「Spring Cloud」版本已经出到了 Greenwich… 每个版本都能查阅到当前版本所包含的子项目，以及子项目的版本号，我们可以通过此来决定需要选择怎么样的版本。</p>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><hr>
<p><a href="https://juejin.im/post/5b83466b6fb9a019b421cecc#heading-19" target="_blank" rel="noopener">1. 外行人都能看懂的SpringCloud，错过了血亏！ - https://juejin.im/post/5b83466b6fb9a019b421cecc#heading-19</a><br><a href="http://www.ityouknow.com/springcloud/2017/11/02/framework-and-springcloud.html" target="_blank" rel="noopener">2. 从架构演进的角度聊聊Spring Cloud都做了些什么？ - http://www.ityouknow.com/springcloud/2017/11/02/framework-and-springcloud.html</a><br><a href="http://blog.didispace.com/springcloud-version/" target="_blank" rel="noopener">3. 聊聊Spring Cloud版本的那些事儿 - http://blog.didispace.com/springcloud-version/</a><br><a href="http://blog.didispace.com/spring-cloud-learning/" target="_blank" rel="noopener">4. Spring Cloud 从入门到精通 - http://blog.didispace.com/spring-cloud-learning/</a><br><a href="https://springcloud.cc/" target="_blank" rel="noopener">5. Spring Cloud 中文网 - https://springcloud.cc/</a></p>
<hr>
<p>按照惯例黏一个尾巴：</p>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2019/06/08/chong-gou-gai-shan-ji-you-dai-ma-de-she-ji-du-shu-bi-ji/">
      《重构:改善既有代码的设计》读书笔记
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>学习笔记</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2019年6月8日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%8A%E9%87%8D%E6%9E%84-%E6%94%B9%E5%96%84%E6%97%A2%E6%9C%89%E4%BB%A3%E7%A0%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/7896890-0fe8ed05d4e21444.png" alt=""></p>
<blockquote>
<p><strong>前言：</strong> 捧读像这一类的书对于自己来说总带着一些神圣感，感谢自己并没有被这么宏大的主题吓退，看完了这里分享输出一下自己的笔记。</p>
</blockquote>
<h1 id="一、理解重构"><a href="#一、理解重构" class="headerlink" title="一、理解重构"></a>一、理解重构</h1><hr>
<h2 id="什么是重构？"><a href="#什么是重构？" class="headerlink" title="什么是重构？"></a>什么是重构？</h2><p>按书中 P45 中的说法，重构这个概念被分成了动词和名词的方面被分别阐述：</p>
<ul>
<li><strong>重构（名词）：</strong> 对软件内部结构的一种调整，目的是在不改变软件可观察行为的前提下，提高其可理解性，降低其修改成本。</li>
<li><strong>重构（动词）：</strong> 使用一系列重构手法，在不改变软件可观察行为的前提下，调整其结构。</li>
</ul>
<p>在过去的几十年时间里，重构这个词似乎被用来代指任何形式的代码清理，但上面的定义所指的是一种特定的清理代码的方式。<strong>重构的关键在于运用大量微小且保持软件行为的步骤，一步一步达成大规模的修改。</strong></p>
<p>每一次的重构要么很小，要么包含了若干个小步骤，即使重构没有完成，也应当可以在任何时刻停下来，所以如果有人说它们的代码在重构过程中有一两天时间不可用，基本上可以确定，他们做的事不是重构。</p>
<h2 id="与性能优化的区别"><a href="#与性能优化的区别" class="headerlink" title="与性能优化的区别"></a>与性能优化的区别</h2><p>重构与性能优化有很多相似的地方：两者都需要修改代码，并且两者都不会改变程序的整体功能。</p>
<p>两者的差别在于起目的：</p>
<ul>
<li><strong>重构是为了让代码 “更容易理解，更容易修改”。</strong>这可能使程序运行得更快，也可能使程序运行的更慢。</li>
<li><strong>性能优化则只关心程序是否运行的更快。</strong>对于最终得到的代码是否容易理解和维护就不知道了。</li>
</ul>
<h2 id="为什么重构？"><a href="#为什么重构？" class="headerlink" title="为什么重构？"></a>为什么重构？</h2><p>重构不是包治百病的灵丹妙药，也绝对不是所谓的“银弹”。重构只是一种工具，能够帮助你始终良好的控制代码而已。使用它，可能基于下面的几个目的。</p>
<blockquote>
<p>这里有一个有意思的科普（引用自百度百科：<a href="https://baike.baidu.com/item/%E6%B2%A1%E6%9C%89%E9%93%B6%E5%BC%B9" target="_blank" rel="noopener">没有银弹</a><br>）：在民俗传说里，所有能让我们充满梦靥的怪物之中，没有比狼人更可怕的了，因为它们会突然地从一般人变身为恐怖的怪兽，因此人们尝试着查找能够奇迹似地将狼人一枪毙命的银弹。我们熟悉的软件项目也有类似的特质（以一个不懂技术的管理者角度来看），平常看似单纯而率直，但很可能一转眼就变成一只时程延误、预算超支、产品充满瑕疵的怪兽，所以，我们听到了绝望的呼唤，渴望有一种银弹，能够有效降低软件开发的成本，就跟电脑硬件成本能快速下降一样。</p>
</blockquote>
<h3 id="1-改进软件的设计"><a href="#1-改进软件的设计" class="headerlink" title="1. 改进软件的设计"></a>1. 改进软件的设计</h3><p>当人们只为短期目的而修改代码时，他们经常没有完全理解架构的整体设计。于是代码逐渐失去了自己的结构。程序员越来越难以通过阅读代码来理解原来的设计。代码结构的流失有累积效应。越难看出代码所代表的设计企图，就越难以保护其设计，于是设计就腐败得越快。</p>
<p>完成同样一件事，设计欠佳的程序往往需要更多代码，这常常是因为代码在不同的地方使用完全相同的语句做同样的事情，因此改进设计的一个重要方向就是消除重复代码。<strong>消除重复代码，我就可以确定所有事物和行为在代码中只表述一次，这正是优秀设计的根本。</strong></p>
<h3 id="2-使软件更容易理解"><a href="#2-使软件更容易理解" class="headerlink" title="2. 使软件更容易理解"></a>2. 使软件更容易理解</h3><p>所谓程序设计，很大程度上就是与计算机对话：我编写代码告诉计算机做什么，而它的响应是按照我的指示精确行动。一言以蔽之，我所做的就是填补“我想要它做什么”和“我告诉它做什么”之间的缝隙。<strong>编程的核心就在于“准确说出我想要的”。</strong></p>
<p>然而别忘了，除计算机之外，源码还有其他读者，并且很大概率还是几个月后的自己，如何更清晰地表达我想要做的，这可能就需要一些重构的手法。</p>
<blockquote>
<p>这里我联想到了软件设计的 KISS 原则：KISS 原则，<strong>K</strong>eep <strong>I</strong>t <strong>S</strong>imple and <strong>S</strong>tupid ，简单的理解这句话就是，要把一个系统做的连白痴都会用。</p>
</blockquote>
<h3 id="3-帮助找到-BUG"><a href="#3-帮助找到-BUG" class="headerlink" title="3. 帮助找到 BUG"></a>3. 帮助找到 BUG</h3><p>对代码的理解，可以帮助找到系统中存在的一些 BUG。搞清楚程序结构的同时，也可以对自己的假设做一些验证，这样一来 BUG 想不发现都难。</p>
<p>Kent Beck 经常形容自己的一句话是：“我不是一个特别好的程序员，我只是一个有着一些特别好的习惯的还不错的的程序员。”重构能够帮助我们更有效地写出健壮的代码。</p>
<h3 id="4-提高编程速度"><a href="#4-提高编程速度" class="headerlink" title="4. 提高编程速度"></a>4. 提高编程速度</h3><p>听起来可能有些反直觉，因为重构可能会花大量的时间改善设计、提高阅读性、修改 BUG，难道不是在降低开发速度嘛？</p>
<p>软件开发者交谈时的故事：一开始他们进展很快，但如今想要添加一个新功能需要的时间就要长得多。他们需要花越来越多的时间去考虑如何把新功能塞进现有的代码库，不断蹦出来的bug修复起来也越来越慢。代码库看起来就像补丁摞补丁，需要细致的考古工作才能弄明白整个系统是如何工作的。这份负担不断拖慢新增功能的速度，到最后程序员恨不得从头开始重写整个系统。</p>
<p>下面这幅图可以描绘他们经历的困境。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%8A%E9%87%8D%E6%9E%84-%E6%94%B9%E5%96%84%E6%97%A2%E6%9C%89%E4%BB%A3%E7%A0%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/7896890-4638680f8060dd6c.png" alt=""></p>
<p>但有些团队的境遇则截然不同。他们添加新功能的速度越来越快，因为他们能利用已有的功能，基于已有的功能快速构建新功能。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%8A%E9%87%8D%E6%9E%84-%E6%94%B9%E5%96%84%E6%97%A2%E6%9C%89%E4%BB%A3%E7%A0%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/7896890-cbcca66c5694733e.png" alt=""></p>
<p><strong>两种团队的区别就在于软件的内部质量。</strong>需要添加新功能时，内部质量良好的软件让我可以很容易找到在哪里修改、如何修改。良好的模块划分使我只需要理解代码库的一小部分，就可以做出修改。如果代码很清晰，我引入 BUG 的可能性就会变小，即使引入了 BUG，调试也会容易得多。<strong>理想情况下，代码库会逐步演化成一个平台，在其上可以很容易地构造与其领域相关的新功能。</strong></p>
<p>这种现象被作者称为<strong>“设计耐久性假说”</strong>：通过投入精力改善内部设计，我们增加了软件的耐久性，从而可以更长时间地保持开发的快速。目前还无法科学地证明这个理论，所以说它是一个“假说”。</p>
<p>20年前，行业的陈规认为：良好的设计必须在开始编程之前完成，因为一旦开始编写代码，设计就只会逐渐腐败。重构改变了这个图景。现在我们可以改善已有代码的设计，因此我们可以<strong>先做一个设计，然后不断改善它，</strong>哪怕程序本身的功能也在不断发生着变化。由于预先做出良好的设计非常困难，想要既体面又快速地开发功能，重构必不可少。</p>
<h2 id="什么时候重构？"><a href="#什么时候重构？" class="headerlink" title="什么时候重构？"></a>什么时候重构？</h2><ul>
<li><strong>三次法则：</strong><br>第一次做某件事时只管去做；第二次做类似的事会产生反感，但无论如何还是可以去做；第三次再做类似的事，你就应该重构。</li>
</ul>
<h2 id="什么时候不应该重构？"><a href="#什么时候不应该重构？" class="headerlink" title="什么时候不应该重构？"></a>什么时候不应该重构？</h2><p>重构并不是必要，当然也有一些不那么需要重构的情况：</p>
<ul>
<li><strong>不需要修改，那些丑陋的代码能隐藏在一个 API 之下。</strong> 只有当我需要理解其工作原理时，对其进行重构才会有价值；</li>
<li><strong>重写比重构容易。</strong> 这可能就需要良好的判断力和丰富的经验才能够进行抉择了。</li>
</ul>
<h1 id="二、重构的几种姿势"><a href="#二、重构的几种姿势" class="headerlink" title="二、重构的几种姿势"></a>二、重构的几种姿势</h1><hr>
<h2 id="预备性重构：让添加新功能更容易"><a href="#预备性重构：让添加新功能更容易" class="headerlink" title="预备性重构：让添加新功能更容易"></a>预备性重构：让添加新功能更容易</h2><p><strong>重构的最佳时机就在添加新功能之前。</strong>在动手添加新功能之前，我会看看现有的代码库，此时经常会发现：如果对代码结构做一点微调，我的工作会容易得多。也许已经有个函数提供了我需要的大部分功能，但有几个字面量的值与我的需要略有冲突。如果不做重构，我可能会把整个函数复制过来，修改这几个值，但这就会导致重复代码—如果将来我需要做修改，就必须同时修改两处（更麻烦的是，我得先找到这两处）。而且，如果将来我还需要一个类似又略有不同的功能，就只能再复制粘贴一次，这可不是个好主意。</p>
<blockquote>
<p>这就好像我要往东去100公里。我不会往东一头把车开进树林，而是先往北开20公里上高速，然后再向东开100公里。后者的速度比前者要快上3倍。如果有人催着你“赶快直接去那儿”，有时你需要说：“等等，我要先看看地图，找出最快的路径。”这就是预备性重构于我的意义。</p>
<p>——Jessica Kerr</p>
</blockquote>
<p>修复bug时的情况也是一样。在寻找问题根因时，我可能会发现：如果把3段一模一样且都会导致错误的代码合并到一处，问题修复起来会容易得多。或者，如果把某些更新数据的逻辑与查询逻辑分开，会更容易避免造成错误的逻辑纠缠。用重构改善这些情况，在同样场合再次出现同样bug的概率也会降低。</p>
<h2 id="帮助理解的重构：使代码更易懂"><a href="#帮助理解的重构：使代码更易懂" class="headerlink" title="帮助理解的重构：使代码更易懂"></a>帮助理解的重构：使代码更易懂</h2><p><strong>我需要先理解代码在做什么，然后才能着手修改。</strong>这段代码可能是我写的，也可能是别人写的。一旦我需要思考“这段代码到底在做什么”，我就会自问：能不能重构这段代码，令其一目了然？我可能看见了一段结构糟糕的条件逻辑，也可能希望复用一个函数，但花费了几分钟才弄懂它到底在做什么，因为它的函数命名实在是太糟糕了。这些都是重构的机会。</p>
<p>看代码时，我会在脑海里形成一些理解，但我的记性不好，记不住那么多细节。正如 Ward Cunningham 所说，通过重构，我就把脑子里的理解转移到了代码本身。随后我运行这个软件，看它是否正常工作，来检查这些理解是否正确。如果把对代码的理解植入代码中，这份知识会保存得更久，并且我的同事也能看到。</p>
<p><strong>重构带来的帮助不仅发生在将来——常常是立竿见影。</strong>是我会先在一些小细节上使用重构来帮助理解，给一两个变量改名，让它们更清楚地表达意图，以方便理解，或是将一个长函数拆成几个小函数。<strong>当代码变得更清晰一些时，我就会看见之前看不见的设计问题。</strong>如果不做前面的重构，我可能永远都看不见这些设计问题，因为我不够聪明，无法在脑海中推演所有这些变化。Ralph Johnson说，这些初步的重构就像扫去窗上的尘埃，使我们得以看到窗外的风景。在研读代码时，重构会引领我获得更高层面的理解，如果只是阅读代码很难有此领悟。有些人以为这些重构只是毫无意义地把玩代码，他们没有意识到，缺少了这些细微的整理，他们就无法看到隐藏在一片混乱背后的机遇。</p>
<h2 id="捡垃圾式重构"><a href="#捡垃圾式重构" class="headerlink" title="捡垃圾式重构"></a>捡垃圾式重构</h2><p>帮助理解的重构还有一个变体：我已经理解代码在做什么，但发现它做得不好，例如逻辑不必要地迂回复杂，或者两个函数几乎完全相同，可以用一个参数化的函数取而代之。这里有一个取舍：我不想从眼下正要完成的任务上跑题太多，但我也不想把垃圾留在原地，给将来的修改增加麻烦。如果我发现的垃圾很容易重构，我会马上重构它；如果重构需要花一些精力，我可能会拿一张便笺纸把它记下来，完成当下的任务再回来重构它。</p>
<p>当然，有时这样的垃圾需要好几个小时才能解决，而我又有更紧急的事要完成。不过即便如此，稍微花一点工夫做一点儿清理，通常都是值得的。正如野营者的老话所说：至少要让营地比你到达时更干净。如果每次经过这段代码时都把它变好一点点，积少成多，垃圾总会被处理干净。重构的妙处就在于，每个小步骤都不会破坏代码——所以，有时一块垃圾在好几个月之后才终于清理干净，但即便每次清理并不完整，代码也不会被破坏。</p>
<h2 id="有计划的重构和见机行事的重构"><a href="#有计划的重构和见机行事的重构" class="headerlink" title="有计划的重构和见机行事的重构"></a>有计划的重构和见机行事的重构</h2><p>上面的例子——预备性重构、帮助理解的重构、捡垃圾式重构——都是见机行事的：我并不专门安排一段时间来重构，而是在添加功能或修复 BUG 的同时顺便重构。这是我自然的编程流的一部分。不管是要添加功能还是修复 BUG，重构对我当下的任务有帮助，而且让我未来的工作更轻松。这是一件很重要而又常被误解的事：<strong>重构不是与编程割裂的行为。</strong>你不会专门安排时间重构，正如你不会专门安排时间写 <code>if</code> 语句。我的项目计划上没有专门留给重构的时间，绝大多数重构都在我做其他事的过程中自然发生。</p>
<p><strong>还有一种常见的误解认为，重构就是人们弥补过去的错误或者清理肮脏的代码。</strong>当然，如果遇上了肮脏的代码，你必须重构，但漂亮的代码也需要很多重构。在写代码时，我会做出很多权衡取舍：参数化需要做到什么程度？函数之间的边界应该划在哪里？对于昨天的功能完全合理的权衡，在今天要添加新功能时可能就不再合理。好在，当我需要改变这些权衡以反映现实情况的变化时，整洁的代码重构起来会更容易。</p>
<p>长久以来，人们认为编写软件是一个累加的过程：要添加新功能，我们就应该增加新代码。但优秀的程序员知道，<strong>添加新功能最快的方法往往是先修改现有的代码，使新功能容易被加入。</strong>所以，软件永远不应该被视为“完成”。每当需要新能力时，软件就应该做出相应的改变。越是在已有代码中，这样的改变就越显重要。</p>
<p>不过，说了这么多，并不表示有计划的重构总是错的。如果团队过去忽视了重构，那么常常会需要专门花一些时间来优化代码库，以便更容易添加新功能。在重构上花一个星期的时间，会在未来几个月里发挥价值。有时，即便团队做了日常的重构，还是会有问题在某个区域逐渐累积长大，最终需要专门花些时间来解决。但这种有计划的重构应该很少，大部分重构应该是不起眼的、见机行事的。</p>
<h2 id="长期重构"><a href="#长期重构" class="headerlink" title="长期重构"></a>长期重构</h2><p>大多数重构可以在几分钟—最多几小时—内完成。但有一些大型的重构可能要花上几个星期，例如要替换一个正在使用的库，或者将整块代码抽取到一个组件中并共享给另一支团队使用，再或者要处理一大堆混乱的依赖关系，等等。</p>
<p>即便在这样的情况下，我仍然不愿让一支团队专门做重构。<strong>可以让整个团队达成共识，在未来几周时间里逐步解决这个问题，这经常是一个有效的策略。</strong>每当有人靠近“重构区”的代码，就把它朝想要改进的方向推动一点。这个策略的好处在于，重构不会破坏代码—每次小改动之后，整个系统仍然照常工作。例如，如果想替换掉一个正在使用的库，可以先引入一层新的抽象，使其兼容新旧两个库的接口。一旦调用方已经完全改为使用这层抽象，替换下面的库就会容易得多。（这个策略叫作Branch By Abstraction[mf-bba]。）</p>
<h2 id="复审代码时重构"><a href="#复审代码时重构" class="headerlink" title="复审代码时重构"></a>复审代码时重构</h2><p>至于如何在代码复审的过程中加入重构，这要取决于复审的形式。在常见的pull request模式下，复审者独自浏览代码，代码的作者不在旁边，此时进行重构效果并不好。如果代码的原作者在旁边会好很多，因为作者能提供关于代码的上下文信息，并且充分认同复审者进行修改的意图。对我个人而言，与原作者肩并肩坐在一起，一边浏览代码一边重构，体验是最佳的。这种工作方式很自然地导向<strong>结对编程</strong>：在编程的过程中持续不断地进行代码复审。</p>
<h1 id="三、坏代码长什么样？"><a href="#三、坏代码长什么样？" class="headerlink" title="三、坏代码长什么样？"></a>三、坏代码长什么样？</h1><hr>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E3%80%8A%E9%87%8D%E6%9E%84-%E6%94%B9%E5%96%84%E6%97%A2%E6%9C%89%E4%BB%A3%E7%A0%81%E7%9A%84%E8%AE%BE%E8%AE%A1%E3%80%8B%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/7896890-34365af51f860981.png" alt=""></p>
<p>这让我想起之前在捧读《阿里巴巴 Java 开发手册》时学习的代码规范的问题（<a href="https://www.jianshu.com/p/dcf388fc3f1d" target="_blank" rel="noopener">传送门</a>）<br>，只不过当时学习的是好的代码应该长什么样，而现在讨论的事情是：坏的代码长什么样？</p>
<p>其实大部分的情况应该作为程序员的我们都有一定的共识，所以我觉得简单列一下书中提到的情况就足以说明：</p>
<ul>
<li><p><strong>神秘命名</strong></p>
</li>
<li><p><strong>重复代码</strong></p>
</li>
<li><p><strong>过长函数</strong></p>
</li>
<li><p><strong>过长参数列表</strong></p>
</li>
<li><p><strong>全局数据：</strong> 全局数据的问题在于，从代码库的任何一个角落都可以修改它，而且没有任何机制可以探测出到底哪段代码做出了修改。一次又一次，全局数据造成了一些诡异的 BUG，而问题的根源却在遥远的别处。</p>
</li>
<li><p><strong>可变数据：</strong> 对数据的修改经常导致出乎意料的结果和难以发现的 BUG。我在一处更新数据，却没有意识到软件中的另一处期望着完全不同的数据。</p>
</li>
<li><p><strong>发散式变化：</strong> 模块经常因为不同的原因在不同的方向上发生变化。</p>
</li>
<li><p><strong>散弹式修改：</strong> 每遇到某种变化，你都必须在许多不同的类内做出许多小修改。</p>
</li>
<li><p><strong>依恋情结：</strong> 所谓模块化，就是力求将代码分出区域，最大化区域内部的交互、最小化跨区域的交互。但有时你会发现，一个函数跟另一个模块中的函数或者数据交流格外频繁，远胜于在自己所处模块内部的交流。</p>
</li>
<li><p><strong>数据泥团：</strong> 你经常在很多地方看到相同的三四项数据：两个类中相同的字段、许多函数签名中相同的参数。</p>
</li>
<li><p><strong>基本类型偏执：</strong> 很多程序员不愿意创建对自己的问题域有用的基本类型，如钱、坐标、范围等。</p>
</li>
<li><p><strong>重复的 switch：</strong> 在不同的地方反复使用相同的 switch 逻辑。问题在于：每当你想增加一个选择分支时，必须找到所有的 switch，并逐一更新。</p>
</li>
<li><p><strong>循环语句：</strong> 我们发现，管道操作（如 filter 和 map）可以帮助我们更快地看清被处理的元素一级处理它们的动作。</p>
</li>
<li><p><strong>冗余的元素</strong></p>
</li>
<li><p><strong>夸夸其谈通用性：</strong> 函数或类的唯一用户是测试用例。</p>
</li>
<li><p><strong>临时字段：</strong> 有时你会看到这样的类：其内部某个字段仅为某种特定情况而定。这样的代码让人不理解，因为你通常认为对象在所有时候都需要它的所有字段。在字段未被使用的情况下猜测当初设置它的目的，会让你发疯。</p>
</li>
<li><p><strong>过长的消息链</strong></p>
</li>
<li><p><strong>中间人：</strong> 过度运用委托。</p>
</li>
<li><p><strong>内幕交易：</strong> 软件开发者喜欢在模块之间筑起高墙，极其反感在模块之间大量交换数据，因为这会增加模块间的耦合。在实际情况里，一定的数据交换不可避免，但我们必须尽量减少这种情况，并把这种交换都放到明面上来。</p>
</li>
<li><p><strong>过大的类</strong></p>
</li>
<li><p><strong>异曲同工的类</strong></p>
</li>
<li><p><strong>纯数据类：</strong> 所谓纯数据类是指：他们拥有一些字段，以及用于访问（读写）这些字段的函数，除此之外一无长物。纯数据类常常意味着行为被放在了错误的地方。也就是说，只要把处理数据的行为从客户端搬移到纯数据类里来，就能使情况大为改观。</p>
</li>
<li><p><strong>被拒绝的遗赠：</strong> 拒绝继承超类的实现，我们不介意：但如果拒绝支持超类的接口，这就难以接受了。</p>
</li>
<li><p><strong>注释：</strong> 当你感觉需要纂写注释时，请先尝试重构，试着让所有注释都变得多余。</p>
</li>
</ul>
<h1 id="四、重构的一些方法"><a href="#四、重构的一些方法" class="headerlink" title="四、重构的一些方法"></a>四、重构的一些方法</h1><hr>
<p>书中花了大量的章节介绍我们应该如何重构我们的程序，<strong>有几个关键的点</strong>是我自己能够提炼出来的：<strong>找出代码中不合理的地方、结构化、容易理解、测试确保正确。</strong>总之围绕这几个点，书中介绍了大量的方法，下面结合自己的一些理解来简单概述一下吧。</p>
<h2 id="结构化代码"><a href="#结构化代码" class="headerlink" title="结构化代码"></a>结构化代码</h2><p>结构化的代码更加便于我们阅读和理解，例如最常使用的重构方法：<strong>提炼函数</strong></p>
<ul>
<li><strong>动机：把意图和实现分开</strong></li>
</ul>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">void</span> <span class="token function">printOwing</span><span class="token punctuation">(</span>double amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token comment" spellcheck="true">//print details</span>
     System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"name:"</span> <span class="token operator">+</span> _name<span class="token punctuation">)</span><span class="token punctuation">;</span>
     System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"amount"</span> <span class="token operator">+</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span></code></pre>
<p>=&gt;</p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">void</span> <span class="token function">printOwing</span><span class="token punctuation">(</span>double amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token function">printDetails</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">void</span> printDetails <span class="token punctuation">(</span>double amount<span class="token punctuation">)</span> <span class="token punctuation">{</span>
     System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"name:"</span> <span class="token operator">+</span> _name<span class="token punctuation">)</span><span class="token punctuation">;</span>
     System<span class="token punctuation">.</span>out<span class="token punctuation">.</span>println <span class="token punctuation">(</span><span class="token string">"amount"</span> <span class="token operator">+</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span></code></pre>
<h2 id="更清楚的表达用意"><a href="#更清楚的表达用意" class="headerlink" title="更清楚的表达用意"></a>更清楚的表达用意</h2><p>要保持软件的 KISS 原则是不容易的，但是也有一些方法可以借鉴，例如：<strong>引入解释性变量</strong></p>
<p><strong>动机：用一个良好命名的临时变量来解释对应条件子句的意义，使语义更加清晰。</strong></p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token punctuation">(</span>platform<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"MAC"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
     <span class="token punctuation">(</span>browser<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"IE"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
      <span class="token function">wasInitialized</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> resize <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">)</span>
<span class="token punctuation">{</span>
     <span class="token comment" spellcheck="true">// do something</span>
<span class="token punctuation">}</span></code></pre>
<p>=&gt;</p>
<pre class=" language-javascript"><code class="language-javascript">   final boolean isMacOs     <span class="token operator">=</span> platform<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"MAC"</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   final boolean isIEBrowser <span class="token operator">=</span> browser<span class="token punctuation">.</span><span class="token function">toUpperCase</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"IE"</span><span class="token punctuation">)</span>  <span class="token operator">></span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
   final boolean wasResized  <span class="token operator">=</span> resize <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>isMacOs <span class="token operator">&amp;&amp;</span> isIEBrowser <span class="token operator">&amp;&amp;</span> <span class="token function">wasInitialized</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> wasResized<span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment" spellcheck="true">// do something</span>
   <span class="token punctuation">}</span></code></pre>
<p>另外由于 lambda 表达式的盛行，我们现在有一些更加优雅易读的方法使我们的代码保持可读：<strong>以管道取代循环</strong>就是这样一种方法。</p>
<pre class=" language-javascript"><code class="language-javascript">   <span class="token keyword">const</span> names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
   <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> i <span class="token keyword">of</span> input<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token punctuation">.</span>job <span class="token operator">===</span> <span class="token string">"programer"</span><span class="token punctuation">)</span>
         names<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>i<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span></code></pre>
<p>=&gt;</p>
<pre class=" language-javasceript"><code class="language-javasceript">   const names = input
      .filter(i => i.job === "programer")
      .map(i => i.name)
   ;</code></pre>
<h2 id="合理的组织结构"><a href="#合理的组织结构" class="headerlink" title="合理的组织结构"></a>合理的组织结构</h2><p>例如上面介绍的<strong>提炼函数</strong>的方法，固然是一种很好的方式，但也应该避免过度的封装，如果别人使用了太多间接层，使得系统中的所有函数都似乎只是对另一个函数的简单委托（delegation），造成我在这些委托动作之间晕头转向，并且内部代码和函数名称同样清晰易读，那么就应该考虑<strong>内联函数。</strong></p>
<p><strong>动机：①去处不必要的间接性；②可以找出有用的间接层。</strong></p>
<pre class=" language-javascript"><code class="language-javascript"> int <span class="token function">getRating</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">moreThanFiveLateDeliveries</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 boolean <span class="token function">moreThanFiveLateDeliveries</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> _numberOfLateDeliveries <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span></code></pre>
<p>=&gt;</p>
<pre class=" language-javascript"><code class="language-javascript"> int <span class="token function">getRating</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token punctuation">(</span>_numberOfLateDeliveries <span class="token operator">></span> <span class="token number">5</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token number">2</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span></code></pre>
<h2 id="合理的封装"><a href="#合理的封装" class="headerlink" title="合理的封装"></a>合理的封装</h2><p>封装能够帮助我们<strong>隐藏细节</strong>并且，能够<strong>更好的应对变化</strong>，当我们发现我们的类太大而不容易理解的时候，可以考虑使用<strong>提炼类</strong>的方法。</p>
<p><strong>动机：类太大而不容易理解。</strong></p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
     <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span></code></pre>
<p>=&gt;</p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
     <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">class</span> <span class="token class-name">TelephoneNumber</span> <span class="token punctuation">{</span>
     <span class="token keyword">get</span> <span class="token function">areaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token keyword">get</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span></code></pre>
<p>反过来，如果我们发现<strong>一个类不再承担足够责任，不再有单独存在的理由</strong>的时候，我们会进行反向重构：<strong>内敛类</strong></p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
     <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_telephoneNumber<span class="token punctuation">.</span>number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 <span class="token keyword">class</span> <span class="token class-name">TelephoneNumber</span> <span class="token punctuation">{</span>
     <span class="token keyword">get</span> <span class="token function">areaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_areaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token keyword">get</span> <span class="token function">number</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_number<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span></code></pre>
<p>=&gt;</p>
<pre class=" language-javascript"><code class="language-javascript"> <span class="token keyword">class</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
     <span class="token keyword">get</span> <span class="token function">officeAreaCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeAreaCode<span class="token punctuation">;</span> <span class="token punctuation">}</span>
     <span class="token keyword">get</span> <span class="token function">officeNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>_officeNumber<span class="token punctuation">;</span> <span class="token punctuation">}</span>
 <span class="token punctuation">}</span></code></pre>
<h2 id="简化条件表达式"><a href="#简化条件表达式" class="headerlink" title="简化条件表达式"></a>简化条件表达式</h2><p><strong>分解条件式：</strong> 我们能通过<strong>提炼代码</strong>，把一段 「复杂的条件逻辑」 分解成多个独立的函数，这样就能更加清楚地表达自己的意图。</p>
<pre class=" language-javascript"><code class="language-javascript">     <span class="token keyword">if</span> <span class="token punctuation">(</span>date<span class="token punctuation">.</span>before <span class="token punctuation">(</span>SUMMER_START<span class="token punctuation">)</span> <span class="token operator">||</span> date<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>SUMMER_END<span class="token punctuation">)</span><span class="token punctuation">)</span>
         charge <span class="token operator">=</span> quantity <span class="token operator">*</span> _winterRate <span class="token operator">+</span> _winterServiceCharge<span class="token punctuation">;</span>
     <span class="token keyword">else</span> charge <span class="token operator">=</span> quantity <span class="token operator">*</span> _summerRate<span class="token punctuation">;</span></code></pre>
<p>=&gt;</p>
<pre class=" language-javascript"><code class="language-javascript">     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">notSummer</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">)</span>
         charge <span class="token operator">=</span> <span class="token function">winterCharge</span><span class="token punctuation">(</span>quantity<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token keyword">else</span> charge <span class="token operator">=</span> summerCharge <span class="token punctuation">(</span>quantity<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>另外一个比较受用的一条建议就是：<strong>以卫语句取代嵌套条件式。</strong>根据经验，条件式通常有两种呈现形式。第一种形式是：所有分支都属于正常行为。第二种形式则是：条件式提供的答案中只有一种是正常行为，其他都是不常见的情况。</p>
<p><strong>精髓是：给某一条分支以特别的重视。</strong>如果使用 <code>if-then-else</code> 结构，你对 <code>if</code>  分支和 <code>else</code> 分支的重视是同等的。 这样的代码结构传递给阅读者的消息就是：各个分支有同样的重要性。卫语句（guard clauses）就不同了，它告诉阅读者：「这种情况很罕见，如果它真的发生了，请做 一些必要的整理工作，然后退出。」</p>
<p>「每个函数只能有一个入口和一个出口」的观念，根深蒂固于某些程序员的脑海里。 我发现，当我处理他们编写的代码时，我经常需要使用 Replace Nested Conditional with Guard Clauses。现今的编程语言都会强制保证每个函数只有一个入口， 至于「单一出口」规则，其实不是那么有用。在我看来，保持代码清晰才是最关键的：如果「单一出口」能使这个函数更清楚易读，那么就使用单一出口；否则就不必这么做。</p>
<pre class=" language-javascript"><code class="language-javascript"> double <span class="token function">getPayAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   double result<span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>_isDead<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token function">deadAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">else</span> <span class="token punctuation">{</span>
       <span class="token keyword">if</span> <span class="token punctuation">(</span>_isSeparated<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token function">separatedAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token keyword">if</span> <span class="token punctuation">(</span>_isRetired<span class="token punctuation">)</span> result <span class="token operator">=</span> <span class="token function">retiredAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
           <span class="token keyword">else</span> result <span class="token operator">=</span> <span class="token function">normalPayAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token punctuation">}</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
 <span class="token keyword">return</span> result<span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<p>=&gt;</p>
<pre class=" language-javascript"><code class="language-javascript"> double <span class="token function">getPayAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>_isDead<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">deadAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>_isSeparated<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">separatedAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>_isRetired<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token function">retiredAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> <span class="token function">normalPayAmount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span></code></pre>
<h2 id="自我测试代码"><a href="#自我测试代码" class="headerlink" title="自我测试代码"></a>自我测试代码</h2><p>如果认真观察<strong>程序员把最多时间耗在哪里</strong>，你就会发现，编写代码其实只占非常小的一部分。有些时间用来决定下一步干什么，另一些时间花在设计上面，<strong>最多的时间则是用来调试（debug)</strong>。每个程序员都能讲出「花一整天（甚至更多）时间只找出一只小小臭虫」的故事。修复错误通常是比较快的，但找出错误却是噩梦一场。当你修好一个错误，总是会有另一个错误出现，而且肯定要很久以后才会注意到它。 彼时你又要花上大把时间去寻找它。</p>
<p>「频繁进行测试」是极限编程（ extreme programming XP）[Beck, XP]的重要一 环。「极限编程」一词容易让人联想起那些编码飞快、自由而散漫的黑客（hackers)， 实际上极限编程者都是十分专注的测试者。他们希望尽可能快速开发软件，而他们也知道「测试」可协助他们尽可能快速地前进。</p>
<p>在重构之前，先保证一组可靠的测试用例（有自我检验的能力），这不仅有助于我们检测 BUG，其中也有一种<strong>以终为始</strong>的思想在里面，实际上，我们可以通过编写测试用例，更加清楚我们最终的函数应该长什么样子，提供什么样的服务。</p>
<h1 id="结束语"><a href="#结束语" class="headerlink" title="结束语"></a>结束语</h1><hr>
<p>感谢您的耐心阅读，以上就是整个学习的笔记了。</p>
<p>重构不是一个一蹴而就的事，需要长期的实践和经验才能够完成得很好。重构强调的是 Be Better，那在此之前我们首先需要先动起手来搭建我们的系统，而不要一味地“完美主义”，近些时间接触的敏捷式开发也正是这样的一种思想。</p>
<p>如果有兴趣阅读，这里只找到一份第一版可以在线阅读的地方，请自行食用吧：<a href="https://www.kancloud.cn/sstd521/refactor/194190" target="_blank" rel="noopener">https://www.kancloud.cn/sstd521/refactor/194190</a></p>
<hr>
<p>按照惯例黏一个尾巴：</p>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2019/06/07/shi-me-shi-wei-fu-wu/">
      什么是微服务？
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%BE%AE%E6%9C%8D%E5%8A%A1/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>JavaWeb进阶/微服务</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2019年6月7日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%9F/7896890-0e2fe40609ddc444.png" alt=""></p>
<blockquote>
<p><strong>前言：</strong>起初没有意识到自己选了这么一个对自己来说有一些“宏大”的问题，因为里面涉及到好多知识..所以砍了一些内容..</p>
</blockquote>
<h1 id="一、信息技术发展趋势"><a href="#一、信息技术发展趋势" class="headerlink" title="一、信息技术发展趋势"></a>一、信息技术发展趋势</h1><hr>
<h2 id="信息技术发展的三个阶段"><a href="#信息技术发展的三个阶段" class="headerlink" title="信息技术发展的三个阶段"></a>信息技术发展的三个阶段</h2><p>信息技术从出现到逐渐成为主流，主要经历了<strong>软件、开源、云</strong>三个阶段的发展。从软件到开源，再到云，这也是信息技术的发展趋势。</p>
<h3 id="1-软件改变世界"><a href="#1-软件改变世界" class="headerlink" title="1. 软件改变世界"></a>1. 软件改变世界</h3><p>纵观人类社会漫长的发展历史，农耕时代、工业时代与信息时代可谓是明显的三个分水岭，每个时代都会出现很多新兴的领域，作为信息时代最重要的载体，互联网越来越成为当今社会关注的焦点，互联网的基石之一——<strong>软件，正在迅速地改变着这个世界。</strong></p>
<h3 id="2-开源改变软件"><a href="#2-开源改变软件" class="headerlink" title="2. 开源改变软件"></a>2. 开源改变软件</h3><p><strong>随着软件行业的成熟，相比于“重复造轮子”，“站在巨人的肩膀上”明显可以更加容易和快速地创造出优秀的新产品。</strong>随着开源文化越来越被认可，以及社区文化越来越成熟，使用优秀的开源产品作为基础架构来快速搭建系统以实现市场战略，成为当今最优的资源配比方案。</p>
<h3 id="3-云吞噬开源"><a href="#3-云吞噬开源" class="headerlink" title="3. 云吞噬开源"></a>3. 云吞噬开源</h3><p>仅通过开源产品搭建并运维一个高可用、高度弹性化的平台，进而实现互联网近乎100%的可用性，难度可想而知。因此，在提供技术思路的同时，<strong>进一步提供整套云解决方案以保证不断扩展的非功能需求，便成了当今新一代互联网平台的追求。</strong></p>
<p>随着用户集群规模的进一步加大，单纯的分布式系统已经难以驾驭，因此技术圈开启了一个概念爆发的时代——SOA、DevOps、容器、CI/CD、微服务、Service Mesh等概念层出不穷，而 Docker、Kubernetes、Mesos、Spring Cloud、Istio 等一系列产品的出现，标志着云时代已真正到来。</p>
<h2 id="互联网架构的核心问题"><a href="#互联网架构的核心问题" class="headerlink" title="互联网架构的核心问题"></a>互联网架构的核心问题</h2><h3 id="1-海量用户"><a href="#1-海量用户" class="headerlink" title="1. 海量用户"></a>1. 海量用户</h3><p>当今的互联网大潮，已经越来越难以估算用户量以及由此产生的自然数据增长有多少了，区别于我们日常的生活（例如商场，仅有 10 个人和有 1000 人的购物体验是明显不同的），<strong>企业如何做到无差别地为全世界所有的用户提供服务</strong>，成了一道难题。</p>
<h3 id="2-产品迅速迭代"><a href="#2-产品迅速迭代" class="headerlink" title="2. 产品迅速迭代"></a>2. 产品迅速迭代</h3><p>面对当今快速增长的业务和需求，<a href="http://www.ruanyifeng.com/blog/2019/03/agile-development.html" target="_blank" rel="noopener">敏捷开发</a>成为了热门的选择。在不断迭代的过程中，时间成本就显得尤为重要。如何敏捷地探知市场需求并将其实现，是互联网行业的立命之本。<strong>产品快速升级必然会推动、测试、交付甚至系统迅速迭代。</strong></p>
<h3 id="3-7x24-小时不间断服务"><a href="#3-7x24-小时不间断服务" class="headerlink" title="3. 7x24 小时不间断服务"></a>3. 7x24 小时不间断服务</h3><p>我们<strong>要保证应用全天候不间断的可用</strong>，必须要考虑到随时可能发生的意外，例如光缆挖断、机房失火等，每一次宕机都可能会造成巨大的损失。另外，如果系统设计得不够健壮，对其升级和维护时就要停止服务。频繁的系统升级同样会对系统可用性产生很大的影响。</p>
<p>虽然随时随处可用的难度非常大，但互联网应用会尽量缩短宕机时间。通常使用 3<del>5 个 9（3 个 9 即 99.9%，4 个 9 即 99.99%，5 个 9 即 99.999%）作为衡量系统可用性的指标，表示系统在 1 年的运行过程中可以正常使用的时间与总运行时间的比值，下面分别计算 3</del>5 个 9 指标下的全年宕机时间，感受一下它们的可靠性差异：</p>
<blockquote>
<p>3 个 9：（1 - 99.9%） x 365 x 24 = 8.76 小时<br>4 个 9：（1 - 99.99&amp;） x 365 x 24 = 52.6 分钟<br>4 个 9：（1 - 99.999&amp;） x 365 x 24 = 5.26 分钟</p>
</blockquote>
<h3 id="4-流量突增"><a href="#4-流量突增" class="headerlink" title="4. 流量突增"></a>4. 流量突增</h3><p>流量突增分为可预期型徒增和不可预期型徒增，像促销活动、有计划的热点事件等引起的流量突增属于前者，可以通过提前扩容、预案演练等方式精心为这些流量突增准备应对方案。而意料之外的热点事件（如地震）往往事发突然，系统来不及准备应对措施，因此若<strong>系统本身的可用性、弹性等非功能需求十分成熟</strong>，便可以在某种程度上应对这种突增。</p>
<h3 id="5-业务组合复杂"><a href="#5-业务组合复杂" class="headerlink" title="5. 业务组合复杂"></a>5. 业务组合复杂</h3><p><strong>很多互联网公司都是跨界巨头，我们知道，即使不跨界，在单一领域编织一个大规模的成型业务系统也并不简单。</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%9F/7896890-c751865f6c3ba7f6.png" alt=""></p>
<p>上图是我从 ProcessOn 模板里随便找的一张关于电商平台应用服务的架构图，可以看到里面交织了各种各样的业务，当行业的扩张速度超出预计的增长的时候，对底层支撑的考验要求也越来越高。</p>
<h1 id="二、什么是微服务"><a href="#二、什么是微服务" class="headerlink" title="二、什么是微服务"></a>二、什么是微服务</h1><hr>
<p>需要注意，<strong>“微服务”与“微服务架构”有着本质的区别：</strong> “微服务”强调的是服务的大小，它关注的是某一个点。而“微服务架构”则是一种架构思想，需要从整体上对软件系统进行通盘的考虑。</p>
<h2 id="架构的演变"><a href="#架构的演变" class="headerlink" title="架构的演变"></a>架构的演变</h2><p>要了解微服务是如何诞生的，我们有必要对架构的演变过程有一定的了解。上面已经对架构主要面临的问题进行了阐述，下面我们来了解一下架构是如何一步一步升级并转化到“云”上的。</p>
<h3 id="1-单体架构"><a href="#1-单体架构" class="headerlink" title="1. 单体架构"></a>1. 单体架构</h3><p>单体架构比较初级，典型的三级架构，前端(Web/手机端)+中间业务逻辑层+数据库层。这是一种典型的 MVC 框架的应用。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%9F/7896890-a313ce3aa78e98f1.png" alt=""></p>
<p>单体架构的应用比较容易部署、测试， 在项目的初期，单体应用可以很好地运行。然而，随着需求的不断增加， 越来越多的人加入开发团队，代码库也在飞速地膨胀。慢慢地，单体应用变得越来越臃肿，可维护性、灵活性逐渐降低，维护成本越来越高。下面是单体架构应用的一些缺点：</p>
<ul>
<li><p><strong>复杂性高：</strong> 以一个百万行级别的单体应用为例，整个项目包含的模块非常多、模块的边界模糊、 依赖关系不清晰、 代码质量参差不齐、 混乱地堆砌在一起。可想而知整个项目非常复杂。 每次修改代码都心惊胆战， 甚至添加一个简单的功能， 或者修改一个 Bug 都会带来隐含的缺陷。</p>
</li>
<li><p><strong>技术债务：</strong> 随着时间推移、需求变更和人员更迭，会逐渐形成应用程序的技术债务， 并且越积 越多。“ 不坏不修”， 这在软件开发中非常常见， 在单体应用中这种思想更甚。 已使用的系统设计或代码难以被修改，因为应用程序中的其他模块可能会以意料之外的方式使用它。</p>
</li>
<li><p><strong>部署频率低：</strong> 随着代码的增多，构建和部署的时间也会增加。而在单体应用中， 每次功能的变更或缺陷的修复都会导致需要重新部署整个应用。全量部署的方式耗时长、 影响范围大、 风险高， 这使得单体应用项目上线部署的频率较低。 而部署频率低又导致两次发布之间会有大量的功能变更和缺陷修复，出错率比较高。</p>
</li>
<li><p><strong>可靠性差：</strong> 某个应用Bug，例如死循环、内存溢出等， 可能会导致整个应用的崩溃。</p>
</li>
<li><p><strong>扩展能力受限：</strong> 单体应用只能作为一个整体进行扩展，无法根据业务模块的需要进行伸缩。例如，应用中有的模块是计算密集型的，它需要强劲的CPU； 有的模块则是IO密集型的，需要更大的内存。 由于这些模块部署在一起，不得不在硬件的选择上做出妥协。</p>
</li>
<li><p><strong>阻碍技术创新：</strong> 单体应用往往使用统一的技术平台或方案解决所有的问题， 团队中的每个成员 都必须使用相同的开发语言和框架，要想引入新框架或新技术平台会非常困难。</p>
</li>
</ul>
<h3 id="2-分布式架构"><a href="#2-分布式架构" class="headerlink" title="2. 分布式架构"></a>2. 分布式架构</h3><p>中级架构，分布式应用，中间层分布式 + 数据库分布式，是<strong>单体架构的并发扩展</strong>，将一个大的系统划分为多个业务模块，业务模块分别部署在不同的服务器上，各个业务模块之间通过接口进行数据交互。数据库也大量采用分布式数据库，如 Redis、Elasticsearch、Solor 等。通过 LVS/Nginx 代理应用，将用户请求均衡的负载到不同的服务器上。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%9F/7896890-3cd1fbfe9c15abbb.png" alt=""></p>
<p>该架构相对于单体架构来说，这种架构提供了负载均衡的能力，大大提高了系统负载能力，解决了网站高并发的需求。另外还有以下特点：</p>
<ul>
<li><p><strong>降低了耦合度：</strong> 把模块拆分,使用接口通信,降低模块之间的耦合度。</p>
</li>
<li><p><strong>责任清晰：</strong> 把项目拆分成若干个子项目,不同的团队负责不同的子项目。</p>
</li>
<li><p><strong>扩展方便：</strong> 增加功能时只需要再增加一个子项目,调用其他系统的接口就可以。</p>
</li>
<li><p><strong>部署方便：</strong> 可以灵活的进行分布式部署。</p>
</li>
<li><p><strong>提高代码的复用性：</strong> 比如 service 层，如果不采用分布式 REST 服务方式架构就会在手机 wap 商城，微信商城，PC，Android，IOS 每个端都要写一个 service 层逻辑，开发量大，难以维护一起升级，这时候就可以采用分布式 REST 服务方式，公用一个 service 层。</p>
</li>
</ul>
<p><strong>缺点：</strong> 系统之间的交互要使用远程通信,接口开发增大工作量,但是利大于弊。</p>
<h3 id="3-微服务架构"><a href="#3-微服务架构" class="headerlink" title="3. 微服务架构"></a>3. 微服务架构</h3><p>微服务架构，主要是中间层分解，将系统拆分成很多小应用（微服务），微服务可以部署在不同的服务器上，也可以部署在相同的服务器不同的容器上。当应用的故障不会影响到其他应用，单应用的负载也不会影响到其他应用，其代表框架有 Spring cloud、Dubbo 等。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AE%E6%9C%8D%E5%8A%A1%EF%BC%9F/7896890-9b4e0df4887f80d1.png" alt=""></p>
<ul>
<li><p><strong>易于开发和维护：</strong> 一个微服务只会关注一个特定的业务功能，所以它业务清晰、代码量较少。 开发和维护单个微服务相对简单。而整个应用是由若干个微服务构建而成的，所以整个应用也会被维持在一个可控状态。</p>
</li>
<li><p><strong>单个微服务启动较快：</strong> 单个微服务代码量较少， 所以启动会比较快。</p>
</li>
<li><p><strong>局部修改容易部署：</strong> 单体应用只要有修改，就得重新部署整个应用，微服务解决了这样的问题。 一般来说，对某个微服务进行修改，只需要重新部署这个服务即可。</p>
</li>
<li><p><strong>技术栈不受限：</strong> 在微服务架构中，可以结合项目业务及团队的特点，合理地选择技术栈。例如某些服务可使用关系型数据库MySQL；某些微服务有图形计算的需求，可以使用Neo4j；甚至可根据需要，部分微服务使用Java开发，部分微服务使用Node.js开发。</p>
</li>
</ul>
<p>微服务虽然有很多吸引人的地方，但它并不是免费的午餐，使用它是有代价的。使用微服务架构面临的挑战。</p>
<ul>
<li><p><strong>运维要求较高：</strong> 更多的服务意味着更多的运维投入。在单体架构中，只需要保证一个应用的正常运行。而在微服务中，需要保证几十甚至几百个服务服务的正常运行与协作，这给运维带来了很大的挑战。</p>
</li>
<li><p><strong>分布式固有的复杂性：</strong> 使用微服务构建的是分布式系统。对于一个分布式系统，系统容错、网络延迟、分布式事务等都会带来巨大的挑战。</p>
</li>
<li><p><strong>接口调整成本高：</strong> 微服务之间通过接口进行通信。如果修改某一个微服务的API，可能所有使用了该接口的微服务都需要做调整。</p>
</li>
<li><p><strong>重复劳动：</strong> 很多服务可能都会使用到相同的功能，而这个功能并没有达到分解为一个微服务的程度，这个时候，可能各个服务都会开发这一功能，从而导致代码重复。尽管可以使用共享库来解决这个问题（例如可以将这个功能封装成公共组件，需要该功能的微服务引用该组件），但共享库在多语言环境下就不一定行得通了。</p>
</li>
</ul>
<h3 id="4-Serverless-架构"><a href="#4-Serverless-架构" class="headerlink" title="4. Serverless 架构"></a>4. Serverless 架构</h3><p>当我们还在容器的浪潮中前行时，已经有一些革命先驱悄然布局另外一个云计算战场：Serverless 架构。</p>
<p>Serverless 架构能够让开发者在构建应用的过程中无需关注计算资源的获取和运维，由平台来按需分配计算资源并保证应用执行的SLA（服务等级协议），按照调用次数进行计费，有效的节省应用成本。</p>
<blockquote>
<p>由于该架构有一定的超前性，这里不做过多介绍，感兴趣的童鞋可以戳这里：<a href="https://jimmysong.io/posts/what-is-serverless/" target="_blank" rel="noopener">https://jimmysong.io/posts/what-is-serverless/</a></p>
</blockquote>
<h2 id="微服务定义"><a href="#微服务定义" class="headerlink" title="微服务定义"></a>微服务定义</h2><p>通过上面简单的介绍，我们了解了我们的架构是如何一步一步过渡到微服务的，为了解决单体应用的诸多问题，我们提出了<strong>分布式</strong>的概念，通过将单体应用拆分成诸多单独的模块来降低耦合以及提升系统性能，其实这里就涉及到一个<strong>服务化</strong>的概念，而<strong>微服务</strong>与之不同的是：</p>
<ul>
<li><strong>服务拆分粒度更细。</strong>微服务可以说是更细维度的服务化，小到一个子子模块，只要该模块依赖的资源与其他模块都没有关系，那么就可以拆分成一个微服务。</li>
<li><strong>服务独立部署。</strong>每个服务都严格遵循独立打包部署的准则，互不影响。比如一台物理机上可以部署多个 Docker 实例，每个 Docker 实例可以部署一个微服务的代码。</li>
<li><strong>服务独立维护。</strong>每个微服务都可以交由一个小团队甚至个人来开发、测试、发布和运维，并对整个生命周期负责。</li>
<li><strong>服务治理能力要求高。</strong>因为拆分为微服务之后，服务的数量变多，因此需要有统一的服务治理平台，来对各个服务进行管理。</li>
</ul>
<p>尽管微服务和微服务架构有所不同，但我们通常也可以简单理解为：</p>
<p><strong>微服务是一种软件架构风格，它是以专注于单一责任与功能的小型功能区块为基础</strong>，利用模组化的方式组合出复杂的大型应用程序，各功能区块使用与语言无关的 API（例如 REST）集相互通讯，且每个服务可以被单独部署，它具备以下三个核心特点：</p>
<ul>
<li><strong>微服务为大型系统而生。</strong>随着业务的快速增长，会带来系统流量压力和复杂度的上升，系统的可维护性和可扩展性成为架构设计的主要考虑因素，微服务架构设计理念通过小而美的业务拆分，通过分而自治来实现复杂系统的优雅设计实现。</li>
<li><strong>微服务架构是面向结果的。</strong>微服务架构设计风格的产生并非是出于学术或为标准而标准的设计，而是在软件架构设计领域不断演进过程中，面对实际工业界所遇到问题，而出现的面向解决实际问题的架构设计风格。</li>
<li><strong>专注于服务的可替代性来设计。</strong>微服务架构设计风格核心要解决的问题之一便是如何便利地在大型系统中进行系统组件的维护和替换，且不影响整体系统稳定性。</li>
</ul>
<h1 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h1><hr>
<p><a href="https://www.cnblogs.com/xiaoMzjm/p/5223799.html" target="_blank" rel="noopener">1. 浅谈web网站架构演变过程 - https://www.cnblogs.com/xiaoMzjm/p/5223799.html</a><br><a href="https://zhuanlan.zhihu.com/p/42115757" target="_blank" rel="noopener">2. 互联网架构演进之路 - https://zhuanlan.zhihu.com/p/42115757</a><br><a href="https://blog.csdn.net/xinyuan_java/article/details/88394332" target="_blank" rel="noopener">3. 四种软件架构演进史 - https://blog.csdn.net/xinyuan_java/article/details/88394332</a><br>4. 《未来架构 从服务化到云原生》 - 张亮 等著</p>
<blockquote>
<p>扩展阅读：<br><a href="http://p.primeton.com/articles/59b0f9244be8e61fea00be67" target="_blank" rel="noopener">1.微服务的4个设计原则和19个解决方案 - http://p.primeton.com/articles/59b0f9244be8e61fea00be67</a></p>
</blockquote>
<hr>
<p>按照惯例黏一个尾巴：</p>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
    
  </section>
  
    
      <br>
      <div class="prev-next">
        
        <p class="current">
          1 / 2
        </p>
        
          <a class="next" rel="next" href="/archives/2019/06/page/2/">
            <section class="post next white-box shadow">
              &nbsp;下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i>
            </section>
          </a>
        
      </div>
    
    <!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
    
    

  


	
</div>
<aside class='l_side'>
  
  
    
    

<section class="widget blogger shadow desktop mobile">
  <div class='content'>
    
      
        <a class='avatar flat-box rectangle' href='/about/'>
          <img no-lazy src='https://cdn.jsdelivr.net/gh/wmyskxz/img/img/common/avatar.png'/>
        </a>
      
    
    
      <div class='text'>
        
        
          <p>想做一个自由且自律的人，靠势必实现的决心认真地或者</p>

        
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml"
              class="social fas fa-rss flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@xxx.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/volantis-x/"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=260045301"
              class="social fas fa-headphones-alt flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

  

  
    
    
  

  <section class="widget category shadow desktop">
    
  <header>
    
      <a href='/blog/categories/'><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i><span class='name'>文章分类</span></a>
    
  </header>


    <div class='content'>
      <ul class="entry navigation">
        
          <li><a class="flat-box"
            title="/categories/Java-Web/" href="/categories/Java-Web/"
            id="categoriesJava-Web"
            ><div class='name'>Java Web</div><div class='badge'>(6)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Java-Web/Spring/" href="/categories/Java-Web/Spring/"
            id="categoriesJava-WebSpring"
            ><div class='name'>Spring</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Java-Web/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" href="/categories/Java-Web/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
            id="categoriesJava-WebE5ADA6E4B9A0E7AC94E8AEB0"
            ><div class='name'>学习笔记</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/"
            id="categoriesJavaWebE59FBAE7A180"
            ><div class='name'>JavaWeb基础</div><div class='badge'>(23)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SSM/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SSM/"
            id="categoriesJavaWebE59FBAE7A180SSM"
            ><div class='name'>SSM</div><div class='badge'>(5)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SSM/%E9%A1%B9%E7%9B%AE/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SSM/%E9%A1%B9%E7%9B%AE/"
            id="categoriesJavaWebE59FBAE7A180SSME9A1B9E79BAE"
            ><div class='name'>项目</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/Spring-MVC/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/Spring-MVC/"
            id="categoriesJavaWebE59FBAE7A180Spring-MVC"
            ><div class='name'>Spring MVC</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/Spring/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/Spring/"
            id="categoriesJavaWebE59FBAE7A180Spring"
            ><div class='name'>Spring</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SpringBoot/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SpringBoot/"
            id="categoriesJavaWebE59FBAE7A180SpringBoot"
            ><div class='name'>SpringBoot</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/%E9%A1%B9%E7%9B%AE/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/%E9%A1%B9%E7%9B%AE/"
            id="categoriesJavaWebE59FBAE7A180E9A1B9E79BAE"
            ><div class='name'>项目</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/"
            id="categoriesJavaWebE8BF9BE998B6"
            ><div class='name'>JavaWeb进阶</div><div class='badge'>(14)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/Spring-Boot/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/Spring-Boot/"
            id="categoriesJavaWebE8BF9BE998B6Spring-Boot"
            ><div class='name'>Spring Boot</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/Spring-Boot/%E9%A1%B9%E7%9B%AE/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/Spring-Boot/%E9%A1%B9%E7%9B%AE/"
            id="categoriesJavaWebE8BF9BE998B6Spring-BootE9A1B9E79BAE"
            ><div class='name'>项目</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E4%B8%AD%E9%97%B4%E4%BB%B6/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E4%B8%AD%E9%97%B4%E4%BB%B6/"
            id="categoriesJavaWebE8BF9BE998B6E4B8ADE997B4E4BBB6"
            ><div class='name'>中间件</div><div class='badge'>(5)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%89%8D%E7%AB%AF/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%89%8D%E7%AB%AF/"
            id="categoriesJavaWebE8BF9BE998B6E5898DE7ABAF"
            ><div class='name'>前端</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%89%8D%E7%AB%AF/Spring-Boot/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%89%8D%E7%AB%AF/Spring-Boot/"
            id="categoriesJavaWebE8BF9BE998B6E5898DE7ABAFSpring-Boot"
            ><div class='name'>Spring Boot</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"
            id="categoriesJavaWebE8BF9BE998B6E5BEAEE69C8DE58AA1"
            ><div class='name'>微服务</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/"
            id="categoriesJavaWebE8BF9BE998B6E69EB6E69E84E4B98BE8B7AF"
            ><div class='name'>架构之路</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E9%A1%B9%E7%9B%AE/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E9%A1%B9%E7%9B%AE/"
            id="categoriesJavaWebE8BF9BE998B6E9A1B9E79BAE"
            ><div class='name'>项目</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E9%A1%B9%E7%9B%AE/Spring-Boot/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E9%A1%B9%E7%9B%AE/Spring-Boot/"
            id="categoriesJavaWebE8BF9BE998B6E9A1B9E79BAESpring-Boot"
            ><div class='name'>Spring Boot</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Java%E5%9F%BA%E7%A1%80/" href="/categories/Java%E5%9F%BA%E7%A1%80/"
            id="categoriesJavaE59FBAE7A180"
            ><div class='name'>Java基础</div><div class='badge'>(15)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" href="/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"
            id="categoriesJavaE59FBAE7A180E5B9B6E58F91E7BC96E7A88B"
            ><div class='name'>并发编程</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Java%E5%9F%BA%E7%A1%80/%E9%9D%A2%E8%AF%95/" href="/categories/Java%E5%9F%BA%E7%A1%80/%E9%9D%A2%E8%AF%95/"
            id="categoriesJavaE59FBAE7A180E99DA2E8AF95"
            ><div class='name'>面试</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/MoreThanJava/" href="/categories/MoreThanJava/"
            id="categoriesMoreThanJava"
            ><div class='name'>MoreThanJava</div><div class='badge'>(12)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/MoreThanJava/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" href="/categories/MoreThanJava/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"
            id="categoriesMoreThanJavaE5A49AE7BABFE7A88B"
            ><div class='name'>多线程</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/MoreThanJava/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98/" href="/categories/MoreThanJava/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98/"
            id="categoriesMoreThanJavaE79FA5E4B98EE997AEE9A298"
            ><div class='name'>知乎问题</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Python/" href="/categories/Python/"
            id="categoriesPython"
            ><div class='name'>Python</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Python/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/" href="/categories/Python/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/"
            id="categoriesPythonE68782E4B880E782B9E7B3BBE58897"
            ><div class='name'>懂一点系列</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Redis/" href="/categories/Redis/"
            id="categoriesRedis"
            ><div class='name'>Redis</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Redis/%E4%B8%AD%E9%97%B4%E4%BB%B6/" href="/categories/Redis/%E4%B8%AD%E9%97%B4%E4%BB%B6/"
            id="categoriesRedisE4B8ADE997B4E4BBB6"
            ><div class='name'>中间件</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Ruby/" href="/categories/Ruby/"
            id="categoriesRuby"
            ><div class='name'>Ruby</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Spring-Cloud/" href="/categories/Spring-Cloud/"
            id="categoriesSpring-Cloud"
            ><div class='name'>Spring Cloud</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"
            id="categoriesE4B8ADE997B4E4BBB6"
            ><div class='name'>中间件</div><div class='badge'>(7)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/JavaWeb%E8%BF%9B%E9%98%B6/" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/JavaWeb%E8%BF%9B%E9%98%B6/"
            id="categoriesE4B8ADE997B4E4BBB6JavaWebE8BF9BE998B6"
            ><div class='name'>JavaWeb进阶</div><div class='badge'>(7)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%85%AC%E4%BC%97%E5%8F%B7%EF%BC%9Awmyskxz/" href="/categories/%E5%85%AC%E4%BC%97%E5%8F%B7%EF%BC%9Awmyskxz/"
            id="categoriesE585ACE4BC97E58FB7EFBC9Awmyskxz"
            ><div class='name'>公众号：wmyskxz</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%89%8D%E7%AB%AF/" href="/categories/%E5%89%8D%E7%AB%AF/"
            id="categoriesE5898DE7ABAF"
            ><div class='name'>前端</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E5%89%8D%E7%AB%AF/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/" href="/categories/%E5%89%8D%E7%AB%AF/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/"
            id="categoriesE5898DE7ABAFE68782E4B880E782B9E7B3BBE58897"
            ><div class='name'>懂一点系列</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%96%9C%E6%AC%A2%E7%9A%84%E4%B8%89%E8%A7%82/" href="/categories/%E5%96%9C%E6%AC%A2%E7%9A%84%E4%B8%89%E8%A7%82/"
            id="categoriesE5969CE6ACA2E79A84E4B889E8A782"
            ><div class='name'>喜欢的三观</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"
            id="categoriesE5A49AE7BABFE7A88B"
            ><div class='name'>多线程</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%A5%BD%E5%A5%87%E6%98%9F%E4%BA%BA/" href="/categories/%E5%A5%BD%E5%A5%87%E6%98%9F%E4%BA%BA/"
            id="categoriesE5A5BDE5A587E6989FE4BABA"
            ><div class='name'>好奇星人</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
            id="categoriesE5ADA6E4B9A0E7AC94E8AEB0"
            ><div class='name'>学习笔记</div><div class='badge'>(6)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Java%E8%BF%9B%E9%98%B6/" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Java%E8%BF%9B%E9%98%B6/"
            id="categoriesE5ADA6E4B9A0E7AC94E8AEB0JavaE8BF9BE998B6"
            ><div class='name'>Java进阶</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"
            id="categoriesE695B0E68DAEE7BB93E69E84E4B88EE7AE97E6B395"
            ><div class='name'>数据结构与算法</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E9%9D%A2%E8%AF%95/" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E9%9D%A2%E8%AF%95/"
            id="categoriesE695B0E68DAEE7BB93E69E84E4B88EE7AE97E6B395E99DA2E8AF95"
            ><div class='name'>面试</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E6%9C%89%E8%B6%A3%E9%9B%86%E4%B8%AD%E8%90%A5/" href="/categories/%E6%9C%89%E8%B6%A3%E9%9B%86%E4%B8%AD%E8%90%A5/"
            id="categoriesE69C89E8B6A3E99B86E4B8ADE890A5"
            ><div class='name'>有趣集中营</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/" href="/categories/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/"
            id="categoriesE69EB6E69E84E4B98BE8B7AF"
            ><div class='name'>架构之路</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E7%94%9F%E6%B4%BB/" href="/categories/%E7%94%9F%E6%B4%BB/"
            id="categoriesE7949FE6B4BB"
            ><div class='name'>生活</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/" href="/categories/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/"
            id="categoriesE7BC96E7A88BE4BABAE7949F"
            ><div class='name'>编程人生</div><div class='badge'>(5)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/%E9%9D%A2%E8%AF%95/" href="/categories/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/%E9%9D%A2%E8%AF%95/"
            id="categoriesE7BC96E7A88BE4BABAE7949FE99DA2E8AF95"
            ><div class='name'>面试</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E9%9D%A2%E8%AF%95/" href="/categories/%E9%9D%A2%E8%AF%95/"
            id="categoriesE99DA2E8AF95"
            ><div class='name'>面试</div><div class='badge'>(8)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E9%9D%A2%E8%AF%95/%E4%B8%AD%E9%97%B4%E4%BB%B6/" href="/categories/%E9%9D%A2%E8%AF%95/%E4%B8%AD%E9%97%B4%E4%BB%B6/"
            id="categoriesE99DA2E8AF95E4B8ADE997B4E4BBB6"
            ><div class='name'>中间件</div><div class='badge'>(1)</div></a></li>
        
      </ul>
    </div>
  </section>


  

  
    
    
  

  <section class="widget tagcloud shadow desktop mobile">
    
  <header>
    
      <a href='/blog/tags/'><i class="fas fa-tags fa-fw" aria-hidden="true"></i><span class='name'>热门标签</span></a>
    
  </header>


    <div class='content'>
      <a href="/tags/Docker/" style="font-size: 14px; color: #999">Docker</a> <a href="/tags/Elasticsearch/" style="font-size: 14px; color: #999">Elasticsearch</a> <a href="/tags/Java-Web/" style="font-size: 17.08px; color: #848484">Java Web</a> <a href="/tags/Java8/" style="font-size: 14px; color: #999">Java8</a> <a href="/tags/JavaWeb%E5%9F%BA%E7%A1%80/" style="font-size: 23.23px; color: #5a5a5a">JavaWeb基础</a> <a href="/tags/JavaWeb%E8%BF%9B%E9%98%B6/" style="font-size: 22.46px; color: #5f5f5f">JavaWeb进阶</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 21.69px; color: #656565">Java基础</a> <a href="/tags/Kafka/" style="font-size: 14px; color: #999">Kafka</a> <a href="/tags/MongoDB/" style="font-size: 14px; color: #999">MongoDB</a> <a href="/tags/MoreThanJava/" style="font-size: 20.92px; color: #6a6a6a">MoreThanJava</a> <a href="/tags/MyBatis/" style="font-size: 15.54px; color: #8f8f8f">MyBatis</a> <a href="/tags/Python/" style="font-size: 14px; color: #999">Python</a> <a href="/tags/React/" style="font-size: 14px; color: #999">React</a> <a href="/tags/Redis/" style="font-size: 20.15px; color: #6f6f6f">Redis</a> <a href="/tags/Ruby/" style="font-size: 14.77px; color: #949494">Ruby</a> <a href="/tags/SSM/" style="font-size: 17.08px; color: #848484">SSM</a> <a href="/tags/Shiro/" style="font-size: 14px; color: #999">Shiro</a> <a href="/tags/Spring/" style="font-size: 17.85px; color: #7f7f7f">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 17.85px; color: #7f7f7f">Spring Boot</a> <a href="/tags/Spring-Cloud/" style="font-size: 14px; color: #999">Spring Cloud</a> <a href="/tags/Spring-MVC/" style="font-size: 14px; color: #999">Spring MVC</a> <a href="/tags/Vue/" style="font-size: 14px; color: #999">Vue</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 21.69px; color: #656565">中间件</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 14.77px; color: #949494">代码规范</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15.54px; color: #8f8f8f">前端</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 24px; color: #555">原创</a> <a href="/tags/%E5%96%9C%E6%AC%A2%E7%9A%84%E4%B8%89%E8%A7%82/" style="font-size: 16.31px; color: #898989">喜欢的三观</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 14.77px; color: #949494">多线程</a> <a href="/tags/%E5%A5%BD%E5%A5%87%E6%98%9F%E4%BA%BA/" style="font-size: 15.54px; color: #8f8f8f">好奇星人</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 17.85px; color: #7f7f7f">学习笔记</a> <a href="/tags/%E5%AF%BC%E8%88%AA/" style="font-size: 14px; color: #999">导航</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 14.77px; color: #949494">并发编程</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 14px; color: #999">微服务</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 18.62px; color: #7a7a7a">总结</a> <a href="/tags/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/" style="font-size: 14.77px; color: #949494">懂一点系列</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 16.31px; color: #898989">数据结构与算法</a> <a href="/tags/%E6%9C%89%E8%B6%A3%E9%9B%86%E4%B8%AD%E8%90%A5/" style="font-size: 14px; color: #999">有趣集中营</a> <a href="/tags/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/" style="font-size: 14px; color: #999">架构之路</a> <a href="/tags/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98/" style="font-size: 14px; color: #999">知乎问题</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/" style="font-size: 17.08px; color: #848484">编程人生</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 14px; color: #999">翻译</a> <a href="/tags/%E7%BF%BB%E8%AF%91%E6%96%87/" style="font-size: 14px; color: #999">翻译文</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 21.69px; color: #656565">面试</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 19.38px; color: #747474">项目</a> <a href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" style="font-size: 14px; color: #999">领域驱动设计</a>
    </div>
  </section>


  

  


</aside>





	<!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
	

	


    </div>
    
  
  <footer class="clearfix">
    <br><br>
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:me@xxx.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/volantis-x/"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=260045301"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        本站使用
        <a href="https://github.com/volantis-x/hexo-theme-volantis/" target="_blank" class="codename">Volantis</a>
        作为主题，总访问量为
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          次
        
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © 2017-2020 XXX</a></p>

        </div>
      
    
  </footer>


    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <div>
    
      
  

  <div id="rightmenu-wrapper">
    <ul class="list-v rightmenu" id="rightmenu-content">
      <li class='option'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-text' onclick='document.execCommand("copy")'><i class='fa fa-copy fa-fw'></i>复制文本</a>
        <hr id='hr-text'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-href'><i class='fa fa-link fa-fw'></i>复制链接</a>
        <a class='vlts-menu opt fix-cursor-default' id='menu-open-href'><i class='fa fa-external-link-square-alt fa-fw'></i>在新标签页打开</a>
        <hr id='hr-href'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-src'><i class='fa fa-image fa-fw'></i>复制图片地址</a>
        <hr id='hr-src'>
      </li>
      <li class='navigation'>
        <a class='nav icon-only fix-cursor-default' onclick='history.back()'><i class='fa fa-arrow-left fa-fw'></i></a>
        <a class='nav icon-only fix-cursor-default' onclick='history.forward()'><i class='fa fa-arrow-right fa-fw'></i></a>
        <a class='nav icon-only fix-cursor-default' onclick='window.location.reload()'><i class='fa fa-redo fa-fw'></i></a>
        <a class='nav icon-only fix-cursor-default' href='/'><i class='fa fa-home fa-fw'></i></a>
      </li>
      <hr>
      
        
      
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://github.com/volantis-x/volantis-docs/
        
        
        
        
          id="https:githubcomvolantis-xvolantis-docs"
        >
        <i class='fa fa-code-branch fa-fw'></i> 本站源码
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://github.com/volantis-x/hexo-theme-volantis/
        
        
        
        
          id="https:githubcomvolantis-xhexo-theme-volantis"
        >
        <i class='fa fa-code-branch fa-fw'></i> 主题源码
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' 
        
        
        
          onclick="document.execCommand('print')"
        
        >
        <i class='fa fa-print fa-fw'></i> 打印页面
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          <li class='music name'>
            <p class='nav music-title fix-cursor-default'></p>
          </li>
          <li class='music ctrl'>
            <a class='nav icon-only backward fix-cursor-default' onclick='aplayerBackward()'><i class='fa fa-step-backward fa-fw'></i></a>
            <a class='nav icon-only toggle fix-cursor-default' onclick='aplayerToggle()'><i class='fa fa-play fa-fw'></i></a>
            <a class='nav icon-only forward fix-cursor-default' onclick='aplayerForward()'><i class='fa fa-step-forward fa-fw'></i></a>
          </li>
          <li class='music volume'>
            <a class='nav volume'>
              <div class="aplayer-volume-bar-wrap">
                <div class="aplayer-volume-bar fix-cursor-pointer">
                  <div class="aplayer-volume"></div>
                  <i class='left fa fa-volume-off fa-fw'></i>
                  <i class='right fa fa-volume-up fa-fw'></i>
                </div>
              </div>
            </a>
          </li>
        
      
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function (event) {
      if (event.ctrlKey) return true;
      if (/Android|webOS|BlackBerry/i.test(navigator.userAgent)) return true;
      return popMenu(event);
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      mymenu.style.left = event.clientX + "px"; // 获取鼠标位置
      mymenu.style.top = event.clientY + "px";
      mymenu.style.display = 'block';
      if (event.clientX * 2 > screenWidth) {
        menuContent.classList.add('left');
      } else {
        menuContent.classList.remove('left');
      }
      if (event.clientY * 2 > screenHeight) {
        menuContent.classList.add('top');
      } else {
        menuContent.classList.remove('top');
      }

      let hrText = document.getElementById('hr-text');
      let hrSrc = document.getElementById('hr-src');
      let hrHref = document.getElementById('hr-href');

      // 选中图片
      let copySrc = document.getElementById('menu-copy-src');
      if (copySrc != undefined) {
        if (event.target.currentSrc) {
          copySrc.style.display = 'block';
          copySrc.addEventListener("click", function (e) {
            copyString(event.target.currentSrc);
          },{once: true});
          hrSrc.style.display = 'block';
        } else {
          copySrc.style.display = 'none';
          hrSrc.style.display = 'none';
        }
      }

      // 选中按钮
      // 判断是不是按钮
      let href = '';
      if (event.path) {
        for (i = 0; i < event.path.length; i++) {
          if (event.path[i].href != undefined && event.path[i].href.length > 0) {
            href = event.path[i].href;
          }
        }
      }

      let copyText = document.getElementById('menu-copy-text');
      copyText.style.display = 'none';
      hrText.style.display = 'none';
      if (href.length == 0) {
        // 选中文本
        if (window.getSelection().toString()) {
          copyText.style.display = 'block';
          hrText.style.display = 'block';
        }
      }

      // 在新标签页打开
      let openHref = document.getElementById('menu-open-href');
      if (openHref != undefined) {
        if (href.length > 0) {
          openHref.style.display = 'block';
          openHref.addEventListener("click", function (e) {
            window.open(href);
          },{once: true});
          hrHref.style.display = 'block';
        } else {
          openHref.style.display = 'none';
          hrHref.style.display = 'none';
        }
      }
      // 复制链接
      let copyHref = document.getElementById('menu-copy-href');
      if (copyHref != undefined) {
        if (href.length > 0) {
          copyHref.style.display = 'block';
          copyHref.addEventListener("click", function (e) {
            copyString(href);
          },{once: true});
        } else {
          copyHref.style.display = 'none';
        }
      }

      // 有音乐播放器
      if (true == true) {
        // 如果有aplayer，初始化一下
      	try {
      		checkAPlayer();
          updateTitle();
      	} catch (error) {
      		console.log(error);
      	}
      }

      return false; // 该行代码确保系统自带的右键菜单不会被调出
    }
    function hideMenu() {
      document.getElementById('rightmenu-wrapper').style.display = 'none';
    }
    function copyString(str) {
      const input = document.createElement('input');
      input.setAttribute('readonly', 'readonly');
      document.body.appendChild(input);
      input.setAttribute('value', str);
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }
    document.execCommand('click');
  </script>


    
    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>



  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>



  <script async src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/001.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/002.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/003.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/004.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/005.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/006.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/012.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/016.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/019.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/033.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/034.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/035.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/038.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/039.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/042.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/046.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/051.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/052.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/054.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/056.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  <script>
    let APlayerController = new Object();
    APlayerController.id = '3175833810';  // 设定全局音乐播放ID
    APlayerController.volume = '0.7';
  </script>
  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  
    
<script src="/js/aplayer.js"></script>

  




  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
  function pjax_gitalk() {
    let pageUrl = $.trim($('#pjax-comment-path').text()) === "none" ? 
      decodeURI(window.location.pathname) : $.trim($('#pjax-comment-path').text());
    
    let ALLPATH = '';
    if(ALLPATH != '') pageUrl = ALLPATH;

    if (document.getElementById('gitalk-container') != null) {
      var gitalk = new Gitalk({
        clientID: "a9f57bed080703426741",
        clientSecret: "03fe7aec06a7794dedfcc123b6475f0231f6a0ce",
        repo: "wmyskxz.github.io",
        owner: "wmyskxz",
        admin: "wmyskxz",
        id: pageUrl,
        distractionFreeMode: false  // Facebook-like distraction free mode
      });
      gitalk.render('gitalk-container');
    }
  }

  $(function () {
    pjax_gitalk();
  });
</script>




<!-- darkmodejs -->


<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
</script>


<!-- scrollreveal -->

  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    function pjax_scrollrebeal() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '32px',
        duration: '800',
        interval: '20',
        scale: '1',
        easing: 'ease-out'
      });
    }

    $(function () {
      pjax_scrollrebeal();
    });
  </script>

<!-- ******************************** -->

<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  function pjax_fancybox() {
    $(".article-entry").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".article-entry").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  $(function () {
    pjax_fancybox();
  });
</script>

<!-- ******************************** -->


  
<script src="/js/app.js"></script>




  
    
<script src="/js/search.js"></script>

  



  <script defer src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js" data-pjax></script>



  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function () {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>





  
    
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
  




    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>

<!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <div id="loading-bar-wrapper"><script>NProgress.configure({parent:"#loading-bar-wrapper",trickleSpeed: 100})</script></div>
    <script>
      window.ShowLoading = function() {
        NProgress.start();
      };
      window.HideLoading = function() {
        NProgress.done();
      }
    </script>
  
</div>

<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      $.fancybox.close();    // 关闭弹窗
      $('.l_header .switcher .s-search').removeClass('active'); // 关闭移动端激活的搜索框
      $('.l_header').removeClass('z_search-open'); // 关闭移动端激活的搜索框
      $('.wrapper').removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      $('.s-top').unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
      window.ShowLoading();
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
      // 

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });

      try{
        pjax_fancybox();
        
          
          if ('.cover') {
            $('.cover').backstretch("resize");
          } else {
            $.backstretch("resize");
          }
        
        
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightBlock(block);
        });
        
        
          pjax_scrollrebeal();
        
        
          pjax_initCopyCode();
        
        
        
        
          pjax_gitalk();
        
        
        
      } catch (e) {
        console.log(e);
      }
      window.HideLoading();
    });

    document.addEventListener('pjax:error', function (e) {
      window.HideLoading();
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
</body>
</html>
