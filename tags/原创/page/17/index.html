<!DOCTYPE html>
<html>
<head hexo-theme='https://volantis.js.org/#3.0.0-rc.1'>
  <meta charset="utf-8">
  <!-- SEO相关 -->
  
    
      <meta name="robots" content="noindex,follow">
    
  
  <!-- 渲染优化 -->
  <meta name="renderer" content="webkit">
  <meta name="force-rendering" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
  <meta name="HandheldFriendly" content="True" >
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <!-- 页面元数据 -->
  
  <title>标签：原创 - 我没有三颗心脏的博客</title>
  

  

  <!-- feed -->
  

  <!-- import meta -->
  

  <!-- link -->
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.13/css/all.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/l-lin/font-awesome-animation/dist/font-awesome-animation.min.css">

  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">

  

  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.css">

  

  

  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.css">
  

  

  <!-- import link -->
  

  
    
      
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.18.1/styles/solarized-light.css">

    
  
  
    
<link rel="stylesheet" href="/css/style.css">

  

  
  
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body>
  
  
  
  <div class="cover-wrapper">
    <cover class='cover ' style="display: none;">
      <div class='cover-body'>
  <div class='a'>
    
    
      <p class="title">我没有三颗心脏</p>
    
    
      <p class="subtitle">分享知识&技术&成长&思考</p>
    
  </div>
  <div class='b'>
    
      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <input type="text" class="input u-search-input" placeholder="search here..." />
          <i class="icon fas fa-search fa-fw"></i>
        </form>
      </div>
    
    <div class='menu navigation search'>
      <div class='list-h'>
        
          
            <a href="/"
              
              
              id="home">
              <i class='fas fa-rss fa-fw'></i><p>博客</p>
            </a>
          
            <a href="/categories/"
              
              
              id="categories">
              <i class='fas fa-folder-open fa-fw'></i><p>分类</p>
            </a>
          
            <a href="/tags/"
              
              
              id="tags">
              <i class='fas fa-tags fa-fw'></i><p>标签</p>
            </a>
          
            <a href="/archives/"
              
              
              id="archives">
              <i class='fas fa-archive fa-fw'></i><p>归档</p>
            </a>
          
            <a href="/about/"
              
              
              id="about">
              <i class='fas fa-info-circle fa-fw'></i><p>关于</p>
            </a>
          
        
      </div>
    </div>
  </div>
</div>

      <div class="scroll-down" style="display: none;"><i class="fa fa-chevron-down scroll-down-effects"></i></div>
    </cover>
    <header class="l_header shadow blur">
  <div class='container'>
  <div class='wrapper'>
    <div class='nav-sub'>
      <p class="title"></p>
      <ul class='switcher nav-list-h m-phone' id="pjax-header-nav-list">
        <li><a class="s-comment fas fa-comments fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
          <li><a class="s-toc fas fa-list fa-fw" target="_self" href='javascript:void(0)'></a></li>
        
      </ul>
    </div>
		<div class="nav-main">
      
        
        <a class="title flat-box" target="_self" href='/'>
          
            <img no-lazy class='logo' src='https://cdn.jsdelivr.net/gh/volantis-x/cdn-org/blog/Logo-NavBar@3x.png'/>
          
          
          
        </a>
      

			<div class='menu navigation'>
				<ul class='nav-list-h m-pc'>
          
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
          
            
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
          
				</ul>
			</div>

      <div class="m_search">
        <form name="searchform" class="form u-search-form">
          <i class="icon fas fa-search fa-fw"></i>
          <input type="text" class="input u-search-input" placeholder="Search..." />
        </form>
      </div>

			<ul class='switcher nav-list-h m-phone'>
				
					<li><a class="s-search fas fa-search fa-fw" target="_self" href='javascript:void(0)'></a></li>
				
				<li>
          <a class="s-menu fas fa-bars fa-fw" target="_self" href='javascript:void(0)'></a>
          <ul class="menu-phone list-v navigation white-box">
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/
                  
                  
                  
                    id="home"
                  >
                  <i class='fas fa-rss fa-fw'></i>博客
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/categories/
                  
                  
                  
                    id="categories"
                  >
                  <i class='fas fa-folder-open fa-fw'></i>分类
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/tags/
                  
                  
                  
                    id="tags"
                  >
                  <i class='fas fa-tags fa-fw'></i>标签
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/archives/
                  
                  
                  
                    id="archives"
                  >
                  <i class='fas fa-archive fa-fw'></i>归档
                </a>
                
              </li>
            
          
            
              
            
              <li>
                <a class="menuitem flat-box faa-parent animated-hover" href=/about/
                  
                  
                  
                    id="about"
                  >
                  <i class='fas fa-info-circle fa-fw'></i>关于
                </a>
                
              </li>
            
          
            
          </ul>
        </li>
			</ul>
		</div>
	</div>
  </div>
</header>

  </div>
  


  <div class="l_body nocover">
    <div class='body-wrapper' id="pjax-container">
      
        <!--此文件用来存放一些不方便取值的变量--> 
<!--思路大概是将值藏到重加载的区域内--> 
 
 
 
<div id="pjax-data" style="display: none"> 
  <div id="pjax-ispage">false</div> 
  <div id="pjax-pageTitle"></div> 
  <div id="pjax-enable-cover">true</div> 
  <div id="pjax-comment-path">none</div> 
  <div id="pjax-comment-placeholder">none</div> 
</div> 
 
 
<script> 
  // 处理封面 此时 jquery 还没加载 
  if ("none" == "none") { // 移除封面 
    document.getElementsByClassName('cover')[0].style.display = "none"; 
    document.getElementsByClassName('l_body')[0].classList.add("nocover"); 
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.add("show"); 
  } else { 
    if ("none" == "blog") { // 半屏 
      document.getElementsByClassName('cover')[0].classList.remove("full"); 
      document.getElementsByClassName('cover')[0].classList.add("half"); 
      document.getElementsByClassName('scroll-down')[0].style.display = "none"; 
    } else if ("none" == "docs") { // 全屏 
      document.getElementsByClassName('cover')[0].classList.remove("half"); 
      document.getElementsByClassName('cover')[0].classList.add("full"); 
      document.getElementsByClassName('scroll-down')[0].style.display = ""; 
    } 
    document.getElementsByClassName('cover')[0].style.display = ""; 
    document.getElementsByClassName('l_body', 'show')[0].classList.remove("nocover"); 
    document.getElementsByClassName('l_header', 'cover-wrapper')[0].classList.remove("show"); 
  } 
</script> 

      
      


<div class='l_main'>
  
    
      
  <section class="post-list ">
    
    
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2018/04/08/chu-xue-java-web-8-guo-lu-qi-he-jian-ting-qi/">
      初学Java Web(8)——过滤器和监听器
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/JavaWeb%E5%9F%BA%E7%A1%80/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>JavaWeb基础</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2018年4月8日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%888%EF%BC%89%E2%80%94%E2%80%94%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8/7896890-45e64864a52fc3b8.png" alt=""></p>
<h2 id="什么是过滤器"><a href="#什么是过滤器" class="headerlink" title="什么是过滤器"></a>什么是过滤器</h2><p><strong>过滤器就是 Servlet 的高级特性之一，</strong>就是一个具有<strong>拦截/过滤</strong>功能的一个东西，在生活中过滤器可以是香烟滤嘴，滤纸，净水器，空气净化器等，在 Web 中仅仅是一个<strong>实现了 Filter 接口的 Java 类</strong>而已。</p>
<ul>
<li><p><strong>特点：双向，拦截请求，拦截响应</strong><br><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%888%EF%BC%89%E2%80%94%E2%80%94%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8/7896890-e6d2758438da6a6f.png" alt=""></p>
</li>
<li><p><strong>作用：</strong><br>过滤器可以对<strong>所有的请求或者响应做拦截操作</strong></p>
</li>
</ul>
<h4 id="为什么在-Web-开发中需要用到过滤器？"><a href="#为什么在-Web-开发中需要用到过滤器？" class="headerlink" title="为什么在 Web 开发中需要用到过滤器？"></a>为什么在 Web 开发中需要用到过滤器？</h4><ul>
<li><strong>问题：</strong>为什么非得使用过滤器，我直接在 Servlet 中作判断不行吗？</li>
<li><strong>开发遵循的原则：</strong></li>
</ul>
<p><strong>1.DRY原则（Don’t Reeat Yourself，不要重复你自己）</strong>：重复，意味着维护的成本很高。<br><strong>2.责任分离原则：</strong>谁擅长什么功能就做什么功能，Servlet 擅长的是逻辑而不是处理请求</p>
<h4 id="举一个实际的例子：（处理-POST-请求中文编码的问题）"><a href="#举一个实际的例子：（处理-POST-请求中文编码的问题）" class="headerlink" title="举一个实际的例子：（处理 POST 请求中文编码的问题）"></a>举一个实际的例子：（处理 POST 请求中文编码的问题）</h4><p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%888%EF%BC%89%E2%80%94%E2%80%94%E8%BF%87%E6%BB%A4%E5%99%A8%E5%92%8C%E7%9B%91%E5%90%AC%E5%99%A8/7896890-b2d6af2506b2f548.png" alt=""></p>
<ul>
<li><strong>Web 中过滤器的作用：</strong></li>
</ul>
<p><strong>1.可以在请求资源之前设置请求的编码</strong><br><strong>2.可以进行登录校验</strong><br><strong>3.可以进行请求参数的内容的过滤</strong><br><strong>4.数据压缩 / 数据加密 / 数据格式的转换</strong><br>5.可以设置浏览器相关的数据</p>
<h4 id="Filter-的开发和使用"><a href="#Filter-的开发和使用" class="headerlink" title="Filter 的开发和使用"></a>Filter 的开发和使用</h4><p>对应于 Servlet 的开发步骤：</p>
<ol>
<li>定义一个类，实现 Filter 接口</li>
<li>在 <strong>doFilter()</strong> 方法中对<strong>请求</strong>和<strong>响应</strong>进行过滤</li>
<li>在 web.xml 文件中进行 Filter 的配置（告诉服务器来管理当前的 Filter）<pre><code>&lt;!-- web.xml --&gt;
&lt;filter&gt;
 &lt;filter-name&gt;filter的名称&lt;/filter-name&gt;
 &lt;filter-class&gt;filter类的全限定名&lt;/filter-class&gt;
&lt;/filter&gt;
&lt;filter-mapping&gt;
 &lt;filter-name&gt;指定对哪一个filter做的映射&lt;/filter-name&gt;
 &lt;url-pattern&gt;指定对哪些资源进行过滤&lt;/url-pattern&gt;
&lt;/filter-mapping&gt;</code></pre></li>
</ol>
<ul>
<li><strong>注意：</strong>此时 <code>&lt;url-pattern&gt;</code> 表示对哪些资源做过滤/拦截。例如：</li>
<li><code>/hello.jsp</code><br>当前 Filter 就仅仅只对 hello.jsp 资源做拦截.</li>
<li><code>/index</code><br>当前 Filter 就仅仅只对 /index 资源做拦截.</li>
<li><code>/*</code><br>当前 Filter 就对<strong>所有资源做拦截</strong>.访问任意的资源,都会先进入该过滤器器.</li>
<li><code>/system/*</code><br>当前 Filter 就对以 <code>/system/</code> 打头的资源做拦截.<br>如<code>/system</code> , <code>/system/a</code>,  <code>/system/a/b/c</code>, <code>/systema</code></li>
</ul>
<h4 id="Filter-映射细节"><a href="#Filter-映射细节" class="headerlink" title="Filter 映射细节"></a>Filter 映射细节</h4><ol>
<li>在启动服务器的时候，就创建了 Filter 对象并执行了初始化方法 init()。<strong>Filter 先于 Servlet 存在于服务端</strong></li>
<li>在应用中<strong>允许存在多个 Filter</strong> ，到底哪一个 Filter 先执行哪一个后执行，这<strong>取决于在 <code>web.xml</code> 中定义的先后次序</strong> <em>（如果使用注解配置，则 <strong>Filter 的执行顺序由 Filter 的类名的字母的顺序</strong>来决定，如 AFilter 和 BFilter，则先执行 AFilter）</em></li>
<li><strong>一个 Filter 可以配置多个 <code>&lt;url-pattern&gt;</code></strong> 也可以对<strong>指定的 Servlet</strong> 做过滤（注解通过 <code>servletNames</code> 指定，配置由 <code>&lt;servlet-name&gt;</code> 指定）</li>
<li><strong>默认情况下，Filter 只对新的请求做拦截，如果是请求转发，则不会过滤。</strong></li>
</ol>
<ul>
<li><code>&lt;dispatcher&gt;</code>配置项指定了 Filter 的过滤时间：</li>
<li><code>REQUEST</code>：<strong>只对请求做过滤，默认选项</strong>，如果有该配置项则必须显式写明</li>
<li><code>FORWARD</code>：只对<strong>请求转发(forword)</strong>方式做过滤</li>
<li><code>ERROR</code>：只对<strong>跳转到全局的错误页面</strong>做过滤</li>
<li><code>INCLUDE</code>：只对<strong>请求包含(include)</strong>方式做过滤</li>
<li><strong>对应的注解属性为:</strong><code>dispatcherTypes</code></li>
</ul>
<h4 id="过滤器实例"><a href="#过滤器实例" class="headerlink" title="过滤器实例"></a>过滤器实例</h4><blockquote>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483718&idx=3&sn=d63a56a3bdafa2df90178503e4d16d9d&chksm=ebd74047dca0c951eb72b5eb85553e513bd005318ee8c6ff9777d382581f0b352b2acdecf6fe#rd" target="_blank" rel="noopener">戳这里</a></p>
</blockquote>
<hr>
<h2 id="监听器"><a href="#监听器" class="headerlink" title="监听器"></a>监听器</h2><ul>
<li><strong>作用：</strong></li>
</ul>
<p>1.<strong>监听 web 应用的创建和销毁</strong><br>2.<strong>attribute发生的变化。</strong></p>
<ul>
<li><strong>web 应用：</strong>即ServletContext对象(jsp的<a href="http://how2j.cn/k/jsp/jsp-object/580.html" target="_blank" rel="noopener">隐式对象application</a>) </li>
</ul>
<p>除了对<a href="http://how2j.cn/k/listener/listener-context/605.html" target="_blank" rel="noopener">web应用</a>的监听外，还能监听<a href="http://how2j.cn/k/listener/listener-session/606.html" target="_blank" rel="noopener">session</a>和<a href="http://how2j.cn/k/listener/listener-request/607.html" target="_blank" rel="noopener">request</a>的生命周期，以及他们的attribute发生的变化。</p>
<blockquote>
<p>了解详情<a href="http://how2j.cn/k/listener/listener-tutorials/604.html" target="_blank" rel="noopener">戳这里</a></p>
</blockquote>
<hr>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2018/04/08/chu-xue-java-web-7-wen-jian-de-shang-chuan-he-xia-zai/">
      初学Java Web(7)——文件的上传和下载
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/JavaWeb%E5%9F%BA%E7%A1%80/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>JavaWeb基础</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2018年4月8日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(7)%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/7896890-326744dd6c79212a.png" alt=""></p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h4 id="文件上传前的准备"><a href="#文件上传前的准备" class="headerlink" title="文件上传前的准备"></a>文件上传前的准备</h4><ol>
<li>在表单中<strong>必须有一个上传的控件</strong><br><code>&lt;input type=&quot;file&quot; name=&quot;testImg&quot;/&gt;</code></li>
<li>因为 GET 方式有请求大小的限制，所以<strong>表单的提交方式必须是 POST</strong><br><code>&lt;form action=&quot;/upload&quot; method=&quot;post&quot;&gt;</code></li>
<li>表单默认的编码方式为 <code>application/x-www-form-urlencoded</code> ，应该修改为 <code>multipart/form-data</code> ，<strong>以二进制的形式进行数据的传输</strong><br><code>&lt;form action=&quot;/upload&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</code></li>
</ol>
<ul>
<li><strong>注意：</strong>此时 Servlet 中就不能再使用 <code>request对象.getParameter(String name)</code> 来获取请求参数<br><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(7)%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/7896890-9ffa6de1139ff470.png" alt=""></li>
</ul>
<h4 id="上传组件"><a href="#上传组件" class="headerlink" title="上传组件"></a>上传组件</h4><p>要<strong>实现文件的上传</strong>，需要基于以下两种组件的一种：</p>
<ul>
<li><strong>Apache FileUpload 组件</strong>【操作比较复杂】</li>
<li><strong>SmartUpload 组件</strong>【操作比较简单，但存在一些问题】</li>
</ul>
<hr>
<h2 id="基于-FileUpload-组件"><a href="#基于-FileUpload-组件" class="headerlink" title="基于 FileUpload 组件"></a>基于 FileUpload 组件</h2><p>使用基于Apache FileUpload上传组件实现文件的上传，步骤：</p>
<ol>
<li>将<a href="https://pan.baidu.com/s/1HqCRcoRyVw3JbXApjCcglw" target="_blank" rel="noopener">必要的 jar 包</a>导入到项目中<br>commons-fileupload-1.2.2.jar<br>commons-io-1.4.jar</li>
<li>简单写好 upload.jsp 上传页面：</li>
</ol>
<pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%@</span> <span class="token attr-name">page</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java<span class="token punctuation">"</span></span> <span class="token attr-name">contentType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>UTF-8<span class="token punctuation">"</span></span>
         <span class="token attr-name">pageEncoding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token attr-name">import</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.util.*<span class="token punctuation">"</span></span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>文件的上传和下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

文件上传：
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/upload<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testImg<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(7)%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/7896890-4103d55665ab457a.png" alt=""></p>
<ol start="3">
<li>编写 UploadServlet 处理相关请求：</li>
</ol>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> servlet<span class="token punctuation">;</span>

<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span>FileItem<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span>FileItemFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span>disk<span class="token punctuation">.</span>DiskFileItemFactory<span class="token punctuation">;</span>
<span class="token keyword">import</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>commons<span class="token punctuation">.</span>fileupload<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>ServletFileUpload<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>ServletException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>WebServlet<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServlet<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletResponse<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/upload"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UploadServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span>HttpServletRequest req<span class="token punctuation">,</span> HttpServletResponse resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">// 验证请求是否满足要求（post 请求 / enctype 是否以multipart打头</span>
        <span class="token keyword">boolean</span> isMultipart <span class="token operator">=</span> ServletFileUpload<span class="token punctuation">.</span><span class="token function">isMultipartContent</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 如果不满足要求就立即结束对该请求的处理</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isMultipart<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// FileItem 是表单中的每一个元素的封装</span>
            <span class="token comment" spellcheck="true">// 创建一个 FileItem 的工厂类</span>
            FileItemFactory factory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DiskFileItemFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 创建一个文件上传处理器（装饰设计模式）</span>
            ServletFileUpload upload <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServletFileUpload</span><span class="token punctuation">(</span>factory<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment" spellcheck="true">// 解析请求</span>
            List<span class="token operator">&lt;</span>FileItem<span class="token operator">></span> items <span class="token operator">=</span> upload<span class="token punctuation">.</span><span class="token function">parseRequest</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>FileItem fileItem <span class="token operator">:</span>
                    items<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment" spellcheck="true">// 判断空间是否是普通控件</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>fileItem<span class="token punctuation">.</span><span class="token function">isFormField</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">// 普通控件</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    <span class="token comment" spellcheck="true">// 上传控件</span>
                    <span class="token comment" spellcheck="true">// 将上传的文件保存到服务器</span>
                    fileItem<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:/"</span><span class="token punctuation">,</span> <span class="token string">"testImg.jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="文件上传的细节"><a href="#文件上传的细节" class="headerlink" title="文件上传的细节"></a>文件上传的细节</h4><p>上面已经能实现简单的文件上传功能了，但文件上传有很多需要注意的地方。</p>
<ul>
<li><strong>缓存大小和临时目录</strong><br>在上传文件的时候,如果文件过大,而且是将文件放在缓存中,就可能造成内存溢出<br>默认的缓存大小为 <code>10 kb</code>，临时目录的默认值为 <code>tomcat/temp</code></li>
<li><strong>解决方案：</strong>将操作缓存大小的文件放在服务器的磁盘(临时目录)中,在文件的大小超过设定的缓存大小的时候就会使用到临时目录<pre class=" language-java"><code class="language-java"><span class="token comment" spellcheck="true">// 设置缓存大小 500kb</span>
factory<span class="token punctuation">.</span><span class="token function">setSizeThreshold</span><span class="token punctuation">(</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment" spellcheck="true">// 设置临时目录</span>
factory<span class="token punctuation">.</span><span class="token function">setRepository</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><strong>通常不需要设置</strong></li>
</ul>
<p>另一个问题是：如果用户 A 上传了一个文件名叫xxx，用户 B 也上传了一个文件名叫 xxx，那么此时用户 B 的文件会把用户 A 的文件给覆盖掉。</p>
<ul>
<li><strong>文件名称的处理</strong><br>相同文件名称的文件，后面的文件会把前面的文件覆盖掉</li>
<li><strong>解决方案：使用UUID来生成一个随机的而且不重复字符串</strong>作为文件的名称，获取真实文件的后缀名需要用到 <code>FilenameUtils</code> 这个工具类</li>
<li><strong>语法：</strong></li>
</ul>
<pre class=" language-java"><code class="language-java">String fileName <span class="token operator">=</span> UUID<span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">"."</span><span class="token operator">+</span>FilenameUtils<span class="token punctuation">.</span><span class="token function">getExtension</span><span class="token punctuation">(</span>fileItem<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h4 id="文件类型的约束"><a href="#文件类型的约束" class="headerlink" title="文件类型的约束"></a>文件类型的约束</h4><p>上传文件的类型应该需要做一些约束的，比如在上传头像的时候就只允许上传图片，其他类型的文件都不应该允许上传，并且如果类型不正确的时候，应该给用户一个错误的提示。</p>
<ul>
<li><strong>jsp 文件增加显示错误提示信息：</strong></li>
</ul>
<p>我们给我们的 jsp 开头增加一个 <code>&lt;span&gt;</code> 来显示错误信息</p>
<pre class=" language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%@</span> <span class="token attr-name">page</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java<span class="token punctuation">"</span></span> <span class="token attr-name">contentType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html; charset<span class="token punctuation">=</span>UTF-8<span class="token punctuation">"</span></span>
         <span class="token attr-name">pageEncoding</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span> <span class="token attr-name">import</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>java.util.*<span class="token punctuation">"</span></span> <span class="token attr-name">%</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>文件的上传和下载<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>

文件上传：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">></span></span>${errorMsg}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>/upload<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>testImg<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span><span class="token punctuation">/></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></code></pre>
<ul>
<li><strong>判断上传文件类型：</strong><br>限制文件类型那么就需要对文件类型进行判断</li>
<li>语法：<code>String contentType = fileItem.getContentType();</code></li>
<li>Servlet 源码：<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> servlet<span class="token punctuation">;</span>
</code></pre>
</li>
</ul>
<p>import org.apache.commons.fileupload.FileItem;<br>import org.apache.commons.fileupload.FileItemFactory;<br>import org.apache.commons.fileupload.disk.DiskFileItemFactory;<br>import org.apache.commons.fileupload.servlet.ServletFileUpload;<br>import org.apache.commons.io.FilenameUtils;</p>
<p>import javax.servlet.ServletException;<br>import javax.servlet.annotation.WebServlet;<br>import javax.servlet.http.HttpServlet;<br>import javax.servlet.http.HttpServletRequest;<br>import javax.servlet.http.HttpServletResponse;<br>import java.io.File;<br>import java.io.IOException;<br>import java.util.List;<br>import java.util.UUID;</p>
<p>@WebServlet(“/upload”)<br>public class UploadServlet extends HttpServlet {</p>
<pre><code>protected void service(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
    // 验证请求是否满足要求（post 请求 / enctype 是否以multipart打头
    boolean isMultipart = ServletFileUpload.isMultipartContent(req);
    // 如果不满足要求就立即结束对该请求的处理
    if (!isMultipart) {
        return;
    }

    try {
        // FileItem 是表单中的每一个元素的封装
        // 创建一个 FileItem 的工厂类
        FileItemFactory factory = new DiskFileItemFactory();
        // 创建一个文件上传处理器（装饰设计模式）
        ServletFileUpload upload = new ServletFileUpload(factory);
        // 解析请求
        List&lt;FileItem&gt; items = upload.parseRequest(req);
        for (FileItem fileItem :
                items) {
            // 判断空间是否是普通控件
            if (fileItem.isFormField()) {
                // 普通控件
            } else {
                // 上传控件
                String contentType = fileItem.getContentType();
                if (!contentType.startsWith(&quot;image/&quot;)) {
                    // 实现简单的错误提示
                    req.setAttribute(&quot;errorMsg&quot;, &quot;亲，您上传的文件格式不正确，请重新上传！&quot;);
                    req.getRequestDispatcher(&quot;upload.jsp&quot;).forward(req, resp);
                    return;  // 如果不是图片类型则不再对请求进行处理
                }
                // 随机命名文件名
                String fileName = UUID.randomUUID().toString() + &quot;.&quot; + FilenameUtils.getExtension(fileItem.getName());
                // 将上传的文件保存到服务器
                fileItem.write(new File(&quot;C:/&quot;, fileName));
            }
        }
    } catch (Exception e) {
        e.printStackTrace();
    }
}</code></pre><p>}</p>
<pre><code>
#### 解决中文乱码问题
- 解决中文文件名乱码（事实上我在本地测试并没有出现乱码），得到解析器以后，就**直接设置解析器的编码为UTF-8就行了**</code></pre><p> fileUpload.setHeaderEncoding(“UTF-8”);</p>
<pre><code>- 解决表单数据乱码，在获取表单值的时候，按照UTF-8编码来获取</code></pre><p>String value = fileItem.getString(“UTF-8”);</p>
<pre><code>

#### 文件大小约束

- 单个文件数据的大小约束
即整个表单之中只有一个上传控件
- 语法：`upload.setFileSizeMax(1024 * 500); // 单个文件不能超过500 kb`
- 一次请求数据的大小约束
限制整个请求之中的数据大小
- 语法：`upload.setSizeMax(1024 * 750); // 整个请求文件大小不能超过 750 kb`


#### 使用 Map 封装请求信息

上面提到，我们已经无法用 request对象正常获取到参数，那么我们究竟应该怎么办呢？

&gt; - 使用 Map 封装一下就好了，等到要用的时候再从 Map 中取出
![](https://cdn.jsdelivr.net/gh/wmyskxz/img/img/初学Java-Web(7)——文件的上传和下载/7896890-4e09be236b365217.png)


---

## SmartUpload

上面已经基于 FileUpload 实现了文件的上传，事实上也没有想象中那么复杂，让我们来看看 SmartUpload

要使用SmartUpload组件，就需要导入smartupload.jar开发包

#### 快速入门

``` java
//实例化组件
SmartUpload smartUpload = new SmartUpload();

//初始化上传操作
smartUpload.initialize(this.getServletConfig(), request, response);

try {

    //上传准备
    smartUpload.upload();

    //对于普通数据，单纯到request对象是无法获取得到提交参数的。也是需要依赖smartUpload
    String password = smartUpload.getRequest().getParameter(&quot;password&quot;);
    System.out.println(password);

    //上传到uploadFile文件夹中
    smartUpload.save(&quot;uploadFile&quot;);

} catch (SmartUploadException e) {
    e.printStackTrace();    
}</code></pre><ul>
<li>摘自：<a href="https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483727&idx=1&sn=87db212ac7e2590c57749a9857028f14&chksm=ebd7404edca0c9583fb3074d6827952bbfb5335c13e236719cde573e52bfe89e85e133755ab3#rd" target="_blank" rel="noopener">这里</a></li>
<li>上面链接提到 SmartUpload 组件在解决中文乱码中有一些小问题，我没有测试过，但我觉得自己写一个 FileUpload 工具类已经足够使用了</li>
</ul>
<hr>
<h2 id="文件下载"><a href="#文件下载" class="headerlink" title="文件下载"></a>文件下载</h2><ol>
<li>写一个简单的 jsp 页面：</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(7)%E2%80%94%E2%80%94%E6%96%87%E4%BB%B6%E7%9A%84%E4%B8%8A%E4%BC%A0%E5%92%8C%E4%B8%8B%E8%BD%BD/7896890-6ace49a2c5c19e7e.png" alt=""></p>
<ol start="2">
<li>在 WEB-INF 下创建 download 文件夹，里面放入一个 test.zip</li>
<li>编写 Servlet 处理相关请求</li>
</ol>
<pre class=" language-java"><code class="language-java"><span class="token keyword">package</span> servlet<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>ServletException<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>ServletOutputStream<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>WebServlet<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServlet<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletRequest<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>servlet<span class="token punctuation">.</span>http<span class="token punctuation">.</span>HttpServletResponse<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>IOException<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>URLEncoder<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Files<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>nio<span class="token punctuation">.</span>file<span class="token punctuation">.</span>Paths<span class="token punctuation">;</span>

<span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/download"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DownloadServlet</span> <span class="token keyword">extends</span> <span class="token class-name">HttpServlet</span> <span class="token punctuation">{</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">service</span><span class="token punctuation">(</span>HttpServletRequest req<span class="token punctuation">,</span> HttpServletResponse resp<span class="token punctuation">)</span> <span class="token keyword">throws</span> ServletException<span class="token punctuation">,</span> IOException <span class="token punctuation">{</span>

        <span class="token comment" spellcheck="true">// 设置响应数据的 MIME 类型</span>
        resp<span class="token punctuation">.</span><span class="token function">setContentType</span><span class="token punctuation">(</span><span class="token string">"application/x-msdownload"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 获取文件名称</span>
        String fileName <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getParameter</span><span class="token punctuation">(</span><span class="token string">"fileName"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 判断浏览器是否是 IE</span>
        String userAgent <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getHeader</span><span class="token punctuation">(</span><span class="token string">"User-Agent"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>userAgent<span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"MSIE"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// IE</span>
            <span class="token comment" spellcheck="true">// 设置文件的名称</span>
            resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment; fileName="</span>
                    <span class="token operator">+</span> URLEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token comment" spellcheck="true">// 非IE</span>
            resp<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Content-Disposition"</span><span class="token punctuation">,</span> <span class="token string">"attachment; fileName="</span>
                    <span class="token operator">+</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">(</span>fileName<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"ISO-8859-1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">// 获取文件所在的路径</span>
        String path <span class="token operator">=</span> req<span class="token punctuation">.</span><span class="token function">getServletContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRealPath</span><span class="token punctuation">(</span><span class="token string">"/WEB-INF/download"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment" spellcheck="true">// 获取指定的文件对象</span>
        File f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> fileName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ServletOutputStream out <span class="token operator">=</span> resp<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 将文件复制到输出流中，响应给浏览器</span>
        Files<span class="token punctuation">.</span><span class="token function">copy</span><span class="token punctuation">(</span>Paths<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<hr>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2018/04/07/chu-xue-java-web-6-jsp-xue-xi-zong-jie/">
      初学Java Web(6)——JSP学习总结
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/JavaWeb%E5%9F%BA%E7%A1%80/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>JavaWeb基础</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2018年4月7日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%886%EF%BC%89%E2%80%94%E2%80%94JSP%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-d8538c85f415d63e.png" alt=""></p>
<h2 id="为什么要学习-JSP"><a href="#为什么要学习-JSP" class="headerlink" title="为什么要学习 JSP"></a>为什么要学习 JSP</h2><h4 id="Servlet-的短板："><a href="#Servlet-的短板：" class="headerlink" title="Servlet 的短板："></a>Servlet 的短板：</h4><p>Servlet 的出现，是为了<strong>解决动态输出网页的问题。</strong></p>
<p>虽然这样做目的能达到，但是存在一些<strong>缺陷：</strong></p>
<ul>
<li>在 Servlet 输出网页片段非常恶心<strong>（可读性差，维护起来也很麻烦）</strong> </li>
<li>没有体现<strong>责任分离</strong>的原则（做自己擅长做的事）</li>
</ul>
<h4 id="责任分离"><a href="#责任分离" class="headerlink" title="责任分离"></a>责任分离</h4><ul>
<li><strong>Servlet</strong> 能够很好地<strong>组织业务逻辑代码，</strong>但是在 Java 源文件中通过字符串拼接的方式生成动态 HTML 内容会导致<strong>代码维护困难、可读性差</strong></li>
<li><strong>JSP</strong> 虽然规避了 Servlet 在生成 HTML 内容方面的劣势，但是在 HTML 中混入大量、复杂的业务逻辑同样也是不可取的</li>
<li><em>参考：<a href="https://www.zhihu.com/question/37962386" target="_blank" rel="noopener">知乎@David</a></em></li>
<li><strong>注意：JSP实质上就是一个Servlet</strong></li>
</ul>
<h4 id="MVC-模式"><a href="#MVC-模式" class="headerlink" title="MVC 模式"></a>MVC 模式</h4><p>既然 Servlet 和 JSP 都有各自的优势和短板，那么为什么不结合起来扬长避短呢？答案是肯定的——MVC(Model-View-Controller)模式非常适合解决这一问题。</p>
<p>MVC模式（Model-View-Controller）是<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E8%25BD%25AF%25E4%25BB%25B6%25E5%25B7%25A5%25E7%25A8%258B">软件工程</a>中的一种<a href="https://link.zhihu.com/?target=https%3A//zh.wikipedia.org/wiki/%25E8%25BD%25AF%25E4%25BB%25B6%25E6%259E%25B6%25E6%259E%2584">软件架构</a>模式，把软件系统分为三个基本部分：模型（Model）、视图（View）和控制器（Controller）：</p>
<ul>
<li>Controller——负责转发请求，对请求进行处理</li>
<li>View——负责界面显示</li>
<li>Model——业务功能编写（例如算法实现）、数据库设计以及数据存取操作实现</li>
</ul>
<p>在JSP/Servlet开发的软件系统中，这三个部分的描述如下所示：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%886%EF%BC%89%E2%80%94%E2%80%94JSP%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-1471c8cf3ca17fc7.jpg" alt=""></p>
<p>1.Web浏览器发送HTTP请求到服务端，被Controller(Servlet)获取并进行处理（例如参数解析、请求转发）<br>2.Controller(Servlet)调用核心业务逻辑——Model部分，获得结果<br>3.Controller(Servlet)将逻辑处理结果交给View（JSP），动态输出HTML内容<br>4.动态生成的HTML内容返回到浏览器显示</p>
<p>MVC模式在Web开发中的好处是非常明显，它规避了JSP与Servlet各自的短板，Servlet只负责业务逻辑而不会通过out.append()动态生成HTML代码；JSP中也不会充斥着大量的业务代码。这大大提高了代码的可读性和可维护性。</p>
<ul>
<li><em>参考：<a href="https://www.zhihu.com/question/37962386" target="_blank" rel="noopener">知乎@David</a></em></li>
</ul>
<hr>
<h2 id="JSP-的执行原理"><a href="#JSP-的执行原理" class="headerlink" title="JSP 的执行原理"></a>JSP 的执行原理</h2><ul>
<li><strong>总结：</strong><br>当访问一个 JSP 页面时，该页面请求将会讲给服务器中的 <strong>JSP 引擎</strong>去处理，它<strong>负责解释和执行 JSP 页面，</strong>每个 JSP 页面在<strong>第一次被访问时</strong>，JSP 引擎就会将它翻译成一个继承自 <code>org.apache.jasper.runtime.HttpJspBase</code>类的 <strong>Servlet 源程序，接着再编译成 class 类文件</strong>，再由 Web 容器<strong>像调用普通 Servlet 程序一样</strong>的方式来装载和解释执行这个由 JSP 页面翻译成的 Servlet 程序。</li>
</ul>
<p><a href="https://blog.csdn.net/oncealong/article/details/51393266" target="_blank" rel="noopener">详细资料在这里，感兴趣的戳我</a></p>
<hr>
<h2 id="JSP-的语法"><a href="#JSP-的语法" class="headerlink" title="JSP 的语法"></a>JSP 的语法</h2><p>像这样冗杂繁复的知识点，直接给两个好一点的链接记下就好了：<br><a href="https://www.w3cschool.cn/jsp/jsp-jstl.html" target="_blank" rel="noopener">1.W3Cschool</a><br><a href="http://www.runoob.com/jsp/jsp-tutorial.html" target="_blank" rel="noopener">2.菜鸟教程</a></p>
<hr>
<h2 id="JSP-三大指令"><a href="#JSP-三大指令" class="headerlink" title="JSP 三大指令"></a>JSP 三大指令</h2><ul>
<li><strong>特点：</strong><br>并<strong>不向客户端产生任何输出</strong>，指令在 JSP <strong>整个文件范围内有效</strong>，并且为<strong>翻译阶段提供了全局信息</strong></li>
<li><strong>指令的语法格式：</strong></li>
</ul>
<p><strong>&lt;%@ 指令名称   属性名=属性值   属性名=属性值%&gt;</strong></p>
<h4 id="——【page指令】——"><a href="#——【page指令】——" class="headerlink" title="——【page指令】——"></a>——【page指令】——</h4><ul>
<li><strong>作用：</strong><br>定义 JSP 页面的各种属性</li>
<li><strong>属性：</strong></li>
</ul>
<p>1.language：指示JSP页面中使用脚本语言。默认值java，目前只支持java。<br>2.extends：指示 JSP 对应的 Servlet 类的父类。<strong>不要修改。</strong><br>3.<code>*</code>import：导入JSP中的Java脚本使用到的类或包。（如同Java中的import语句）<br>JSP 引擎自动导入以下包中的类：<br><code>javax.servlet.*</code><br><code>javax.servlet.http.*</code><br><code>javax.servlet.jsp.*</code><br><strong>注意：一个import属性可以导入多个包，用逗号分隔。</strong><br>4.<code>*</code>sessioin：指示JSP页面是否创建 HttpSession 对象。<strong>默认值是true，创建</strong><br>5.<code>*</code>buffer：指示 JSP 用的输出流的缓存大小.<strong>默认值是8Kb。</strong><br>6.autoFlush：自动刷新输出流的缓存。<br>7.isThreadSafe：指示页面是否是线程安全的（过时的）。<strong>默认是true。</strong><br>true：不安全的。<br>false：安全的。指示 JSP 对应的 Servlet 实现 SingleThreadModel 接口。<br>8.<code>*</code>errorPage:<strong>指示当前页面出错后转向（转发）的页面。</strong></p>
<pre><code>&gt; 配置全局错误提示页面：
&gt; web.xml 文件中添加：
&lt;error-page&gt;
    &lt;exception-type&gt;java.lang.Exception&lt;/exception-type&gt;
    &lt;location&gt;/error.jsp&lt;/location&gt;
&lt;/error-page&gt;
&lt;error-page&gt;
    &lt;error-code&gt;404&lt;/error-code&gt;
    &lt;location&gt;/404.jsp&lt;/location&gt;
&lt;/error-page&gt;</code></pre><p>9.<code>*</code>isErrorPage:指示当前页面是否产生 Exception 对象。<br>10.<code>*</code>contentType：指定当前页面的 MIME 类型。作用与 Servlet 中的<code>response.setContentType()</code> 作用完全一致<br>11.<code>*</code>pageEncoding：<strong>通知引擎读取 JSP 时采用的编码（因为要翻译）</strong><br>12.<code>*</code>isELIgnored：是否忽略EL表达式。${1+1}。<strong>默认值是false。</strong></p>
<ul>
<li><strong>page 指令最简单的使用方式：</strong><pre><code>&lt;%@ page pageEncoding=&quot;UTF-8&quot;%&gt;</code></pre></li>
</ul>
<h4 id="——【include】——"><a href="#——【include】——" class="headerlink" title="——【include】——"></a>——【include】——</h4><ul>
<li><strong>作用：</strong><br>包含其他的组件</li>
<li><strong>语法：</strong><br><code>&lt;%@include file=&quot;&quot;%&gt;</code><br>file 指定要包含的目标组件。路径如果以 <strong>“/“</strong>（当前应用）就是绝对路径。</li>
<li><strong>原理：</strong><br>把目标组件的内容加到源组件中，输出结果。</li>
</ul>
<h4 id="静态包含和动态包含的区别："><a href="#静态包含和动态包含的区别：" class="headerlink" title="静态包含和动态包含的区别："></a>静态包含和动态包含的区别：</h4><ul>
<li><strong>静态包含：</strong><br><code>&lt;%@include file=&quot;被包含的页面的路径&quot;%&gt;</code></li>
</ul>
<p><strong>包含的时机：</strong>在 JSP 文件被<strong>翻译</strong>的时候<strong>合并在一起</strong><br>最终会被翻译成<strong>一个 class 文件</strong></p>
<ul>
<li><strong>动态包含：</strong><br><code>&lt;jsp:include page=&quot;被包含页面的路径&quot;&gt;&lt;/jsp:include&gt;</code></li>
</ul>
<p><strong>包含的时机：</strong>在<strong>运行阶段合并代码</strong><br>最终将得到<strong>两个 class 文件</strong></p>
<ul>
<li><strong>总结：在实际开发中，能用静的就别用动的</strong></li>
</ul>
<h4 id="——【taglib】——"><a href="#——【taglib】——" class="headerlink" title="——【taglib】——"></a>——【taglib】——</h4><ul>
<li><strong>作用：</strong><br>引入外部的标签</li>
<li><strong>语法：</strong><br><code>&lt;%@taglib uri=&quot;标签名称空间&quot; prefix=&quot;前缀&quot;%&gt;</code><br>例如：<code>&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;</code></li>
</ul>
<hr>
<h2 id="JSP-九大内置对象"><a href="#JSP-九大内置对象" class="headerlink" title="JSP 九大内置对象"></a>JSP 九大内置对象</h2><p><strong>内置对象：</strong>JSP 中事<strong>先创建好的对象</strong>，可以<strong>直接拿来使用</strong></p>
<table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">pageContext</td>
<td align="center">PageContext</td>
<td align="center">表示当前的JSP对象</td>
</tr>
<tr>
<td align="center">request</td>
<td align="center">HttpServletRequest</td>
<td align="center">表示一次请求对象</td>
</tr>
<tr>
<td align="center">session</td>
<td align="center">HttpSession</td>
<td align="center">表示一次会话对象,<strong>session=”true”</strong></td>
</tr>
<tr>
<td align="center">application</td>
<td align="center">ServletContext</td>
<td align="center">表示当前应用对象</td>
</tr>
<tr>
<td align="center">response</td>
<td align="center">HttpServletResponse</td>
<td align="center">表示一次响应对象</td>
</tr>
<tr>
<td align="center">exception</td>
<td align="center">Throwable</td>
<td align="center">表示异常对象,isErrorPage=”true”</td>
</tr>
<tr>
<td align="center">config</td>
<td align="center">ServletConfig</td>
<td align="center">表示当前JSP的配置对象</td>
</tr>
<tr>
<td align="center">out</td>
<td align="center">JspWriter</td>
<td align="center">表示一个输出流对象</td>
</tr>
<tr>
<td align="center">page</td>
<td align="center">Object</td>
<td align="center">表示当前页面</td>
</tr>
</tbody></table>
<hr>
<h2 id="JSP-四大作用域"><a href="#JSP-四大作用域" class="headerlink" title="JSP 四大作用域"></a>JSP 四大作用域</h2><table>
<thead>
<tr>
<th align="center">名称</th>
<th align="center">类型</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">pageContext</td>
<td align="center">PageContext</td>
<td align="center">表示当前的JSP对象</td>
</tr>
<tr>
<td align="center">request</td>
<td align="center">HttpServletRequest</td>
<td align="center">表示一次请求对象</td>
</tr>
<tr>
<td align="center">session</td>
<td align="center">HttpSession</td>
<td align="center">表示一次会话对象,<strong>session=”true”</strong></td>
</tr>
<tr>
<td align="center">application</td>
<td align="center">ServletContext</td>
<td align="center">表示当前应用对象</td>
</tr>
</tbody></table>
<hr>
<h2 id="EL（表达式语言）"><a href="#EL（表达式语言）" class="headerlink" title="EL（表达式语言）"></a>EL（表达式语言）</h2><ul>
<li><strong>需求：从作用域中获取共享数据,如果没有对应的数据,返回空字符串</strong><br>在PageContext中提供了下面的方法:<code>abstract  Object findAttribute(String name)</code>来获取共享数据，从<strong>page，request，session，application</strong>作用域中<strong>按顺序搜索,</strong>如果找到立即返回,反之,返回null</li>
</ul>
<p>所以我们可以这样来完成要求：<br><code>&lt;%=pageContext.findAttribute(&quot;msg&quot;)==null?&quot;&quot;:pageContext.findAttribute(&quot;msg&quot;) %&gt;</code><br>这样的代码虽然能够完成需求，但是总的来说：<strong>太麻烦！</strong></p>
<ul>
<li><p>如果我们使用 EL 表达式，该如何实现呢？<br><code>${msg}</code>等价于<code>&lt;%=pageContext.findAttribute(&quot;msg&quot;)==null?&quot;&quot;:pageContext.findAttribute(&quot;msg&quot;) %&gt;</code><br>这样看起来就<strong>简单</strong>多了！</p>
</li>
<li><p><strong>EL的特点：</strong></p>
</li>
</ul>
<p>1.从作用域中获取共享数据<br>2.从page,request,session,application作用域中<strong>按顺序搜索</strong><br>3.<strong>如果共享数据为null,就输出空字符串</strong>（这是EL最重要的特点）</p>
<h4 id="使用EL表达式从指定的作用域中获取共享数据"><a href="#使用EL表达式从指定的作用域中获取共享数据" class="headerlink" title="使用EL表达式从指定的作用域中获取共享数据:"></a>使用EL表达式从指定的作用域中获取共享数据:</h4><p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%886%EF%BC%89%E2%80%94%E2%80%94JSP%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-fb4b68a07268b5a9.png" alt=""></p>
<ul>
<li><strong>使用EL表达式访问对象的属性的两种方式：</strong></li>
</ul>
<p>1.<strong>${对象.属性名}       :</strong>通常使用这种方式,<strong>属性名比较规范</strong><br>2.<strong>${对象[“属性名”]} :</strong>当<strong>属性名不规范</strong>的时候使用这种方式,比如:name-age</p>
<ul>
<li><strong>使用El表达式获取应用的上下文路径：</strong><br>在EL表达式中有一个<strong>隐含的对象pageContext</strong><br>而在pageContext中有一个request属性,在request对象中有一个contextPath属性,那么获取contextPage的方法:<br><code>${pageContext.request.contextPath}</code><br>在 Tomcat 7 以后,EL表达式不仅支持属性的访问,而且还支持访问方法<br><code>${pageContext.getRequest().getContextPath()}</code></li>
<li><strong>empty 运算符：</strong><br>empty 运算符主要用来判断值是否为空<strong>（NULL,空字符串，空集合），返回 true / false</strong></li>
</ul>
<hr>
<h2 id="JSTL"><a href="#JSTL" class="headerlink" title="JSTL"></a>JSTL</h2><ul>
<li><strong>作用：消除 JSP 中的 Java 代码</strong></li>
<li>在 JSP 中使用 JSTL 的步骤：</li>
</ul>
<p>1.<strong>引入入jar包：</strong>在 Tomcat 中的实例项目 examples 中找到对应的两个jar包<br>standard-1.1.2.jar ，jstl-1.1.2.jar<br>2.在对应的 JSP 页面中引入要使用的标签库,比如引入核心标签库<br><code>&lt;%@taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot;%&gt;</code></p>
<blockquote>
<p>下面列出 JSTL 主要提供的 5 大类标签库（搬自<a href="http://www.runoob.com/jsp/jsp-jstl.html" target="_blank" rel="noopener">菜鸟教程</a>），先对这些标签初步有一个印象，然后下面给一些常用的标签的一些用法。</p>
</blockquote>
<h4 id="JSTL-核心标签"><a href="#JSTL-核心标签" class="headerlink" title="JSTL 核心标签"></a>JSTL 核心标签</h4><p> 核心标签是最常用的JSTL标签。引用核心标签库的语法如下：</p>
<pre><code>&lt;%@ taglib prefix=&quot;c&quot; 
           uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;</code></pre><table>
<thead>
<tr>
<th align="left">标签</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-out-tag.html" target="_blank" rel="noopener">&lt;c:out&gt;</a></td>
<td align="left">用于在JSP中显示数据，就像&lt;%= … &gt;</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-set-tag.html" target="_blank" rel="noopener">&lt;c:set&gt;</a></td>
<td align="left">用于保存数据</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-remove-tag.html" target="_blank" rel="noopener">&lt;c:remove&gt;</a></td>
<td align="left">用于删除数据</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-catch-tag.html" target="_blank" rel="noopener">&lt;c:catch&gt;</a></td>
<td align="left">用来处理产生错误的异常状况，并且将错误信息储存起来</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-if-tag.html" target="_blank" rel="noopener">&lt;c:if&gt;</a></td>
<td align="left">与我们在一般程序中用的if一样</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-choose-tag.html" target="_blank" rel="noopener">&lt;c:choose&gt;</a></td>
<td align="left">本身只当做&lt;c:when&gt;和&lt;c:otherwise&gt;的父标签</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-choose-tag.html" target="_blank" rel="noopener">&lt;c:when&gt;</a></td>
<td align="left">&lt;c:choose&gt;的子标签，用来判断条件是否成立</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-choose-tag.html" target="_blank" rel="noopener">&lt;c:otherwise&gt;</a></td>
<td align="left">&lt;c:choose&gt;的子标签，接在&lt;c:when&gt;标签后，当&lt;c:when&gt;标签判断为false时被执行</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-import-tag.html" target="_blank" rel="noopener">&lt;c:import&gt;</a></td>
<td align="left">检索一个绝对或相对 URL，然后将其内容暴露给页面</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-foreach-tag.html" target="_blank" rel="noopener">&lt;c:forEach&gt;</a></td>
<td align="left">基础迭代标签，接受多种集合类型</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-foreach-tag.html" target="_blank" rel="noopener">&lt;c:forTokens&gt;</a></td>
<td align="left">根据指定的分隔符来分隔内容并迭代输出</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-param-tag.html" target="_blank" rel="noopener">&lt;c:param&gt;</a></td>
<td align="left">用来给包含或重定向的页面传递参数</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-redirect-tag.html" target="_blank" rel="noopener">&lt;c:redirect&gt;</a></td>
<td align="left">重定向至一个新的URL.</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-core-url-tag.html" target="_blank" rel="noopener">&lt;c:url&gt;</a></td>
<td align="left">使用可选的查询参数来创造一个URL</td>
</tr>
<tr>
<td align="left">#### 格式化标签</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">JSTL格式化标签用来格式化并输出文本、日期、时间、数字。引用格式化标签库的语法如下：</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">```</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&lt;%@ taglib prefix=”fmt”</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">uri=”<a href="http://java.sun.com/jsp/jstl/fmt&quot;" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/fmt&quot;</a> %&gt;</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">```</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">标签</td>
<td align="left">描述</td>
</tr>
<tr>
<td align="left">:-</td>
<td align="left">:-</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-formatnumber-tag.html" target="_blank" rel="noopener"><a href="fmt:formatNumber">fmt:formatNumber</a></a></td>
<td align="left">使用指定的格式或精度格式化数字</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-parsenumber-tag.html" target="_blank" rel="noopener"><a href="fmt:parseNumber">fmt:parseNumber</a></a></td>
<td align="left">解析一个代表着数字，货币或百分比的字符串</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-formatdate-tag.html" target="_blank" rel="noopener"><a href="fmt:formatDate">fmt:formatDate</a></a></td>
<td align="left">使用指定的风格或模式格式化日期和时间</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-parsedate-tag.html" target="_blank" rel="noopener"><a href="fmt:parseDate">fmt:parseDate</a></a></td>
<td align="left">解析一个代表着日期或时间的字符串</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-bundle-tag.html" target="_blank" rel="noopener"><a href="fmt:bundle">fmt:bundle</a></a></td>
<td align="left">绑定资源</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-setlocale-tag.html" target="_blank" rel="noopener"><a href="fmt:setLocale">fmt:setLocale</a></a></td>
<td align="left">指定地区</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-setbundle-tag.html" target="_blank" rel="noopener"><a href="fmt:setBundle">fmt:setBundle</a></a></td>
<td align="left">绑定资源</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-timezone-tag.html" target="_blank" rel="noopener"><a href="fmt:timeZone">fmt:timeZone</a></a></td>
<td align="left">指定时区</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-settimezone-tag.html" target="_blank" rel="noopener"><a href="fmt:setTimeZone">fmt:setTimeZone</a></a></td>
<td align="left">指定时区</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-message-tag.html" target="_blank" rel="noopener"><a href="fmt:message">fmt:message</a></a></td>
<td align="left">显示资源配置文件信息</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-format-requestencoding-tag.html" target="_blank" rel="noopener"><a href="fmt:requestEncoding">fmt:requestEncoding</a></a></td>
<td align="left">设置request的字符编码</td>
</tr>
</tbody></table>
<h4 id="SQL标签"><a href="#SQL标签" class="headerlink" title="SQL标签"></a>SQL标签</h4><p>JSTL SQL标签库提供了与关系型数据库（Oracle，MySQL，SQL Server等等）进行交互的标签。引用SQL标签库的语法如下：</p>
<pre><code>&lt;%@ taglib prefix=&quot;sql&quot; 
           uri=&quot;http://java.sun.com/jsp/jstl/sql&quot; %&gt;</code></pre><table>
<thead>
<tr>
<th align="left">标签</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-sql-setdatasource-tag.html" target="_blank" rel="noopener"><a href="sql:setDataSource">sql:setDataSource</a></a></td>
<td align="left">指定数据源</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-sql-query-tag.html" target="_blank" rel="noopener"><a href="sql:query">sql:query</a></a></td>
<td align="left">运行SQL查询语句</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-sql-update-tag.html" target="_blank" rel="noopener"><a href="sql:update">sql:update</a></a></td>
<td align="left">运行SQL更新语句</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-sql-param-tag.html" target="_blank" rel="noopener"><a href="sql:param">sql:param</a></a></td>
<td align="left">将SQL语句中的参数设为指定值</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-sql-dateparam-tag.html" target="_blank" rel="noopener"><a href="sql:dateParam">sql:dateParam</a></a></td>
<td align="left">将SQL语句中的日期参数设为指定的java.util.Date 对象值</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-sql-transaction-tag.html" target="_blank" rel="noopener"><a href="sql:transaction">sql:transaction</a></a></td>
<td align="left">在共享数据库连接中提供嵌套的数据库行为元素，将所有语句以一个事务的形式来运行</td>
</tr>
</tbody></table>
<h2 id="XML-标签"><a href="#XML-标签" class="headerlink" title="XML 标签"></a>XML 标签</h2><p>JSTL XML标签库提供了创建和操作XML文档的标签。引用XML标签库的语法如下：</p>
<pre><code>&lt;%@ taglib prefix=&quot;x&quot; 
           uri=&quot;http://java.sun.com/jsp/jstl/xml&quot; %&gt;</code></pre><p>在使用xml标签前，你必须将XML 和 XPath 的相关包拷贝至你的&lt;Tomcat 安装目录&gt;\lib下:</p>
<ul>
<li><p><strong>XercesImpl.jar</strong></p>
<p>下载地址： <a href="http://www.apache.org/dist/xerces/j/" target="_blank" rel="noopener">http://www.apache.org/dist/xerces/j/</a></p>
</li>
<li><p><strong>xalan.jar</strong></p>
<p>下载地址： <a href="http://xml.apache.org/xalan-j/index.html" target="_blank" rel="noopener">http://xml.apache.org/xalan-j/index.html</a></p>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">标签</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-out-tag.html" target="_blank" rel="noopener">&lt;x:out&gt;</a></td>
<td align="left">与&lt;%= … &gt;,类似，不过只用于XPath表达式</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-parse-tag.html" target="_blank" rel="noopener">&lt;x:parse&gt;</a></td>
<td align="left">解析 XML 数据</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-set-tag.html" target="_blank" rel="noopener">&lt;x:set&gt;</a></td>
<td align="left">设置XPath表达式</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-if-tag.html" target="_blank" rel="noopener">&lt;x:if&gt;</a></td>
<td align="left">判断XPath表达式，若为真，则执行本体中的内容，否则跳过本体</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-foreach-tag.html" target="_blank" rel="noopener">&lt;x:forEach&gt;</a></td>
<td align="left">迭代XML文档中的节点</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-choose-tag.html" target="_blank" rel="noopener">&lt;x:choose&gt;</a></td>
<td align="left">&lt;x:when&gt;和&lt;x:otherwise&gt;的父标签</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-choose-tag.html" target="_blank" rel="noopener">&lt;x:when&gt;</a></td>
<td align="left">&lt;x:choose&gt;的子标签，用来进行条件判断</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-choose-tag.html" target="_blank" rel="noopener">&lt;x:otherwise&gt;</a></td>
<td align="left">&lt;x:choose&gt;的子标签，当&lt;x:when&gt;判断为false时被执行</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-transform-tag.html" target="_blank" rel="noopener">&lt;x:transform&gt;</a></td>
<td align="left">将XSL转换应用在XML文档中</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-xml-param-tag.html" target="_blank" rel="noopener">&lt;x:param&gt;</a></td>
<td align="left">与&lt;x:transform&gt;共同使用，用于设置XSL样式表</td>
</tr>
</tbody></table>
<h4 id="JSTL函数"><a href="#JSTL函数" class="headerlink" title="JSTL函数"></a>JSTL函数</h4><p>JSTL包含一系列标准函数，大部分是通用的字符串处理函数。引用JSTL函数库的语法如下：</p>
<pre><code>&lt;%@ taglib prefix=&quot;fn&quot; 
           uri=&quot;http://java.sun.com/jsp/jstl/functions&quot; %&gt;</code></pre><table>
<thead>
<tr>
<th align="left">函数</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-contains.html" target="_blank" rel="noopener">fn:contains()</a></td>
<td align="left">测试输入的字符串是否包含指定的子串</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-containsignoreCase.html" target="_blank" rel="noopener">fn:containsIgnoreCase()</a></td>
<td align="left">测试输入的字符串是否包含指定的子串，大小写不敏感</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-endswith.html" target="_blank" rel="noopener">fn:endsWith()</a></td>
<td align="left">测试输入的字符串是否以指定的后缀结尾</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-escapexml.html" target="_blank" rel="noopener">fn:escapeXml()</a></td>
<td align="left">跳过可以作为XML标记的字符</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-indexof.html" target="_blank" rel="noopener">fn:indexOf()</a></td>
<td align="left">返回指定字符串在输入字符串中出现的位置</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-join.html" target="_blank" rel="noopener">fn:join()</a></td>
<td align="left">将数组中的元素合成一个字符串然后输出</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-length.html" target="_blank" rel="noopener">fn:length()</a></td>
<td align="left">返回字符串长度</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-replace.html" target="_blank" rel="noopener">fn:replace()</a></td>
<td align="left">将输入字符串中指定的位置替换为指定的字符串然后返回</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-split.html" target="_blank" rel="noopener">fn:split()</a></td>
<td align="left">将字符串用指定的分隔符分隔然后组成一个子字符串数组并返回</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-startswith.html" target="_blank" rel="noopener">fn:startsWith()</a></td>
<td align="left">测试输入字符串是否以指定的前缀开始</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-substring.html" target="_blank" rel="noopener">fn:substring()</a></td>
<td align="left">返回字符串的子集</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-substringafter.html" target="_blank" rel="noopener">fn:substringAfter()</a></td>
<td align="left">返回字符串在指定子串之后的子集</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-substringbefore.html" target="_blank" rel="noopener">fn:substringBefore()</a></td>
<td align="left">返回字符串在指定子串之前的子集</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-tolowercase.html" target="_blank" rel="noopener">fn:toLowerCase()</a></td>
<td align="left">将字符串中的字符转为小写</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-touppercase.html" target="_blank" rel="noopener">fn:toUpperCase()</a></td>
<td align="left">将字符串中的字符转为大写</td>
</tr>
<tr>
<td align="left"><a href="http://www.runoob.com/jsp/jstl-function-trim.html" target="_blank" rel="noopener">fn:trim()</a></td>
<td align="left">移除首位的空白符</td>
</tr>
</tbody></table>
<h4 id="JSTL-中常用的标签"><a href="#JSTL-中常用的标签" class="headerlink" title="JSTL 中常用的标签"></a>JSTL 中常用的标签</h4><p><strong>1.逻辑判断标签(if,choose-when-otherwise)</strong></p>
<ul>
<li><strong>&lt;c:if&gt; 标签</strong></li>
<li>语法格式<pre><code>&lt;c:if test=&quot;&lt;boolean&gt;&quot; var=&quot;&lt;string&gt;&quot; scope=&quot;&lt;string&gt;&quot;&gt;
 ...
&lt;/c:if&gt;</code></pre></li>
<li>属性<br>&lt;c:if&gt;标签有如下属性：</li>
</ul>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
<th align="left">是否必要</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">test</td>
<td align="left">条件</td>
<td align="left">是</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left">var</td>
<td align="left">用于存储条件结果的变量</td>
<td align="left">否</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left">scope</td>
<td align="left">var属性的作用域</td>
<td align="left">否</td>
<td align="left">page</td>
</tr>
<tr>
<td align="left">- <strong>演示实例：</strong></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">```</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&lt;%@ page language=”java” contentType=”text/html; charset=UTF-8”</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">pageEncoding=”UTF-8”%&gt;</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&lt;%@ taglib uri=”<a href="http://java.sun.com/jsp/jstl/core&quot;" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/core&quot;</a> prefix=”c” %&gt;</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><html></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><head></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><title>c:if 标签实例</title></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><body></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&lt;c:set var=”salary” scope=”session” value=”${2000*2}”/&gt;</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">&lt;c:if test=”${salary &gt; 2000}”&gt;</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"><p>我的工资为: &lt;c:out value=”${salary}”/&gt;<p></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></c:if></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></body></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left"></html></td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">```</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">运行结果如下：</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">```</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">我的工资为: 4000</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
<tr>
<td align="left">```</td>
<td align="left"></td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody></table>
<ul>
<li><strong>&lt;c:choose&gt;, &lt;c:when&gt;, &lt;c:otherwise&gt; 标签</strong><br><code>&lt;c:choose&gt;</code>标签与 Java switch 语句的功能一样，用于在众多选项中做出选择。<br>switch 语句中有 case ，而<code>&lt;c:choose&gt;</code>标签中对应有 <code>&lt;c:when&gt;</code>，switch语句中有 default，而<code>&lt;c:choose&gt;</code>标签中有<code>&lt;c:otherwise&gt;</code>。</li>
<li>语法格式<pre><code>&lt;c:choose&gt;
  &lt;c:when test=&quot;&lt;boolean&gt;&quot;&gt;
      ...
  &lt;/c:when&gt;
  &lt;c:when test=&quot;&lt;boolean&gt;&quot;&gt;
      ...
  &lt;/c:when&gt;
  ...
  ...
  &lt;c:otherwise&gt;
      ...
  &lt;/c:otherwise&gt;
&lt;/c:choose&gt;</code></pre></li>
<li>属性<br><code>&lt;c:choose&gt;</code>标签没有属性。<br><code>&lt;c:when&gt;</code>标签只有一个属性，在下表中有给出。<br><code>&lt;c:otherwise&gt;</code>标签没有属性。<br><code>&lt;c:when&gt;</code>标签的属性如下：</li>
</ul>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
<th align="left">是否必要</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">test</td>
<td align="left">条件</td>
<td align="left">是</td>
<td align="left">无</td>
</tr>
</tbody></table>
<ul>
<li>实例演示<pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
  pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;c:choose 标签实例&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;c:set var=&quot;salary&quot; scope=&quot;session&quot; value=&quot;${2000*2}&quot;/&gt;
&lt;p&gt;你的工资为 : &lt;c:out value=&quot;${salary}&quot;/&gt;&lt;/p&gt;
&lt;c:choose&gt;
  &lt;c:when test=&quot;${salary &lt;= 0}&quot;&gt;
     太惨了。
  &lt;/c:when&gt;
  &lt;c:when test=&quot;${salary &gt; 1000}&quot;&gt;
     不错的薪水，还能生活。
  &lt;/c:when&gt;
  &lt;c:otherwise&gt;
      什么都没有。
  &lt;/c:otherwise&gt;
&lt;/c:choose&gt;
&lt;/body&gt;
&lt;/html&gt;</code></pre>运行结果如下：<pre><code>你的工资为 : 4000
</code></pre></li>
</ul>
<p>不错的薪水，还能生活。</p>
<pre><code>
**2.循环遍历标签(foreach)**
- **&lt;c:forEach&gt;标签**
- 语法格式</code></pre><p>&lt;c:forEach<br>    items=”<object>“<br>    begin=”<int>“<br>    end=”<int>“<br>    step=”<int>“<br>    var=”<string>“<br>    varStatus=”<string>“&gt;</p>
<pre><code>...</code></pre><pre><code>-  属性
`&lt;c:forEach&gt;`标签有如下属性：

属性 |    描述     |    是否必要|         默认值
:- |    :- |    :- |    :- |    
items     |    要被循环的信息     |    否     |    无
begin     |    开始的元素（0=第一个元素，1=第二个元素）|         否     |    0
end     |    最后一个元素（0=第一个元素，1=第二个元素）|         否     |    Last element
step |        每一次迭代的步长|         否     |    1
var     |    代表当前条目的变量名称     |    否     |    无
varStatus |        代表循环状态的变量名称     |    否     |    无

- 实例演示</code></pre><p>&lt;%@ page language=”java” contentType=”text/html; charset=UTF-8”<br>    pageEncoding=”UTF-8”%&gt;<br>&lt;%@ taglib uri=”<a href="http://java.sun.com/jsp/jstl/core&quot;" target="_blank" rel="noopener">http://java.sun.com/jsp/jstl/core&quot;</a> prefix=”c” %&gt;</p>
<html>
<head>
<title>c:forEach 标签实例</title>
</head>
<body>
<c:forEach var="i" begin="1" end="5">
   Item <c:out value="${i}"/><p>
</c:forEach>
</body>
</html>
```
运行结果如下：
```
Item 1
Item 2
Item 3
Item 4
Item 5
```

<p><strong>3.在 JSP 中实现日期的格式化:</strong></p>
<ul>
<li><strong><a href="fmt:formatDate">fmt:formatDate</a> 标签</strong></li>
<li>语法格式<pre><code>&lt;fmt:formatDate
value=&quot;&lt;string&gt;&quot;
type=&quot;&lt;string&gt;&quot;
dateStyle=&quot;&lt;string&gt;&quot;
timeStyle=&quot;&lt;string&gt;&quot;
pattern=&quot;&lt;string&gt;&quot;
timeZone=&quot;&lt;string&gt;&quot;
var=&quot;&lt;string&gt;&quot;
scope=&quot;&lt;string&gt;&quot;/&gt;</code></pre></li>
<li>属性<br><code>&lt;fmt:formatDate&gt;</code>标签有如下属性：</li>
</ul>
<table>
<thead>
<tr>
<th align="left">属性</th>
<th align="left">描述</th>
<th align="left">是否必要</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">value</td>
<td align="left">要显示的日期</td>
<td align="left">是</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left">type</td>
<td align="left">DATE, TIME, 或 BOTH</td>
<td align="left">否</td>
<td align="left">date</td>
</tr>
<tr>
<td align="left">dateStyle</td>
<td align="left">FULL, LONG, MEDIUM, SHORT, 或 DEFAULT</td>
<td align="left">否</td>
<td align="left">default</td>
</tr>
<tr>
<td align="left">timeStyle</td>
<td align="left">FULL, LONG, MEDIUM, SHORT, 或 DEFAULT</td>
<td align="left">否</td>
<td align="left">default</td>
</tr>
<tr>
<td align="left">pattern</td>
<td align="left">自定义格式模式</td>
<td align="left">否</td>
<td align="left">无</td>
</tr>
<tr>
<td align="left">timeZone</td>
<td align="left">显示日期的时区</td>
<td align="left">否</td>
<td align="left">默认时区</td>
</tr>
<tr>
<td align="left">var</td>
<td align="left">存储格式化日期的变量名</td>
<td align="left">否</td>
<td align="left">显示在页面</td>
</tr>
<tr>
<td align="left">scope</td>
<td align="left">存储格式化日志变量的范围</td>
<td align="left">否</td>
<td align="left">页面</td>
</tr>
</tbody></table>
<ul>
<li>实例演示<pre><code>&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=UTF-8&quot;
  pageEncoding=&quot;UTF-8&quot;%&gt;
&lt;%@ taglib prefix=&quot;c&quot; uri=&quot;http://java.sun.com/jsp/jstl/core&quot; %&gt;
&lt;%@ taglib prefix=&quot;fmt&quot; uri=&quot;http://java.sun.com/jsp/jstl/fmt&quot; %&gt;
</code></pre></li>
</ul>
<html>
<head>
  <title>JSTL fmt:dateNumber 标签</title>
</head>
<body>
<h3>日期格式化:</h3>
<c:set var="now" value="<%=new java.util.Date()%>" />

<p>日期格式化 (1): <fmt:formatDate type="time" 
            value="${now}" /></p>
<p>日期格式化 (2): <fmt:formatDate type="date" 
            value="${now}" /></p>
<p>日期格式化 (3): <fmt:formatDate type="both" 
            value="${now}" /></p>
<p>日期格式化 (4): <fmt:formatDate type="both" 
            dateStyle="short" timeStyle="short" 
            value="${now}" /></p>
<p>日期格式化 (5): <fmt:formatDate type="both" 
            dateStyle="medium" timeStyle="medium" 
            value="${now}" /></p>
<p>日期格式化 (6): <fmt:formatDate type="both" 
            dateStyle="long" timeStyle="long" 
            value="${now}" /></p>
<p>日期格式化 (7): <fmt:formatDate pattern="yyyy-MM-dd" 
            value="${now}" /></p>

</body>
</html>
```
以上实例运行结果：
```
日期格式化:

<p>日期格式化 (1): 11:19:43</p>
<p>日期格式化 (2): 2016-6-26</p>
<p>日期格式化 (3): 2016-6-26 11:19:43</p>
<p>日期格式化 (4): 16-6-26 上午11:19</p>
<p>日期格式化 (5): 2016-6-26 11:19:43</p>
<p>日期格式化 (6): 2016年6月26日 上午11时19分43秒</p>
<p>日期格式化 (7): 2016-06-26</p>
<pre><code>
---

&gt; 欢迎转载，转载请注明出处！   
&gt; 简书ID：[@我没有三颗心脏](https://www.jianshu.com/u/a40d61a49221)  
&gt; github：[wmyskxz](https://github.com/wmyskxz/)  
&gt; 欢迎关注公众微信号：wmyskxz
&gt; 分享自己的学习 &amp; 学习资料 &amp; 生活
&gt; 想要交流的朋友也可以加qq群：3382693</code></pre>
      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2018/04/07/chu-xue-java-web-5-cookie-session-xue-xi/">
      初学Java Web(5)——Cookie-Session学习
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/JavaWeb%E5%9F%BA%E7%A1%80/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>JavaWeb基础</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2018年4月7日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94cookie-session%E5%AD%A6%E4%B9%A0/7896890-0387853b70e04069.png" alt=""></p>
<h2 id="HTTP-协议"><a href="#HTTP-协议" class="headerlink" title="HTTP 协议"></a>HTTP 协议</h2><p><strong>Web 浏览器</strong>与 <strong>Web 服务器</strong>之间的<strong>一问一答的交互过程</strong>必须遵守<strong>一定的规则</strong>，这样的规则就是 <strong>HTTP 协议。</strong></p>
<p><strong>HTTP</strong> 是 <strong>hypertext transfer protocol（超文本传输协议）</strong>的简写，它是 <strong>TCP/IP 协议之上</strong>的一个<strong>应用层的协议</strong>，用于<strong>定义 Web 浏览器与 Web 服务器之间交互数据的过程以及数据本身的格式。</strong></p>
<ul>
<li><strong>特点：无状态，默认端口 80</strong></li>
</ul>
<h4 id="HTTP-协议到底约束了什么？"><a href="#HTTP-协议到底约束了什么？" class="headerlink" title="HTTP 协议到底约束了什么？"></a>HTTP 协议到底约束了什么？</h4><ol>
<li>约束了浏览器以<strong>何种格式</strong>向服务端<strong>发送数据</strong></li>
<li>约束了服务器应该以<strong>何种格式</strong>来<strong>接收客户端发送的数据</strong></li>
<li>约束了服务器应该以<strong>何种格式</strong>来<strong>反馈数据</strong>给浏览器</li>
<li>约束了浏览器应该以<strong>何种格式</strong>来<strong>接收服务器的反馈数据</strong></li>
</ol>
<ul>
<li><strong>总结：</strong><br>浏览器给服务器发送数据:<strong>一次请求</strong><br>服务器给浏览器反馈数据:<strong>一次响应</strong></li>
</ul>
<h4 id="HTTP-无状态协议"><a href="#HTTP-无状态协议" class="headerlink" title="HTTP 无状态协议"></a>HTTP 无状态协议</h4><p><strong>HTTP</strong> 是一个<strong>无状态的协议</strong>，也就是没有记忆力，这意味着<strong>每一次的请求都是独立的</strong>，缺少状态意味着如果后续处理需要前面的信息，则它必须要重传，这样可能导致<strong>每次连接传送的数据量增大。</strong>另一方面，在服务器不需要先前信息时它的<strong>应答就很快。</strong></p>
<p><strong>HTTP</strong> 的这种特性有优点也有缺点：</p>
<ul>
<li><strong>优点：</strong>解放了服务器，每一次的请求“点到为止”，<strong>不会造成不必要的连接占用。</strong></li>
<li><strong>缺点：</strong>每次请求会<strong>传输大量重复的内容信息，</strong>并且，在<strong>请求之间无法实现数据的共享。</strong></li>
</ul>
<h4 id="主要问题：请求之间无法实现数据的共享"><a href="#主要问题：请求之间无法实现数据的共享" class="headerlink" title="主要问题：请求之间无法实现数据的共享"></a>主要问题：请求之间无法实现数据的共享</h4><ul>
<li>解决方案：</li>
</ul>
<p><strong>1.使用参数传递机制：</strong><br>将参数拼接在请求的 URL 后面，实现数据的传递（GET方式），例如：<code>/param/list?username=wmyskxz</code><br><strong>问题：</strong>可以解决数据共享的问题，但是这种方式一<strong>不安全</strong>，二数据<strong>允许传输量只有1kb</strong><br><strong>2.使用Cookie技术</strong><br><strong>3.使用Session技术</strong></p>
<hr>
<h2 id="Cookie-技术"><a href="#Cookie-技术" class="headerlink" title="Cookie 技术"></a>Cookie 技术</h2><ul>
<li><strong>特点：客户端的技术，将共享数据保存在客户端（浏览器）中</strong></li>
</ul>
<p>英文直接翻译过来就是<strong>小甜品</strong>，Cookie 的作用呢，通俗的说就是当一个用户通过 <strong>HTTP</strong> 访问一个服务器时，这个服务器会将一些 <strong>Key/Value 键值对</strong>返回给<strong>客户端浏览器</strong>，并给这些数据加上一些<strong>限制条件</strong>，在<strong>条件符合时</strong>这个用户下次访问这个服务器时，数据又被<strong>完整地带回给服务器。</strong></p>
<p>这个作用就像是你去超市购物时，第一次给你办了一张购物卡，在这个购物卡里存放了一些你的个人信息，下次你再来这个超市的时候，你就只需要带上你的购物卡，直接购物就好了。</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94cookie-session%E5%AD%A6%E4%B9%A0/7896890-d5de686e11821eb1.png" alt=""></p>
<h4 id="Cookie-操作"><a href="#Cookie-操作" class="headerlink" title="Cookie 操作"></a>Cookie 操作</h4><ol>
<li>创建 Cookie 对象，设置共享数据<pre class=" language-java"><code class="language-java">Cookie c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span>String value<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// 相当于办卡</span></code></pre>
</li>
</ol>
<ul>
<li><strong>注意：</strong>一个Cookie只能<strong>存储一个字符串类型的数据,</strong>不能存储其他类型的数据</li>
</ul>
<ol start="2">
<li>将 Cookie 响应给浏览器<pre class=" language-java"><code class="language-java">response对象<span class="token punctuation">.</span><span class="token function">addCookie</span><span class="token punctuation">(</span>cookie对象<span class="token punctuation">)</span>                <span class="token comment" spellcheck="true">// 相当于把卡交给用户</span></code></pre>
</li>
<li>获取请求中的 Cookie 信息<pre class=" language-java"><code class="language-java">Cookie<span class="token punctuation">[</span><span class="token punctuation">]</span> cs <span class="token operator">=</span> request对象<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span><span class="token punctuation">(</span>Cookie c <span class="token operator">:</span> cs<span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">if</span><span class="token punctuation">(</span>“username”<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     String value <span class="token operator">=</span> c<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
</li>
<li>修改 Cookie 中的共享数据</li>
<li>重新创建一个新的 Cookie，名称要和要修改的数据一致</li>
<li>现获取到要修改的 Cookie 对象，再调用 <code>setValue(String newValue)</code> 重新设置</li>
</ol>
<ul>
<li><strong>注意：修改 Cookie 中的数据，需要再次发送给浏览器（第2点）</strong></li>
</ul>
<ol start="5">
<li>操作 Cookie 的生命周期</li>
</ol>
<ul>
<li><strong>默认：</strong>在关闭浏览器的时候销毁 Cookie 对象</li>
<li><strong>语法：</strong><code>void setMaxAge(int expiry)</code><br>expiry &gt; 0：设置 Cookie 对象能够<strong>存活 expiry 秒，即使关闭浏览器，也不影响 Cookie 中的共享数据，</strong>比如设置一个月：<code>setMaxAge(60*60*24*30);</code><br>expiry = 0：<strong>立即删除</strong>当前的 Cookie 信息<br>expiry &lt; 0：<strong>关闭浏览器时销毁</strong></li>
</ul>
<ol start="6">
<li><p>删除 Cookie 中的共享数据<br>通过<code>setMaxAge(0)</code>来实现</p>
</li>
<li><p>Cookie 中的 key 和 value 不支持中文<br>设置 Cookie 时需要对中文字符串进行编码：</p>
<pre class=" language-java"><code class="language-java"> Cookie c <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Cookie</span><span class="token punctuation">(</span><span class="token string">"username"</span><span class="token punctuation">,</span> URLEncoder<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span><span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p> 在获取 Cookie 数据的时候再进行解码：</p>
<pre class=" language-java"><code class="language-java"> username <span class="token operator">=</span> URLDecoder<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>value<span class="token punctuation">,</span> <span class="token string">"UTF-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>Cookie 的路径和域范围</p>
</li>
</ol>
<ul>
<li><strong>Cookie 的路径</strong><br>Cookie 在创建的时候，会根据当前的<strong>Servlet的相对路径</strong>来设置自己的路径，比如 Servlet 的<code>url-pattern</code>为 <strong>/cookie/login</strong>，相对路径则为：<strong>/cookie/</strong><ul>
<li><strong>出现的问题：</strong><br>只有在访问路径为 <strong>/cookie/</strong> 下面的资源的时候，才会将该 Cookie 发送到服务器</li>
<li><strong>解决方案：</strong><br>设置 Cookie 的路径：<code>void setPath(String uri)</code><br><code>Cookie对象.setPath(&quot;/&quot;);</code> 表示当前应用中的所有的资源都能够共享该Cookie信息</li>
</ul>
</li>
<li><strong>域范围：</strong>（了解）<br>在多个应用之间实现数据的共享，那么就需要设置域范围，比如：<br><code>www.baidu.com / news.baidu.com / map.baidu.com</code></li>
<li><strong>语法：</strong><code>Cookie对象.setDomain(&quot;baidu.com&quot;);</code></li>
</ul>
<h4 id="Cookie-的缺陷"><a href="#Cookie-的缺陷" class="headerlink" title="Cookie 的缺陷"></a>Cookie 的缺陷</h4><p>Cookie 的作用其实就是一种会话跟踪技术，但存在一些缺陷：</p>
<ol>
<li>获取 Cookie 信息<strong>比较麻烦</strong></li>
<li>Cookie <strong>不支持中文</strong></li>
<li>一个 Cookie 只能<strong>存储一个字符串类型的数据</strong></li>
<li>Cookie 在浏览器中<strong>有大小和数量上的限制</strong>（不同浏览器存在不同的限制，例如FireFox一个站点最多存储50个 Cookie ，浏览器最多存储 4097个字大小的 Cookie）</li>
<li>共享数据时保存在浏览器中，容易造成数据的泄露，<strong>不安全</strong></li>
</ol>
<ul>
<li><strong>最好的解决方案：将数据保存在服务端（session）</strong></li>
</ul>
<hr>
<h2 id="Session-技术"><a href="#Session-技术" class="headerlink" title="Session 技术"></a>Session 技术</h2><p>Session：会话，<strong>从浏览器打开开始，直到浏览器关闭结束，</strong>无论在这个网站中访问了多少页面，点击了多少链接，都属于同一个会话。Session 也可以称为<strong>会话 Cookie</strong></p>
<ul>
<li><strong>特点：服务端技术，将数据保存在服务器</strong></li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%885%EF%BC%89%E2%80%94%E2%80%94cookie-session%E5%AD%A6%E4%B9%A0/7896890-26ddad87e6728548.png" alt=""></p>
<h4 id="理解-Session"><a href="#理解-Session" class="headerlink" title="理解 Session"></a>理解 Session</h4><p>前面已经介绍了 Cookie 可以让服务端程序<strong>跟踪每个客户端的访问</strong>，但是每次客户端的访问都必须传回这些 Cookie，<strong>如果 Cookie 很多，则无形增加了客户端与服务端的数据传输量，</strong>而 Session 的出现正是为了解决这个问题。</p>
<p>同一个客户端每次和服务端交互时，不需要每次都传回所有的 Cookie 值，而是<strong>只要传回一个 ID</strong>，这个 ID 就是客户端第一次访问服务器生成的，而且<strong>每个客户端是唯一的。</strong>这样每个客户端就有了一个唯一的 ID，客户端只要传回这个 ID 就行了，<strong>这个 ID 通常是 NAME 为 JSESIONID 的一个 Cookie。</strong></p>
<h4 id="Session-基本操作"><a href="#Session-基本操作" class="headerlink" title="Session 基本操作"></a>Session 基本操作</h4><ol>
<li>获取 Session 对象<br><code>request对象.getSession()</code><br>和参数为true的一样<br><code>request对象.getSession(true)</code><br>获取Session对象,如果没有Session对象,直接创建一个新的返回,缺省值<br><code>request对象.getSession(false)</code><br>获取Session对象,如果没有返回null</li>
<li>设置共享数据<pre class=" language-java"><code class="language-java">Session对象<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span>String name<span class="token punctuation">,</span> Object value<span class="token punctuation">)</span></code></pre>
</li>
</ol>
<ul>
<li><strong>注意：</strong>Session 可以<strong>存储任何类型的数据,</strong>比如登陆用户的信息,可以封装到User对象中</li>
</ul>
<ol start="3">
<li><p>修改共享数据<br>重新设置一个同名的共享数据</p>
</li>
<li><p>获取共享数据</p>
<pre class=" language-java"><code class="language-java">Object value <span class="token operator">=</span> Session对象<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>删除 Session 中的共享数据</p>
<pre class=" language-java"><code class="language-java">Session对象<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span>String name<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
</li>
<li><p>销毁 Session</p>
<pre class=" language-java"><code class="language-java"><span class="token keyword">void</span> <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> </code></pre>
</li>
<li><p>Session 的超时管理</p>
</li>
</ol>
<ul>
<li><strong>超时：</strong>在访问当前的资源的过程中,不和网页进行任何的交互,超过设定的时间就是超时<br>在 Tomcat 服务器中有默认的配置为30分钟，一般不需要去修改</li>
<li><strong>语法：</strong><code>void setMaxInactiveInterval(int interval)</code></li>
</ul>
<h4 id="Session-扩展"><a href="#Session-扩展" class="headerlink" title="Session 扩展"></a>Session 扩展</h4><ul>
<li><strong>Seesion 中的共享数据的属性名的命名规范：</strong><br>通常为：XXX_IN_SESSION，例如：<code>Session对象.setAttribute(“USER_IN_SESSION”,user)</code></li>
<li><strong>序列化与反序列化：</strong><br>Session 中存储的对象通常需要<strong>实现序列化接口</strong>，因为在网络之间传输的数据格式为<strong>二进制数据</strong>：<ul>
<li><strong>序列化：将对象转换成二进制数据</strong></li>
<li><strong>反序列化:将二进制数据转换成对象</strong></li>
</ul>
</li>
<li><strong>URL 重写</strong></li>
</ul>
<p><strong>出现的问题：</strong><br><strong>当浏览器禁用Cookie之后,</strong>那么我们的jsessionid就不能在浏览器中保存,那么<strong>后面的请求</strong>中就不会将 jsessionid 发送到服务器,服务器这面就<strong>找不到数据</strong><br><strong>解决方案：</strong><br>1.在url后手动的拼接上 jsessionid<br>传递格式如 <code>/path/Servlet;jsessionid=sessionid</code><br>2.使用响应对象中的encodeURL(String path)<strong>实现 jsessionid 的自动拼接</strong><br><code>String path = resp.encodeURL(&quot;path/Servlet&quot;);</code></p>
<ul>
<li><strong>推荐方式：②</strong></li>
</ul>
<hr>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2018/04/06/chu-xue-java-web-4-servlet-xue-xi-zong-jie/">
      初学Java Web(4)——Servlet学习总结
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/JavaWeb%E5%9F%BA%E7%A1%80/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>JavaWeb基础</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2018年4月6日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-65cb65e46c091671.png" alt=""></p>
<blockquote>
<p>经过一段时间的学习，对于Servlet有了新的不一样的见解，在这里做一下总结，将近来学习到的知识总结一下。</p>
</blockquote>
<hr>
<h3 id="Servlet-的请求流程"><a href="#Servlet-的请求流程" class="headerlink" title="Servlet 的请求流程"></a>Servlet 的请求流程</h3><ol>
<li><p><strong>浏览器发出请求：</strong><a href="http://localhost:80/xxx1/xxx2" target="_blank" rel="noopener">http://localhost:80/xxx1/xxx2</a> （80端口可以默认不写，因为这是http协议默认的端口，平时我们访问<a href="https://www.baidu.com/" target="_blank" rel="noopener">https://www.baidu.com/</a> 时其实访问的是<a href="https://www.baidu.com:80/）" target="_blank" rel="noopener">https://www.baidu.com:80/）</a></p>
</li>
<li><p><strong>服务器解析请求信息：</strong></p>
<ul>
<li><strong>http:</strong>协议名称</li>
<li><strong>localhost:</strong>访问的是互联网中的<strong>哪一台计算机</strong></li>
<li><strong>80:</strong>从主机当中找到<strong>对应 80 端口的程序 **（</strong>这里即为 Tomcat 服务器**）</li>
<li><strong>/xxx1:</strong>当前项目的<strong>上下文路径</strong> （即在 server.xml 中配置主机时配置的 <strong>path属性</strong>）</li>
<li><strong>/xxx2:</strong>当前<strong>请求的资源名</strong></li>
</ul>
</li>
<li><p><strong>解析</strong> Tomcat 服务器根目录下的 <strong>/config/server.xml</strong> 文件：<br><code>&lt;Context docBase=&quot;D:\javaPros\test\webapp&quot; path=&quot;xxx1&quot; /&gt;</code><br>判断哪一个<code>&lt;Context /&gt;```元素的 **path属性** 属性为 ```xxx1</code></p>
<ul>
<li>若找不到，则返回 <strong>404错误</strong></li>
<li>若找到了，则解析该<code>&lt;Context /&gt;</code>元素，得到<code>docBase</code>属性，获取当前访问 Web 项目的跟的绝对路径：<code>D:\javaPros\test\webapp</code></li>
</ul>
</li>
<li><p>从<code>D:\javaPros\test\webapp</code>下的 <strong>WEB-INF</strong> 下找到 <strong>web.xml</strong> 文件<br>判断 <strong>web.xml</strong> 文件中是否有 <code>&lt;url-pattern&gt;</code> 的文本内容为 <strong>/xxx2</strong></p>
<ul>
<li>若找不到，则返回 <strong>404错误</strong></li>
<li>若找到了，则继续<strong>获取该资源对应 Servlet 类的全限名称：</strong> xxx.xxx</li>
</ul>
</li>
<li><p>判断 <strong>Servlet 实例缓存池</strong> 中是否有 xxx.xxx 的对象</p>
</li>
</ol>
<pre class=" language-java"><code class="language-java">Map<span class="token operator">&lt;</span>String<span class="token punctuation">,</span>Servlet<span class="token operator">></span> cache <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">(</span>Tomcat提供的<span class="token punctuation">)</span><span class="token punctuation">;</span>
    key<span class="token operator">:</span>存Servlet类的全限定名称
    value<span class="token operator">:</span>该Servlet类的对象<span class="token punctuation">.</span>
Servlet obj <span class="token operator">=</span> cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"xxx.xxx"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>obj<span class="token operator">==</span>null<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//Servlet实例缓存中没有该类的对象,第一次.</span>
        GOTO <span class="token number">6</span><span class="token operator">:</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
        <span class="token comment" spellcheck="true">//有对象,非第一次.</span>
        GOTO <span class="token number">8</span><span class="token operator">:</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<ol start="6">
<li><strong>使用反射</strong>调用构造器，<strong>创建对应的对象</strong></li>
</ol>
<p><code>obj = Class.forName(&quot;xxx.xxx&quot;).newInstance();</code></p>
<p>把当前创建的 <strong>Servlet 对象</strong>，存放在缓存之中，<strong>供给下一次的使用.</strong></p>
<p><code>cache.put(&quot;xxx.xxx&quot;,obj);</code></p>
<ol start="7">
<li>创建 <strong>ServletConfig 对象</strong>，并调用 <strong>init()</strong> 方法</li>
</ol>
<p><code>obj.init(config);</code></p>
<ol start="8">
<li>创建 <strong>ServletRequest 对象和 ServletResponse 对象</strong>，并调用 <strong>service()</strong>方法</li>
</ol>
<p><code>obj.service(req,resp);</code></p>
<ol start="9">
<li>在 <strong>service()</strong> 方法中对浏览器作出响应操作。</li>
</ol>
<hr>
<h3 id="Servlet-生命周期"><a href="#Servlet-生命周期" class="headerlink" title="Servlet 生命周期"></a>Servlet 生命周期</h3><p>在 Web 容器中，Servlet 主要经历 4 个阶段，如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-2599bf65a828350d.png" alt="Servlet 生命周期"></p>
<ol>
<li><strong>加载 Servlet：</strong>当 Tomcat <strong>第一次访问 Servlet</strong> 的时候，Tomcat 会负责<strong>创建 Servlet 的实例。</strong></li>
<li><strong>初始化 Servlet：</strong>当 Servlet 被实例化之后，Tomcat 会调用 <strong>init()</strong> 方法来初始化这个对象。</li>
<li><strong>处理服务：</strong>当浏览器<strong>访问 Servlet</strong> 的时候，Servlet 会调用 <strong>service()</strong> 方法处理请求。</li>
<li><strong>销毁：</strong>当 <strong>Tomcat 关闭</strong>或者<strong>检测到 Servlet 要从 Tomcat 删除</strong>的时候，会自动调用 <strong>destroy()</strong> 方法，让该实例所占用的资源释放掉。一个 Servlet 如果长时间不被使用的话，也会被 Tomcat 自动销毁。</li>
</ol>
<ul>
<li><strong>简单总结：</strong>只要访问 Servlet ，就会调用其对应的 <strong>service()</strong> 方法，<strong>init()</strong> 方法只会在第一次访问 Serlvet 的时候才会被调用。</li>
</ul>
<blockquote>
<p>这一部分参考文章：<a href="https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483680&idx=3&sn=d5380ff58c5077271ac9c43d2d96f6c1&chksm=ebd74021dca0c93733255324df8c1e522dbe36ccaf8c2c4bcca4765113a120eb9851ca0e2442#rd" target="_blank" rel="noopener">这里是链接</a></p>
</blockquote>
<hr>
<h3 id="Servlet-提供处理请求的方法"><a href="#Servlet-提供处理请求的方法" class="headerlink" title="Servlet 提供处理请求的方法"></a>Servlet 提供处理请求的方法</h3><p><a href="https://www.jianshu.com/p/bbdc459b9187" target="_blank" rel="noopener">前面的文章</a>里面提到过，广义上，<strong>Servlet</strong> 即实现了 <strong>Servlet 接口</strong> 的类，当我们创建一个自定义类，实现 <strong>Servlet 接口</strong> 的时候，会发现有 5 个方法需要重写，有init【初始化】，destroy【销毁】,service【服务】,ServletConfig【Servlet配置】,getServletInfo【Serlvet信息】。</p>
<p>这样做的话，我们每次都需要实现 5 个方法，太麻烦了！</p>
<p>我们可以直接<strong>继承 HttpServlet</strong> 类，该类已经默认实现了 Servlet 接口中的所有方法，在编写 Servlet 的时候，你只需要<strong>重写你需要的方法</strong>就好了，并且该类还在原有 Servlet 接口上添加了一些与 HTTP 协议处理相关的方法，比 Servlet 接口的功能<strong>更强大。</strong></p>
<ul>
<li>Servlet 处理请求的方法一共有三种：<br>① 实现 <strong>service()</strong> 方法。<br>② 重写 <strong>doGet()</strong> 和 <strong>doPost()</strong> 方法，并在 <strong>doGet()</strong> 中添加一句<code>this.doPost(req, resp);</code>（因为无论是get或post请求提交的数据，处理方式都基本相同，下同）<br>③ 重写 <strong>doGet()</strong> 和 <strong>doPost()</strong> 方法，并在 <strong>doPost()</strong> 中添加一句<code>this.doGet()(req, resp);</code></li>
<li><strong>推荐方式①。</strong></li>
</ul>
<hr>
<h3 id="Servlet-是单例的"><a href="#Servlet-是单例的" class="headerlink" title="Servlet 是单例的"></a>Servlet 是单例的</h3><h4 id="为什么Servlet是单例的"><a href="#为什么Servlet是单例的" class="headerlink" title="为什么Servlet是单例的"></a>为什么Servlet是单例的</h4><p><strong>浏览器多次对Servlet的请求，</strong>一般情况下，<strong>服务器只创建一个Servlet对象，</strong>也就是说，Servlet对象<strong>一旦创建了，</strong>就会<strong>驻留在内存中，为后续的请求做服务，直到服务器关闭。</strong></p>
<h4 id="每次访问请求对象和响应对象都是新的"><a href="#每次访问请求对象和响应对象都是新的" class="headerlink" title="每次访问请求对象和响应对象都是新的"></a>每次访问请求对象和响应对象都是新的</h4><p>对于<strong>每次访问请求，</strong>Servlet引擎都会<strong>创建一个新的HttpServletRequest请求对象和一个新的HttpServletResponse响应对象，</strong>然后将这<strong>两个对象作为参数传递给它调用的Servlet的service()方法，</strong>service方法再根据请求方式分别调用doXXX方法。</p>
<h4 id="线程安全问题"><a href="#线程安全问题" class="headerlink" title="线程安全问题"></a>线程安全问题</h4><p>当多个用户访问Servlet的时候，<strong>服务器会为每个用户创建一个线程。</strong>当多个用户并发访问Servlet共享资源的时候就会出现线程安全问题。</p>
<p><strong>原则：</strong><br>    1. 如果一个变量<strong>需要多个用户共享</strong>，则应当在访问该变量的时候，<strong>加同步机制synchronized (对象){}</strong><br>    2. 如果一个变量<strong>不需要共享，</strong>则<strong>直接在 doGet() 或者 doPost()定义</strong>.这样不会存在线程安全问题</p>
<blockquote>
<p>这一部分参考文章：<a href="https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&mid=2247483680&idx=4&sn=2fdf4d0075d093389c03697ebdb9f47d&chksm=ebd74021dca0c937a240f47578b9c5f40093a307f6537d79d5a2fd12721c5311a9d89d5c5583#rd" target="_blank" rel="noopener">这里是链接</a></p>
</blockquote>
<hr>
<h3 id="HttpServletRequest-和-HttpServletResponse-对象"><a href="#HttpServletRequest-和-HttpServletResponse-对象" class="headerlink" title="HttpServletRequest 和 HttpServletResponse 对象"></a>HttpServletRequest 和 HttpServletResponse 对象</h3><p>对于<strong>每次访问</strong>请求，<strong>Servlet引擎</strong>都会创建一个<strong>新的HttpServletRequest请求对象</strong>和一个<strong>新的HttpServletResponse响应对象</strong>，即 request 和 response 对象。</p>
<p>既然 request 对象代表 http 请求，那么我们<strong>获取浏览器提交过来的数据，就找 request 对象</strong> 即可。response 对象代表 http 响应，那么我们<strong>向浏览器输出数据，找 response 对象</strong>即可。</p>
<h3 id="HttpServletRequest-常用方法"><a href="#HttpServletRequest-常用方法" class="headerlink" title="HttpServletRequest 常用方法"></a>HttpServletRequest 常用方法</h3><ul>
<li><strong>String getContextPath():</strong><br>获取上下文路径,&lt;Context path=”上下文” ../&gt;</li>
<li><strong>String getHeader(String headName):</strong><br>根据指定的请求头获取对应的请求头的值.</li>
<li><strong>String getRequestURI():</strong><br>返回当期请求的资源名称.  上下文路径/资源名</li>
<li><strong>StringBuffer getRequestURL():</strong><br>返回浏览器地址栏的内容</li>
<li><strong>String getRemoteAddr():</strong><br>返回请求服务器的客户端的IP</li>
</ul>
<h4 id="获取请求参数的方法："><a href="#获取请求参数的方法：" class="headerlink" title="获取请求参数的方法："></a>获取请求参数的方法：</h4><ul>
<li><strong>String getParameter(String name):</strong><br>根据参数名称,获取对应参数的值.</li>
<li><strong>String[] getParameterValues(String name):</strong><br>根据参数名称,获取该参数的多个值.</li>
<li><strong>Enumeration<String> getParameterNames():</strong><br>获取所有请求参数的名字</li>
<li><strong>Map&lt;String,String[]&gt; getParameterMap():</strong><br>返回请求参数组成的Map集合.</li>
</ul>
<p><strong>key:</strong>参数名称<br><strong>value:</strong>参数值,封装在String数组中.</p>
<h3 id="HttpServletResponse-常用方法"><a href="#HttpServletResponse-常用方法" class="headerlink" title="HttpServletResponse 常用方法"></a>HttpServletResponse 常用方法</h3><ul>
<li><strong>OutputStream getOutputStream():</strong><br>获取字节输出流:<strong>文件下载</strong></li>
<li><strong>Writer getWriter():</strong><br>获取字符输出流:<strong>输出内容</strong><br>设置文件输出的编码格式和内容类型：<code>resp.setContentType(&quot;text/html;charset=utf-8&quot;);</code></li>
</ul>
<hr>
<h3 id="GET-和-POST-的区别"><a href="#GET-和-POST-的区别" class="headerlink" title="GET 和 POST 的区别"></a>GET 和 POST 的区别</h3><p>要知道，GET 和 POST 都是请求方式</p>
<ul>
<li><strong>GET：</strong><br>浏览器器地址栏：<code>http://localhost/test.html</code><strong>?name=wmyskxz&amp;sex=male</strong><br>这里提交了两个参数，一个是<code>name</code>属性值为<code>wmyskxz</code>，另一个是<code>sex</code>属性值为<code>male</code>，这是一种直接的请求方式，在请求资源后面跟上 <strong>?</strong> 符号与参数连接，其他的参数使用 <strong>&amp;</strong> 符号连接。</li>
<li><strong>缺点：</strong></li>
</ul>
<p>1.暴露请求信息，<strong>不安全</strong><br>2.请求信息不能超过<strong>1kb</strong>，可传输的信息有限，不能上传图片</p>
<ul>
<li><strong>POST：</strong><br>浏览器地址栏：<code>http://localhost/test.html#</code></li>
<li><strong>优点：</strong></li>
</ul>
<p>1.隐藏了请求信息，<strong>较安全</strong>（但仍可以通过相关工具访问到数据）<br>2.POST 方式<strong>没有限制</strong>请求的数据大小，可以做图片的上传</p>
<blockquote>
<p>但并不是所有的数据都需要使用 POST 请求来完成，事实上，GET 请求方式会比 POST 请求更快，当数据小并且安全性要求不是那么高的时候，GET 仍然是很好的选择.(并且 GET 相较 POST 简单)</p>
</blockquote>
<hr>
<h3 id="请求中文乱码的处理"><a href="#请求中文乱码的处理" class="headerlink" title="请求中文乱码的处理"></a>请求中文乱码的处理</h3><p>在 <strong>Tomcat 服务器</strong>中，接受请求的时候，<strong>默认的编码方式为 ISO-8859-1</strong>，而该编码方式只占一个字节，不支持中文（两个字节），所以当我们做请求的时候，会出现乱码的问题</p>
<ul>
<li><strong>解决方案：</strong></li>
</ul>
<p>1.对乱码使用 <strong>ISO-8859-1</strong> 解码，转换成<strong>byte数组</strong>，恢复为二进制<br><code>byte[] data = name.getBytes(&quot;ISO-8859-1&quot;);</code><br>2.对byte数组重新进行 UTF-8 编码：<br><code>name = new String(data,&quot;UTF-8&quot;);</code><br>但是这样会出现一个问题，那就是当表单数据太多的时候，这样反复解码-编码，会很繁琐。</p>
<ul>
<li><strong>终极解决方案：</strong></li>
</ul>
<p><strong>1.对于 POST 请求：</strong><br>设置请求的编码方式：<code>request.setCharacterEncoding(&quot;UTF-8&quot;);</code><br><strong>注意：</strong>必须在获取<strong>第一个参数之前设置</strong>，并且该方式<strong>只对 POST 方式有效。</strong><br><strong>2.对于 GET 请求：</strong><br>重新设置 Tomcat 的编码方式，修改 Tomcat 的配置文件:<br><code>Tomcat根目录/conf/server.xml(修改端口的那一行)</code><br><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-cd366b295c8ed531.png" alt=""></p>
<hr>
<h3 id="Servlet-细节"><a href="#Servlet-细节" class="headerlink" title="Servlet 细节"></a>Servlet 细节</h3><ul>
<li>1.一个 Servlet 可以有<strong>多个</strong> <code>&lt;url-pattern&gt;</code> ，可以使用多个资源名称找到当前的 Servlet</li>
<li>2.配置 Servlet 可以使用<strong>通配符</strong>（<em>）<br><code>*</code>表示任意字符<br><code>/*</code>：可以使用<strong>任意的字符</strong>访问当前的 Servlet<br>`</em>.xxx`：如 wmyskxz.wudi</li>
<li>3.<strong>自定义的 Servlet 的 <code>&lt;servlet-name&gt;</code> 不能够为 default ，</strong>使用它会造成项目下面的静态资源找不到，在 <code>Tomcat/conf/web.xml</code> 文件中配置一个名字为default的Servlet,该Servlet在负责访问项目下的静态资源<br><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-23070ab172726a2e.png" alt="web.xml 中配置的默认项"></li>
<li>4.关于 <strong>Servlet 的初始化操作，</strong>如果初始化操作非常的耗时，那么第一个请求的用户的用户体验就非常差</li>
</ul>
<p><strong>解决思路：</strong>将初始化操作<strong>向前移,</strong>在服务器启动的时候执行 Servlet 的初始化<br><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-afae824b9279c9ff.png" alt=""></p>
<hr>
<h3 id="通过注解配置-Servlet"><a href="#通过注解配置-Servlet" class="headerlink" title="通过注解配置 Servlet"></a>通过注解配置 Servlet</h3><p>这是 Servlet 3.0 提出的新特性，支持注解配置，这大大简化了我们的工作。</p>
<p>在之前的开发工作中，我们总是去 <code>web.xml</code> 文件中进行配置，至少会出现8行：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-1e9520edba4da3bc.png" alt="web.xml 中配置 Servlet"></p>
<p>而当一个项目中存在<strong>很多 Servlet **，那么配置文件就会变得</strong>非常臃肿，不便于后期的维护，<strong>在 Servlet 3.0 推出之后，我们可以使用</strong>注解来配置 Servlet，**上面 8 行的配置可以简化为下面的简单的注解：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-9bb5cb4ed2098464.png" alt=""></p>
<p>或者也可以使用属性 <code>value</code> 定义访问的 URL，<strong>只有 URL 这个属性是必要的，</strong><code>name</code> 是可以缺省的值，而默认的 <code>value</code> 也可以省略不写，所以可以简写成：</p>
<pre class=" language-java"><code class="language-java"><span class="token annotation punctuation">@WebServlet</span><span class="token punctuation">(</span><span class="token string">"/foreServlet"</span><span class="token punctuation">)</span></code></pre>
<hr>
<h3 id="Web-组件之间的跳转方式"><a href="#Web-组件之间的跳转方式" class="headerlink" title="Web 组件之间的跳转方式"></a>Web 组件之间的跳转方式</h3><h4 id="1-请求转发（forward）"><a href="#1-请求转发（forward）" class="headerlink" title="1.请求转发（forward）"></a><strong>1.请求转发（forward）</strong></h4><p>又叫做<strong>直接转发方式，</strong>客户端和浏览器<strong>只发出一次请求，</strong>Servlet、HTML、JSP或其它信息资源，由<strong>第二个信息资源响应该请求，</strong>在请求对象request中，保存的对象对于<strong>每个信息资源是共享的。</strong></p>
<p>比如：从 AServlet 请求转发到 BServlet</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-881fc9bb05d46ac8.png" alt=""></p>
<ul>
<li><strong>语法：</strong></li>
</ul>
<pre class=" language-java"><code class="language-java">request<span class="token punctuation">.</span><span class="token function">getRequestDispatcher</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forward</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><em>参数：</em><code>path</code>，要跳转到的资源路径：<strong>上下文路径 / 资源路径</strong></p>
<ul>
<li><strong>特点：</strong></li>
</ul>
<p><strong>1.地址栏中的地址【不会】改变</strong><br>通常看作是服务端的跳转<br><strong>2.只有一个请求</strong><br><strong>3.资源是共享的，</strong>也就是说在两个 Servlet 中可以共享请求的资源<br>可以通过<code>request.setAttribute(String var1,Object var2)</code><strong>设置要共享的数据资源</strong>，并通过<code>request.getAttribute(String var1);</code>来<strong>获取传递的资源</strong><br><strong>4.【可以】访问 WEB-INF 中的资源</strong><br><strong>WEB-INF</strong> 文件夹是 Java Web 应用的<strong>默认安全目录，</strong>即客户端无法直接访问，只有服务端可以访问的目录。<br>如果想在页面中<strong>直接访问</strong>其中的文件，<strong>必须通过web.xml文件</strong>对要访问的文件进行<strong>相应映射</strong>才能访问。<br><strong>注意：</strong>在实际的开发中，可以把不希望用户直接访问到（通过浏览器输入地址栏）的网页放在文件夹中<strong>通过此方式访问。</strong><br><strong>5.请求转发【不能】跨域访问</strong><br>所谓的同域，是指<strong>域名，协议，端口均相同</strong></p>
<h4 id="2-URl-重定向（redirect）"><a href="#2-URl-重定向（redirect）" class="headerlink" title="2.URl 重定向（redirect）"></a>2.URl 重定向（redirect）</h4><p>又叫做<strong>间接转发方式（Redirect）</strong>实际是<strong>两次HTTP请求，</strong>服务器端在响应第一次请求的时候，让浏览器再向另外一个URL发出请求，从而达到转发的目的。</p>
<p>比如:从AServlet重定向到BServlet</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web(4)%E2%80%94%E2%80%94Servlet%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/7896890-c49539085575bc26.png" alt=""></p>
<ul>
<li><strong>语法：</strong></li>
</ul>
<pre class=" language-java"><code class="language-java">response<span class="token punctuation">.</span><span class="token function">sendRedirect</span><span class="token punctuation">(</span>String location<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p><em>参数：</em><code>location</code>，转发到的资源路径</p>
<ul>
<li><strong>特点：</strong></li>
</ul>
<p><strong>1.地址栏中的地址【会】发生改变</strong><br>通常看作是客户端跳转<br><strong>2.有两个请求</strong><br><strong>3.在两个 Servlet 中不可以共享请求中的数据</strong><br><strong>4.最终的响应由 BServlet 来决定，和 AServlet 没有关系</strong><br><strong>5.【不可以】访问 WEB-INF 中的资源</strong><br><strong>6.请求转发【能】跨域访问</strong><br>就像是在网页中点开了新的链接一样</p>
<ul>
<li><strong>总结：</strong>URL 重定向相当于是将重定向的资源路径，重新复制到浏览器地址栏中按下回车一样，<strong>重新发送一次新的请求。</strong></li>
</ul>
<h4 id="3-请求包含（include）"><a href="#3-请求包含（include）" class="headerlink" title="3.请求包含（include）"></a>3.请求包含（include）</h4><hr>
<h3 id="MVC-模式"><a href="#MVC-模式" class="headerlink" title="MVC 模式"></a>MVC 模式</h3><p>MVC 是一种分层的设计模式 。</p>
<ul>
<li><strong>M 代表 模型（Model）</strong><br>模型是什么呢？ 模型就是<strong>数据，</strong>就是dao,bean</li>
<li><strong>V 代表 视图（View）</strong><br>视图是什么呢？ 就是网页, JSP，用来<strong>展示模型中的数据</strong></li>
<li><strong>C 代表 控制器（controller)</strong><br>控制器是什么？ <strong>控制器的作用就是把不同的数据(Model)，显示在不同的视图(View)上。</strong></li>
</ul>
<p>这部分可以参考一下<a href="http://how2j.cn/k/mvc/mvc-tutorials/561.html" target="_blank" rel="noopener">这里</a></p>
<hr>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
        
          <div class='post-wrapper'>
            <article class="post white-box shadow reveal ">
  


  <section class='meta'>
    
      
      
      <div class="meta" id="header-meta">
        
          
  <h2 class="title">
    <a href="/2018/03/21/chu-xue-java-web-3-di-yi-ge-servlet/">
      初学Java Web(3)——第一个Servlet
    </a>
  </h2>


        
        <div class='new-meta-box'>
          
            
          
            
              
<div class='new-meta-item author'>
  <a class='author' href="" rel="nofollow">
    <img no-lazy src="">
    <p></p>
  </a>
</div>

            
          
            
              
  
  <div class='new-meta-item category'>
    <a href='/categories/JavaWeb%E5%9F%BA%E7%A1%80/' rel="nofollow">
      <i class="fas fa-folder-open fa-fw" aria-hidden="true"></i>
      <p>JavaWeb基础</p>
    </a>
  </div>


            
          
            
              <div class="new-meta-item date">
  <a class='notlink'>
    <i class="fas fa-calendar-alt fa-fw" aria-hidden="true"></i>
    <p>发布于：2018年3月21日</p>
  </a>
</div>

            
          
            
              

            
          
            
              
  


            
          
            
              

            
          
            
              

            
          
        </div>
        
          <hr>
        
      </div>
    
  </section>


  <section class="article typo">
    <div class="article-entry" itemprop="articleBody">
      
        <p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94%E7%AC%AC%E4%B8%80%E4%B8%AAServlet/7896890-0189f15458034df3.png" alt=""></p>
<blockquote>
<p>这学期 Java Web 课程的第一节课就简短复习了一下 Java 的一些基础知识，所以觉得 Java 的基础知识还是很重要的，但当我想要去写一篇 Java 回顾的文章的时候发现很难，因为坑实在太多了（一个头，两个大），只能另外找一些时间去写顺便巩固巩固自己的基础。</p>
</blockquote>
<h2 id="——【1-什么是-Servlet-】——"><a href="#——【1-什么是-Servlet-】——" class="headerlink" title="——【1. 什么是 Servlet 】——"></a>——【1. 什么是 Servlet 】——</h2><p>学习一个东西就要先去了解它是什么东西。</p>
<p>Servlet 取自两个单词：Server、Applet （很符合 sun 公司的命名特点）， Java Servlet 的简称，<strong>其实质就是运行在 Web 应用服务器上的 Java 程序，</strong>与普通 Java 程序不同，它是位于 Web 服务器内部的服务器端的 Java 应用程序，可以对 Web 浏览器或其他 HTTP 客户端程序发送的请求进行处理。</p>
<p>狭义的Servlet是指Java语言实现的一个接口，广义的Servlet是指任何实现了这个Servlet接口的类，一般情况下，人们将Servlet理解为后者。Servlet运行于支持Java的应用服务器中。从原理上讲，Servlet可以响应任何类型的请求，但绝大多数情况下Servlet只用来扩展基于HTTP协议的Web服务器。</p>
<blockquote>
<p>实际上，Servlet 就像是一个规范，想象一下我们的 USB 接口，它不仅约束了U盘的大小和形状，同样也约束了电脑的插槽，Servlet 也是如此，它不仅约束了服务器端如何实现规范，也约束着 Java Web 项目的结构，为什么这样说，我们下面再来讲，<strong>编写一个 Servlet 其实就是按照 Servlet 规范编写一个 Java 类。</strong></p>
</blockquote>
<h2 id="——【2-Servlet-与-Servlet-容器-】——"><a href="#——【2-Servlet-与-Servlet-容器-】——" class="headerlink" title="——【2. Servlet 与 Servlet 容器 】——"></a>——【2. Servlet 与 Servlet 容器 】——</h2><p>Servlet 对象与普通的 Java 对象不同，它可以处理 Web 浏览器或其他 HTTP 客户端程序发送的 HTTP 请求，但前提是把 Servlet 对象布置到 Servlet 容器中，也就是说，其运行需要 Servlet 容器的支持。</p>
<p>Servlet 容器也叫做 Servlet 引擎，是 Web 服务器或应用程序服务器的一部分，用于在发送的请求和响应之上提供网络服务，解码基于 MIME 的请求，格式化基于 MIME 的响应。Servlet 没有 main 方法，不能独立运行，它必须被部署到 Servlet 容器中，由容器来实例化和调用 Servlet 的方法（如 doGet() 和 doPost() 方法），Servlet 容器在 Servlet 的生命周期内包容和管理 Servlet 。在 JSP 技术 推出后，管理和运行 Servlet / JSP 的容器也称为 Web 容器。</p>
<p>有了 Servlet 之后，用户通过单击某个链接或者直接在浏览器的地址栏中输入 URL 来访问 Servlet ，Web 服务器接收到该请求后，并不是将请求直接交给 Servlet ，而是交给 Servlet 容器。Servlet 容器实例化 Servlet ，调用 Servlet 的一个特定方法对请求进行处理， 并产生一个响应。这个响应由 Servlet 容器返回给 Web 服务器，Web 服务器包装这个响应，以 HTTP 响应的形式发送给 Web 浏览器。</p>
<h4 id="Servlet-容器能提供什么？"><a href="#Servlet-容器能提供什么？" class="headerlink" title="Servlet 容器能提供什么？"></a>Servlet 容器能提供什么？</h4><p>上面我们知道了需要由 Servlet 容器来管理和运行 Servlet ，但是为什么要这样做呢？使用 Servlet 容器的原因有：</p>
<ol>
<li><strong>通信支持：</strong>利用容器提供的方法，你能轻松的让 Servlet 与 web 服务器对话，而不用自己建立 serversocket 、监听某个端口、创建流等。容器知道自己与 web 服务器之间的协议，所以你的 Servlet 不用担心 web 服务器（如Apache）和你自己的 web 代码之间的 API ，只需要考虑如何在 Servlet 中实现业务逻辑（如处理一个订单）。 </li>
<li><strong>生命周期管理：</strong> Servlet 容器控制着 Servlet 的生与死，它负责加载类、实例化和初始化 Servlet ，调用 Servlet 方法，以及使 Servlet 实例被垃圾回收，有了 Servlet 容器，你不需要太多的考虑资源管理。 </li>
<li><strong>多线程支持：</strong>容器会自动为它所接收的每个 Servlet 请求创建一个新的 java 线程。针对用户的请求，如果 Servlet  已经运行完相应的http服务方法，这个线程就会结束。这并不是说你不需要考虑线程安全性，其实你还会遇到同步问题，不过这样能使你少做很多工作。 </li>
<li><strong>声明方式实现安全：</strong>利用 Servlet 容器，你可以使用 xml 部署描述文件来配置和修改安全性，而不必将其硬编码写到 Servlet 类代码中。 </li>
<li><strong>JSP支持：</strong> Servlet容器负责将 jsp 代码翻译为真正的 java 代码。</li>
</ol>
<h4 id="Servlet-生命周期"><a href="#Servlet-生命周期" class="headerlink" title="Servlet 生命周期"></a>Servlet 生命周期</h4><p>通常情况下，Servlet 容器也就是指 Web 容器，如 Tomcat、Jboss、Resin、Weblogic 等，它们对 Servlet 进行控制。当一个客户端发送 HTTP 请求时，由容器加载 Servlet 对其进行处理并做出响应。在 Web 容器中，Servlet 主要经历 4 个阶段，如下图：</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94%E7%AC%AC%E4%B8%80%E4%B8%AAServlet/7896890-a26b3e8c2114d5f0.png" alt="Servlet 与容器"></p>
<p>Servlet 与 Web 容器的关系是非常密切的，在 Web 容器中 Servlet 主要经历了 4 个阶段，这 4 个阶段实质是 Servlet 的生命周期，由容器进行管理。</p>
<p>（1）在 Web 容器启动或者客户机第一次请求服务时，容器将加载 Servlet 类并将其放入到 Servlet 实例池。</p>
<p>（2）当 Servlet 实例化后，容器将调用 Servlet 对象的 init() 方法完成 Servlet 的初始化操作，主要是为了让 Servlet 在处理请求之前做一些初始化工作。</p>
<p>（3）容器通过 Servlet 的 service() 方法处理客户端请求。在 Service() 方法中，Servlet 实例根据不同的 HTTP 请求类型作出不同处理，并在处理之后作出相应的响应。</p>
<p>（4）在 Web 容器关闭时，容器调用 Servlet 对象的 destroy() 方法对资源进行释放。在调用此方法后，Servlet 对象将被垃圾回收器回收。</p>
<h2 id="——【3-第一个-Servlet-】——"><a href="#——【3-第一个-Servlet-】——" class="headerlink" title="——【3. 第一个 Servlet 】——"></a>——【3. 第一个 Servlet 】——</h2><h4 id="①-搭建-Java-Web-项目"><a href="#①-搭建-Java-Web-项目" class="headerlink" title="① 搭建 Java Web 项目"></a>① 搭建 Java Web 项目</h4><ol>
<li><p>创建 一个 Java 项目，并命名为 HelloServlet； <strong>（注意：这是普通的 Java 项目而不是动态 Web 项目）</strong></p>
</li>
<li><p>在项目的根目录下创建一个文件夹 webapp，表示 Web 项目的根；</p>
</li>
<li><p>在 webapp 中创建 WEB-INF 文件夹；</p>
</li>
<li><p>在 WEB-INF 文件夹中创建文件夹：classes,lib；</p>
</li>
<li><p>在 WEB-INF 文件中添加 Tomcat 根目录下 conf 文件夹中的 web.xml 文件；（只保留根元素，就像下面这样）</p>
<pre><code> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
 &lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee
                       http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
   version=&quot;3.1&quot;&gt;

 &lt;/web-app&gt;
</code></pre></li>
<li><p>把当前项目的 classpath 路径改成 webapp/WEB-INF 下的 classes 中。</p>
</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94%E7%AC%AC%E4%B8%80%E4%B8%AAServlet/7896890-9d55e8be6d22fd9d.png" alt=""></p>
<h4 id="②-编写-Servlet"><a href="#②-编写-Servlet" class="headerlink" title="② 编写 Servlet"></a>② 编写 Servlet</h4><ol>
<li>为该项目增加Servlet的支持.<br>   1.1. 把Tomcat根/lib中servlet-api.jar文件拷贝到项目下WEB-INF下的lib中<br>   1.2. 在项目中选择servlet-api.jar,鼠标右键,build path–&gt;add to build path</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94%E7%AC%AC%E4%B8%80%E4%B8%AAServlet/7896890-ec14aa271cc510e8.png" alt=""></p>
<ol start="2">
<li>开发Servlet程序:<br>  2.1:定义一个类HelloServlet,并让该类去实现javax.servlet.Servlet接口;<br>  2.2:实现Servlet接口中的init,service,destory等方法.</li>
</ol>
<pre><code>import java.io.IOException;

import javax.servlet.Servlet;
import javax.servlet.ServletConfig;
import javax.servlet.ServletException;
import javax.servlet.ServletRequest;
import javax.servlet.ServletResponse;

public class HelloServlet implements Servlet{
    @Override
    public void init(ServletConfig config) throws ServletException {
    }
    @Override
    public ServletConfig getServletConfig() {
        return null;
    }
    @Override
    public void service(ServletRequest req, ServletResponse res) throws ServletException, IOException {
        System.out.println(&quot;测试一下！&quot;);     // 先在这里写下测试代码
    }
    @Override
    public String getServletInfo() {
        return null;
    }
    @Override
    public void destroy() {
    }

}</code></pre><p><strong>注意:若生成方法中的参数是 arg0 或则 arg1 等格式的,原因是还没有关联源代码的问题:</strong> <a href="https://jingyan.baidu.com/article/0202781170ffa61bcc9ce5dd.html" target="_blank" rel="noopener">关联上 tomcat src 文件即可</a></p>
<h4 id="③-配置-Servlet"><a href="#③-配置-Servlet" class="headerlink" title="③ 配置 Servlet"></a>③ 配置 Servlet</h4><p>上面编写好的 HelloServlet 类仅仅是一个普通的实现类而已，而现在我想要它运行在我自己的 Tomcat 服务器中，所以应该通知 Tomcat 服务器来管理我的 HelloServlet 类，具体的做法如下：</p>
<ol>
<li><p>找到项目根下的WEB-INF下的web.xml文件:</p>
</li>
<li><p>在根元素web-app中创建一个新的元素节点:servlet</p>
</li>
<li><p>在根元素web-app中创建一个新的元素节点:servlet-mapping（Servlet 的映射）</p>
<pre><code> &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
 &lt;web-app xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot;
   xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
   xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee
                       http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;
   version=&quot;3.1&quot;&gt;

</code></pre></li>
</ol>
<pre><code>    &lt;servlet&gt;
        &lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;
        &lt;servlet-class&gt;lt.HelloServlet&lt;/servlet-class&gt;
    &lt;/servlet&gt;

    &lt;servlet-mapping&gt;
        &lt;servlet-name&gt;HelloServlet&lt;/servlet-name&gt;
        &lt;url-pattern&gt;/hello&lt;/url-pattern&gt;
    &lt;/servlet-mapping&gt;

&lt;/web-app&gt;
```
&gt; web.xml 提供路径和servlet映射关系，这意思是把/hello这个路径，映射到 HelloServlet 这个类上，需要注意的是：**&lt; servlet&gt; 标签下的 &lt; servlet-name&gt;与 &lt; servlet-mapping&gt; 标签下的 &lt; servlet-name&gt; 必须一样**（因为标签被编辑器识别故&lt;后加了一个空格）</code></pre><ol start="4">
<li><p>配置 Tomcat 服务器：</p>
<p> 4.1. 修改默认端口为 80 端口：</p>
<pre><code> 首先进入到 Tomcat 服务器的根路径下找到 conf 文件夹下的 server.xml 文件，默认是在第 70 行，找到 Connector 元素的 port 属性，修改为 80 ，重启 Tomcat 即可。
 ![](https://cdn.jsdelivr.net/gh/wmyskxz/img/img/初学Java-Web（3）——第一个Servlet/7896890-7812541ce51b78e5.png)</code></pre><blockquote>
<p>Tomcat 的默认端口为8080，而 HTTP 协议的默认端口是 80，配置 80 端口的好处在于，我们平时输入的类似于 <a href="http://baidu.com" target="_blank" rel="noopener">http://baidu.com</a> 其实是默认省略了写 80端口的，它其实等价于：<a href="http://baidu.com:80/" target="_blank" rel="noopener">http://baidu.com:80/</a> ，所以以后我们就不用再写冒号直接输入 locahost 就能进入到 Tomcat 的配置页面了。</p>
</blockquote>
<p>  4.2 部署 Java 项目（告诉 Tomcat 服务器来管理我们的项目）：</p>
<pre><code> 这里直接引用 how2j.cn 的教程啦：
 ![](https://cdn.jsdelivr.net/gh/wmyskxz/img/img/初学Java-Web（3）——第一个Servlet/7896890-9b8a876c38379a5a.png)</code></pre></li>
</ol>
<p>所以加上<code>&lt;Context path=&quot;&quot; docBase=&quot;F:\\Projects\\JavaProject\\HelloServlet\\webapp&quot; /&gt;</code>这一句重启 Tomcat 服务器</p>
<p>在浏览器中输入 localhost/hello，回车，即可在 Tomcat 服务器上看到相关信息，至此第一个 Servlet 就编写成功了</p>
<p><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94%E7%AC%AC%E4%B8%80%E4%B8%AAServlet/7896890-d0df0d5429c132d3.png" alt=""></p>
<h2 id="——【4-Servlet-请求过程】——"><a href="#——【4-Servlet-请求过程】——" class="headerlink" title="——【4. Servlet 请求过程】——"></a>——【4. Servlet 请求过程】——</h2><p>学习 Servlet 技术，就需要有一个 Servlet 运行环境，也就是需要有一个 Servlet 容器，如这里使用的<strong>【Tomcat】</strong>。</p>
<p>Tomcat 服务器接受客户请求并做出响应的过程如下（以上面搭建的项目为例）：</p>
<p>① 打开浏览器发起请求：<a href="http://localhost:80/hello/index.html" target="_blank" rel="noopener">http://localhost:80/hello/index.html</a> （假设有一个 index.html 文件）</p>
<p>② 服务器接收到请求后处理请求：</p>
<blockquote>
<p>htpp：所使用的协议<br>localhost：ip地址，确定访问的主机<br>80：端口号<br>hello：上下文路径，确定访问项目的根路径<br>index.html：确定访问项目中的具体哪一个资源</p>
</blockquote>
<p>③ 根据 hello 去 tomcat/conf/server.xml 文件中找到相关配置文件，根据上下文路径找到项目的根路径：<br><code>&lt;Context path=&quot;&quot; docBase=&quot;F:\\Projects\\JavaProject\\HelloServlet\\webapp&quot; /&gt;</code><br>如果找不到根路径（因为这里默认上下文路径为空），返回 404</p>
<p>④ 根据资源名称去项目中的 web.xml 文件中找到相关的配置，找到配置中的<code>&lt;url-pattern&gt;</code><br><img src="https://cdn.jsdelivr.net/gh/wmyskxz/img/img/%E5%88%9D%E5%AD%A6Java-Web%EF%BC%883%EF%BC%89%E2%80%94%E2%80%94%E7%AC%AC%E4%B8%80%E4%B8%AAServlet/7896890-bc647a56c9f6423f.png" alt=""></p>
<p>如果找不到 hello 的资源名称，则返回 404</p>
<p>⑤ 根据资源名称找到 Servlet 的全限定名，如果找不到则在启动服务器的时候报错<br><code>java.lang.IllegalArgumentException: Servlet mapping specifies an unknown servlet name HelloServlet</code></p>
<p>⑥ 根据找到的全限定名创建对象，在创建对象之前需要判断是否是第一次请求，使用 Tomcat 中使用 Servlet 实例缓存池来实现，若是第一次则调用对象的 init 方法。</p>
<p>⑦ 创建 req,resp 对象，执行 service 方法；</p>
<p>⑧ 使用 resp 对象给浏览器响应信息。</p>
<blockquote>
<p>发现一边学一边写起来太麻烦了，一方面是因为自己的水平，另一方面是觉得这样太费时间了，也要开始找实习了，所以时间有些宝贵，可能这不会作为一个连续的系列，反而是一些学习的分享和感悟，emmm….事实上，Servlet也还有好多东西，包括最新支持注解方式配置等….<br>参考资料：<br>《Java Web程序设计 慕课版——明日科技》<br>how2j.cn<br><a href="http://blog.csdn.net/lz233333/article/details/68065749" target="_blank" rel="noopener">理解Servlet和Servlet容器、Web服务器等概念</a></p>
</blockquote>
<hr>
<blockquote>
<p>欢迎转载，转载请注明出处！<br>简书ID：<a href="https://www.jianshu.com/u/a40d61a49221" target="_blank" rel="noopener">@我没有三颗心脏</a><br>github：<a href="https://github.com/wmyskxz/" target="_blank" rel="noopener">wmyskxz</a><br>欢迎关注公众微信号：wmyskxz<br>分享自己的学习 &amp; 学习资料 &amp; 生活<br>想要交流的朋友也可以加qq群：3382693</p>
</blockquote>

      
    </div>
    
      
    
  </section>
</article>

          </div>
        
      
    
  </section>
  
    
      <br>
      <div class="prev-next">
        
          <a class="prev" rel="prev" href="/tags/%E5%8E%9F%E5%88%9B/page/16/">
            <section class="post prev white-box shadow" >
              <i class="fas fa-chevron-left" aria-hidden="true"></i>&nbsp;上一页&nbsp;
            </section>
          </a>
        
        <p class="current">
          17 / 20
        </p>
        
          <a class="next" rel="next" href="/tags/%E5%8E%9F%E5%88%9B/page/18/">
            <section class="post next white-box shadow">
              &nbsp;下一页&nbsp;<i class="fas fa-chevron-right" aria-hidden="true"></i>
            </section>
          </a>
        
      </div>
    
    <!-- 根据主题中的设置决定是否在archive中针对摘要部分的MathJax公式加载mathjax.js文件 -->
    
    

  


    
  
</div>
<aside class='l_side'>
  
  
    
    

<section class="widget blogger shadow desktop mobile">
  <div class='content'>
    
      
        <a class='avatar flat-box rectangle' href='/about/'>
          <img no-lazy src='https://cdn.jsdelivr.net/gh/wmyskxz/img/img/common/avatar.png'/>
        </a>
      
    
    
      <div class='text'>
        
        
          <p>想做一个自由且自律的人，靠势必实现的决心认真地或者</p>

        
        
      </div>
    
    
      <div class="social-wrapper">
        
          
            <a href="/atom.xml"
              class="social fas fa-rss flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="mailto:me@xxx.com"
              class="social fas fa-envelope flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://github.com/volantis-x/"
              class="social fab fa-github flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
          
            <a href="https://music.163.com/#/user/home?id=260045301"
              class="social fas fa-headphones-alt flat-btn"
              target="_blank"
              rel="external nofollow noopener noreferrer">
            </a>
          
        
      </div>
    
  </div>
</section>

  

  
    
    
  

  <section class="widget category shadow desktop">
    
  <header>
    
      <a href='/blog/categories/'><i class="fas fa-folder-open fa-fw" aria-hidden="true"></i><span class='name'>文章分类</span></a>
    
  </header>


    <div class='content'>
      <ul class="entry navigation">
        
          <li><a class="flat-box"
            title="/categories/Java-Web/" href="/categories/Java-Web/"
            id="categoriesJava-Web"
            ><div class='name'>Java Web</div><div class='badge'>(6)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Java-Web/Spring/" href="/categories/Java-Web/Spring/"
            id="categoriesJava-WebSpring"
            ><div class='name'>Spring</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Java-Web/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" href="/categories/Java-Web/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
            id="categoriesJava-WebE5ADA6E4B9A0E7AC94E8AEB0"
            ><div class='name'>学习笔记</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/"
            id="categoriesJavaWebE59FBAE7A180"
            ><div class='name'>JavaWeb基础</div><div class='badge'>(23)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SSM/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SSM/"
            id="categoriesJavaWebE59FBAE7A180SSM"
            ><div class='name'>SSM</div><div class='badge'>(5)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SSM/%E9%A1%B9%E7%9B%AE/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SSM/%E9%A1%B9%E7%9B%AE/"
            id="categoriesJavaWebE59FBAE7A180SSME9A1B9E79BAE"
            ><div class='name'>项目</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/Spring-MVC/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/Spring-MVC/"
            id="categoriesJavaWebE59FBAE7A180Spring-MVC"
            ><div class='name'>Spring MVC</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/Spring/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/Spring/"
            id="categoriesJavaWebE59FBAE7A180Spring"
            ><div class='name'>Spring</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SpringBoot/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/SpringBoot/"
            id="categoriesJavaWebE59FBAE7A180SpringBoot"
            ><div class='name'>SpringBoot</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E5%9F%BA%E7%A1%80/%E9%A1%B9%E7%9B%AE/" href="/categories/JavaWeb%E5%9F%BA%E7%A1%80/%E9%A1%B9%E7%9B%AE/"
            id="categoriesJavaWebE59FBAE7A180E9A1B9E79BAE"
            ><div class='name'>项目</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/"
            id="categoriesJavaWebE8BF9BE998B6"
            ><div class='name'>JavaWeb进阶</div><div class='badge'>(14)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/Spring-Boot/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/Spring-Boot/"
            id="categoriesJavaWebE8BF9BE998B6Spring-Boot"
            ><div class='name'>Spring Boot</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/Spring-Boot/%E9%A1%B9%E7%9B%AE/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/Spring-Boot/%E9%A1%B9%E7%9B%AE/"
            id="categoriesJavaWebE8BF9BE998B6Spring-BootE9A1B9E79BAE"
            ><div class='name'>项目</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E4%B8%AD%E9%97%B4%E4%BB%B6/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E4%B8%AD%E9%97%B4%E4%BB%B6/"
            id="categoriesJavaWebE8BF9BE998B6E4B8ADE997B4E4BBB6"
            ><div class='name'>中间件</div><div class='badge'>(5)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%89%8D%E7%AB%AF/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%89%8D%E7%AB%AF/"
            id="categoriesJavaWebE8BF9BE998B6E5898DE7ABAF"
            ><div class='name'>前端</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%89%8D%E7%AB%AF/Spring-Boot/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%89%8D%E7%AB%AF/Spring-Boot/"
            id="categoriesJavaWebE8BF9BE998B6E5898DE7ABAFSpring-Boot"
            ><div class='name'>Spring Boot</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"
            id="categoriesJavaWebE8BF9BE998B6E5BEAEE69C8DE58AA1"
            ><div class='name'>微服务</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/"
            id="categoriesJavaWebE8BF9BE998B6E69EB6E69E84E4B98BE8B7AF"
            ><div class='name'>架构之路</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E9%A1%B9%E7%9B%AE/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E9%A1%B9%E7%9B%AE/"
            id="categoriesJavaWebE8BF9BE998B6E9A1B9E79BAE"
            ><div class='name'>项目</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E9%A1%B9%E7%9B%AE/Spring-Boot/" href="/categories/JavaWeb%E8%BF%9B%E9%98%B6/%E9%A1%B9%E7%9B%AE/Spring-Boot/"
            id="categoriesJavaWebE8BF9BE998B6E9A1B9E79BAESpring-Boot"
            ><div class='name'>Spring Boot</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Java%E5%9F%BA%E7%A1%80/" href="/categories/Java%E5%9F%BA%E7%A1%80/"
            id="categoriesJavaE59FBAE7A180"
            ><div class='name'>Java基础</div><div class='badge'>(15)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" href="/categories/Java%E5%9F%BA%E7%A1%80/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"
            id="categoriesJavaE59FBAE7A180E5B9B6E58F91E7BC96E7A88B"
            ><div class='name'>并发编程</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Java%E5%9F%BA%E7%A1%80/%E9%9D%A2%E8%AF%95/" href="/categories/Java%E5%9F%BA%E7%A1%80/%E9%9D%A2%E8%AF%95/"
            id="categoriesJavaE59FBAE7A180E99DA2E8AF95"
            ><div class='name'>面试</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/MoreThanJava/" href="/categories/MoreThanJava/"
            id="categoriesMoreThanJava"
            ><div class='name'>MoreThanJava</div><div class='badge'>(15)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/MoreThanJava/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" href="/categories/MoreThanJava/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"
            id="categoriesMoreThanJavaE5A49AE7BABFE7A88B"
            ><div class='name'>多线程</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/MoreThanJava/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98/" href="/categories/MoreThanJava/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98/"
            id="categoriesMoreThanJavaE79FA5E4B98EE997AEE9A298"
            ><div class='name'>知乎问题</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Python/" href="/categories/Python/"
            id="categoriesPython"
            ><div class='name'>Python</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Python/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/" href="/categories/Python/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/"
            id="categoriesPythonE68782E4B880E782B9E7B3BBE58897"
            ><div class='name'>懂一点系列</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Redis/" href="/categories/Redis/"
            id="categoriesRedis"
            ><div class='name'>Redis</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/Redis/%E4%B8%AD%E9%97%B4%E4%BB%B6/" href="/categories/Redis/%E4%B8%AD%E9%97%B4%E4%BB%B6/"
            id="categoriesRedisE4B8ADE997B4E4BBB6"
            ><div class='name'>中间件</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Ruby/" href="/categories/Ruby/"
            id="categoriesRuby"
            ><div class='name'>Ruby</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/Spring-Cloud/" href="/categories/Spring-Cloud/"
            id="categoriesSpring-Cloud"
            ><div class='name'>Spring Cloud</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/"
            id="categoriesE4B8ADE997B4E4BBB6"
            ><div class='name'>中间件</div><div class='badge'>(7)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/JavaWeb%E8%BF%9B%E9%98%B6/" href="/categories/%E4%B8%AD%E9%97%B4%E4%BB%B6/JavaWeb%E8%BF%9B%E9%98%B6/"
            id="categoriesE4B8ADE997B4E4BBB6JavaWebE8BF9BE998B6"
            ><div class='name'>JavaWeb进阶</div><div class='badge'>(7)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%85%AC%E4%BC%97%E5%8F%B7%EF%BC%9Awmyskxz/" href="/categories/%E5%85%AC%E4%BC%97%E5%8F%B7%EF%BC%9Awmyskxz/"
            id="categoriesE585ACE4BC97E58FB7EFBC9Awmyskxz"
            ><div class='name'>公众号：wmyskxz</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%89%8D%E7%AB%AF/" href="/categories/%E5%89%8D%E7%AB%AF/"
            id="categoriesE5898DE7ABAF"
            ><div class='name'>前端</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E5%89%8D%E7%AB%AF/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/" href="/categories/%E5%89%8D%E7%AB%AF/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/"
            id="categoriesE5898DE7ABAFE68782E4B880E782B9E7B3BBE58897"
            ><div class='name'>懂一点系列</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%96%9C%E6%AC%A2%E7%9A%84%E4%B8%89%E8%A7%82/" href="/categories/%E5%96%9C%E6%AC%A2%E7%9A%84%E4%B8%89%E8%A7%82/"
            id="categoriesE5969CE6ACA2E79A84E4B889E8A782"
            ><div class='name'>喜欢的三观</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"
            id="categoriesE5A49AE7BABFE7A88B"
            ><div class='name'>多线程</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%A5%BD%E5%A5%87%E6%98%9F%E4%BA%BA/" href="/categories/%E5%A5%BD%E5%A5%87%E6%98%9F%E4%BA%BA/"
            id="categoriesE5A5BDE5A587E6989FE4BABA"
            ><div class='name'>好奇星人</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"
            id="categoriesE5ADA6E4B9A0E7AC94E8AEB0"
            ><div class='name'>学习笔记</div><div class='badge'>(6)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Java%E8%BF%9B%E9%98%B6/" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/Java%E8%BF%9B%E9%98%B6/"
            id="categoriesE5ADA6E4B9A0E7AC94E8AEB0JavaE8BF9BE998B6"
            ><div class='name'>Java进阶</div><div class='badge'>(3)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/"
            id="categoriesE695B0E68DAEE7BB93E69E84E4B88EE7AE97E6B395"
            ><div class='name'>数据结构与算法</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E9%9D%A2%E8%AF%95/" href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/%E9%9D%A2%E8%AF%95/"
            id="categoriesE695B0E68DAEE7BB93E69E84E4B88EE7AE97E6B395E99DA2E8AF95"
            ><div class='name'>面试</div><div class='badge'>(4)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E6%9C%89%E8%B6%A3%E9%9B%86%E4%B8%AD%E8%90%A5/" href="/categories/%E6%9C%89%E8%B6%A3%E9%9B%86%E4%B8%AD%E8%90%A5/"
            id="categoriesE69C89E8B6A3E99B86E4B8ADE890A5"
            ><div class='name'>有趣集中营</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/" href="/categories/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/"
            id="categoriesE69EB6E69E84E4B98BE8B7AF"
            ><div class='name'>架构之路</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/" href="/categories/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/"
            id="categoriesE78988E69CACE789B9E680A7"
            ><div class='name'>版本特性</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E7%94%9F%E6%B4%BB/" href="/categories/%E7%94%9F%E6%B4%BB/"
            id="categoriesE7949FE6B4BB"
            ><div class='name'>生活</div><div class='badge'>(2)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E7%9F%A5%E4%B9%8E%E9%97%AE%E7%AD%94/" href="/categories/%E7%9F%A5%E4%B9%8E%E9%97%AE%E7%AD%94/"
            id="categoriesE79FA5E4B98EE997AEE7AD94"
            ><div class='name'>知乎问答</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/" href="/categories/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/"
            id="categoriesE7BC96E7A88BE4BABAE7949F"
            ><div class='name'>编程人生</div><div class='badge'>(5)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/%E9%9D%A2%E8%AF%95/" href="/categories/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/%E9%9D%A2%E8%AF%95/"
            id="categoriesE7BC96E7A88BE4BABAE7949FE99DA2E8AF95"
            ><div class='name'>面试</div><div class='badge'>(1)</div></a></li>
        
          <li><a class="flat-box"
            title="/categories/%E9%9D%A2%E8%AF%95/" href="/categories/%E9%9D%A2%E8%AF%95/"
            id="categoriesE99DA2E8AF95"
            ><div class='name'>面试</div><div class='badge'>(8)</div></a></li>
        
          <li><a class="flat-box child"
            title="/categories/%E9%9D%A2%E8%AF%95/%E4%B8%AD%E9%97%B4%E4%BB%B6/" href="/categories/%E9%9D%A2%E8%AF%95/%E4%B8%AD%E9%97%B4%E4%BB%B6/"
            id="categoriesE99DA2E8AF95E4B8ADE997B4E4BBB6"
            ><div class='name'>中间件</div><div class='badge'>(1)</div></a></li>
        
      </ul>
    </div>
  </section>


  

  
    
    
  

  <section class="widget tagcloud shadow desktop mobile">
    
  <header>
    
      <a href='/blog/tags/'><i class="fas fa-tags fa-fw" aria-hidden="true"></i><span class='name'>热门标签</span></a>
    
  </header>


    <div class='content'>
      <a href="/tags/Docker/" style="font-size: 14px; color: #999">Docker</a> <a href="/tags/Elasticsearch/" style="font-size: 14px; color: #999">Elasticsearch</a> <a href="/tags/Java-Web/" style="font-size: 16.86px; color: #868686">Java Web</a> <a href="/tags/Java8/" style="font-size: 14px; color: #999">Java8</a> <a href="/tags/JavaWeb%E5%9F%BA%E7%A1%80/" style="font-size: 23.29px; color: #5a5a5a">JavaWeb基础</a> <a href="/tags/JavaWeb%E8%BF%9B%E9%98%B6/" style="font-size: 22.57px; color: #5f5f5f">JavaWeb进阶</a> <a href="/tags/Java%E5%9F%BA%E7%A1%80/" style="font-size: 21.86px; color: #646464">Java基础</a> <a href="/tags/Kafka/" style="font-size: 14px; color: #999">Kafka</a> <a href="/tags/MongoDB/" style="font-size: 14px; color: #999">MongoDB</a> <a href="/tags/MoreThanJava/" style="font-size: 20.43px; color: #6d6d6d">MoreThanJava</a> <a href="/tags/MyBatis/" style="font-size: 15.43px; color: #8f8f8f">MyBatis</a> <a href="/tags/Python/" style="font-size: 14px; color: #999">Python</a> <a href="/tags/React/" style="font-size: 14px; color: #999">React</a> <a href="/tags/Redis/" style="font-size: 19.71px; color: #727272">Redis</a> <a href="/tags/Ruby/" style="font-size: 14.71px; color: #949494">Ruby</a> <a href="/tags/SSM/" style="font-size: 16.86px; color: #868686">SSM</a> <a href="/tags/Shiro/" style="font-size: 14px; color: #999">Shiro</a> <a href="/tags/Spring/" style="font-size: 17.57px; color: #818181">Spring</a> <a href="/tags/Spring-Boot/" style="font-size: 17.57px; color: #818181">Spring Boot</a> <a href="/tags/Spring-Cloud/" style="font-size: 14px; color: #999">Spring Cloud</a> <a href="/tags/Spring-MVC/" style="font-size: 14px; color: #999">Spring MVC</a> <a href="/tags/Vue/" style="font-size: 14px; color: #999">Vue</a> <a href="/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/" style="font-size: 21.14px; color: #686868">中间件</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/" style="font-size: 14.71px; color: #949494">代码规范</a> <a href="/tags/%E5%89%8D%E7%AB%AF/" style="font-size: 15.43px; color: #8f8f8f">前端</a> <a href="/tags/%E5%8E%9F%E5%88%9B/" style="font-size: 24px; color: #555">原创</a> <a href="/tags/%E5%96%9C%E6%AC%A2%E7%9A%84%E4%B8%89%E8%A7%82/" style="font-size: 16.14px; color: #8a8a8a">喜欢的三观</a> <a href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/" style="font-size: 14.71px; color: #949494">多线程</a> <a href="/tags/%E5%A5%BD%E5%A5%87%E6%98%9F%E4%BA%BA/" style="font-size: 15.43px; color: #8f8f8f">好奇星人</a> <a href="/tags/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" style="font-size: 17.57px; color: #818181">学习笔记</a> <a href="/tags/%E5%AF%BC%E8%88%AA/" style="font-size: 14px; color: #999">导航</a> <a href="/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/" style="font-size: 14.71px; color: #949494">并发编程</a> <a href="/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/" style="font-size: 14px; color: #999">微服务</a> <a href="/tags/%E6%80%BB%E7%BB%93/" style="font-size: 18.29px; color: #7c7c7c">总结</a> <a href="/tags/%E6%87%82%E4%B8%80%E7%82%B9%E7%B3%BB%E5%88%97/" style="font-size: 14.71px; color: #949494">懂一点系列</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 16.14px; color: #8a8a8a">数据结构与算法</a> <a href="/tags/%E6%9C%89%E8%B6%A3%E9%9B%86%E4%B8%AD%E8%90%A5/" style="font-size: 14px; color: #999">有趣集中营</a> <a href="/tags/%E6%9E%B6%E6%9E%84%E4%B9%8B%E8%B7%AF/" style="font-size: 14px; color: #999">架构之路</a> <a href="/tags/%E7%89%88%E6%9C%AC%E7%89%B9%E6%80%A7/" style="font-size: 14px; color: #999">版本特性</a> <a href="/tags/%E7%9F%A5%E4%B9%8E%E9%97%AE%E7%AD%94/" style="font-size: 14px; color: #999">知乎问答</a> <a href="/tags/%E7%9F%A5%E4%B9%8E%E9%97%AE%E9%A2%98/" style="font-size: 14px; color: #999">知乎问题</a> <a href="/tags/%E7%BC%96%E7%A8%8B%E4%BA%BA%E7%94%9F/" style="font-size: 16.86px; color: #868686">编程人生</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 14px; color: #999">翻译</a> <a href="/tags/%E7%BF%BB%E8%AF%91%E6%96%87/" style="font-size: 14px; color: #999">翻译文</a> <a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 21.14px; color: #686868">面试</a> <a href="/tags/%E9%A1%B9%E7%9B%AE/" style="font-size: 19px; color: #777">项目</a> <a href="/tags/%E9%A2%86%E5%9F%9F%E9%A9%B1%E5%8A%A8%E8%AE%BE%E8%AE%A1/" style="font-size: 14px; color: #999">领域驱动设计</a>
    </div>
  </section>


  

  


</aside>


    </div>
    
  
  <footer class="clearfix">
    <br><br>
    
      
        <br>
        <div class="social-wrapper">
          
            
              <a href="/atom.xml"
                class="social fas fa-rss flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="mailto:me@xxx.com"
                class="social fas fa-envelope flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://github.com/volantis-x/"
                class="social fab fa-github flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
            
              <a href="https://music.163.com/#/user/home?id=260045301"
                class="social fas fa-headphones-alt flat-btn"
                target="_blank"
                rel="external nofollow noopener noreferrer">
              </a>
            
          
        </div>
      
    
      
        <div><p>博客内容遵循 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener">署名-非商业性使用-相同方式共享 4.0 国际 (CC BY-NC-SA 4.0) 协议</a></p>
</div>
      
    
      
        本站使用
        <a href="https://github.com/volantis-x/hexo-theme-volantis/" target="_blank" class="codename">Volantis</a>
        作为主题，总访问量为
          <span id="busuanzi_value_site_pv"><i class="fas fa-circle-notch fa-spin fa-fw" aria-hidden="true"></i></span>
          次
        
      
    
      
        <div class='copyright'>
        <p><a href="/">Copyright © 2017-2020 XXX</a></p>

        </div>
      
    
  </footer>


    <a class="s-top fas fa-arrow-up fa-fw" href='javascript:void(0)'></a>
  </div>
  <div>
    
      
  

  <div id="rightmenu-wrapper">
    <ul class="list-v rightmenu" id="rightmenu-content">
      <li class='option'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-text' onclick='document.execCommand("copy")'><i class='fa fa-copy fa-fw'></i>复制文本</a>
        <hr id='hr-text'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-href'><i class='fa fa-link fa-fw'></i>复制链接</a>
        <a class='vlts-menu opt fix-cursor-default' id='menu-open-href'><i class='fa fa-external-link-square-alt fa-fw'></i>在新标签页打开</a>
        <hr id='hr-href'>
        <a class='vlts-menu opt fix-cursor-default' id='menu-copy-src'><i class='fa fa-image fa-fw'></i>复制图片地址</a>
        <hr id='hr-src'>
      </li>
      <li class='navigation'>
        <a class='nav icon-only fix-cursor-default' onclick='history.back()'><i class='fa fa-arrow-left fa-fw'></i></a>
        <a class='nav icon-only fix-cursor-default' onclick='history.forward()'><i class='fa fa-arrow-right fa-fw'></i></a>
        <a class='nav icon-only fix-cursor-default' onclick='window.location.reload()'><i class='fa fa-redo fa-fw'></i></a>
        <a class='nav icon-only fix-cursor-default' href='/'><i class='fa fa-home fa-fw'></i></a>
      </li>
      <hr>
      
        
      
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://github.com/volantis-x/volantis-docs/
        
        
        
        
          id="https:githubcomvolantis-xvolantis-docs"
        >
        <i class='fa fa-code-branch fa-fw'></i> 本站源码
      </a>
    </li>
  
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' href=https://github.com/volantis-x/hexo-theme-volantis/
        
        
        
        
          id="https:githubcomvolantis-xhexo-theme-volantis"
        >
        <i class='fa fa-code-branch fa-fw'></i> 主题源码
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          
    <li>
      <a class='vlts-menu fix-cursor-default' 
        
        
        
          onclick="document.execCommand('print')"
        
        >
        <i class='fa fa-print fa-fw'></i> 打印页面
      </a>
    </li>
  
        
      
        
          <hr>
        
      
        
          <li class='music name'>
            <p class='nav music-title fix-cursor-default'></p>
          </li>
          <li class='music ctrl'>
            <a class='nav icon-only backward fix-cursor-default' onclick='aplayerBackward()'><i class='fa fa-step-backward fa-fw'></i></a>
            <a class='nav icon-only toggle fix-cursor-default' onclick='aplayerToggle()'><i class='fa fa-play fa-fw'></i></a>
            <a class='nav icon-only forward fix-cursor-default' onclick='aplayerForward()'><i class='fa fa-step-forward fa-fw'></i></a>
          </li>
          <li class='music volume'>
            <a class='nav volume'>
              <div class="aplayer-volume-bar-wrap">
                <div class="aplayer-volume-bar fix-cursor-pointer">
                  <div class="aplayer-volume"></div>
                  <i class='left fa fa-volume-off fa-fw'></i>
                  <i class='right fa fa-volume-up fa-fw'></i>
                </div>
              </div>
            </a>
          </li>
        
      
    </ul>
  </div>

  <script>
    window.document.oncontextmenu = function (event) {
      if (event.ctrlKey) return true;
      if (/Android|webOS|BlackBerry/i.test(navigator.userAgent)) return true;
      return popMenu(event);
    };
    document.addEventListener("click", function (event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      mymenu.style.display = "none";
    });
    function popMenu(event) {
      var mymenu = document.getElementById('rightmenu-wrapper');
      var menuContent = document.getElementById('rightmenu-content');
      var screenWidth = document.documentElement.clientWidth || document.body.clientWidth;
      var screenHeight = document.documentElement.clientHeight || document.body.clientHeight;
      mymenu.style.left = event.clientX + "px"; // 获取鼠标位置
      mymenu.style.top = event.clientY + "px";
      mymenu.style.display = 'block';
      if (event.clientX * 2 > screenWidth) {
        menuContent.classList.add('left');
      } else {
        menuContent.classList.remove('left');
      }
      if (event.clientY * 2 > screenHeight) {
        menuContent.classList.add('top');
      } else {
        menuContent.classList.remove('top');
      }

      let hrText = document.getElementById('hr-text');
      let hrSrc = document.getElementById('hr-src');
      let hrHref = document.getElementById('hr-href');

      // 选中图片
      let copySrc = document.getElementById('menu-copy-src');
      if (copySrc != undefined) {
        if (event.target.currentSrc) {
          copySrc.style.display = 'block';
          copySrc.addEventListener("click", function (e) {
            copyString(event.target.currentSrc);
          },{once: true});
          hrSrc.style.display = 'block';
        } else {
          copySrc.style.display = 'none';
          hrSrc.style.display = 'none';
        }
      }

      // 选中按钮
      // 判断是不是按钮
      let href = '';
      if (event.path) {
        for (i = 0; i < event.path.length; i++) {
          if (event.path[i].href != undefined && event.path[i].href.length > 0) {
            href = event.path[i].href;
          }
        }
      }

      let copyText = document.getElementById('menu-copy-text');
      copyText.style.display = 'none';
      hrText.style.display = 'none';
      if (href.length == 0) {
        // 选中文本
        if (window.getSelection().toString()) {
          copyText.style.display = 'block';
          hrText.style.display = 'block';
        }
      }

      // 在新标签页打开
      let openHref = document.getElementById('menu-open-href');
      if (openHref != undefined) {
        if (href.length > 0) {
          openHref.style.display = 'block';
          openHref.addEventListener("click", function (e) {
            window.open(href);
          },{once: true});
          hrHref.style.display = 'block';
        } else {
          openHref.style.display = 'none';
          hrHref.style.display = 'none';
        }
      }
      // 复制链接
      let copyHref = document.getElementById('menu-copy-href');
      if (copyHref != undefined) {
        if (href.length > 0) {
          copyHref.style.display = 'block';
          copyHref.addEventListener("click", function (e) {
            copyString(href);
          },{once: true});
        } else {
          copyHref.style.display = 'none';
        }
      }

      // 有音乐播放器
      if (true == true) {
        // 如果有aplayer，初始化一下
      	try {
      		checkAPlayer();
          updateTitle();
      	} catch (error) {
      		console.log(error);
      	}
      }

      return false; // 该行代码确保系统自带的右键菜单不会被调出
    }
    function hideMenu() {
      document.getElementById('rightmenu-wrapper').style.display = 'none';
    }
    function copyString(str) {
      const input = document.createElement('input');
      input.setAttribute('readonly', 'readonly');
      document.body.appendChild(input);
      input.setAttribute('value', str);
      input.select();
      document.execCommand('copy');
      document.body.removeChild(input);
    }
    document.execCommand('click');
  </script>


    
    
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5/dist/jquery.min.js"></script>



  <script>
    
    var SEARCH_SERVICE = "hexo" || "hexo";
    var ROOT = "/" || "/";
    if (!ROOT.endsWith('/')) ROOT += '/';
  </script>



  <script async src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-volantis@2/js/instant_page.js" type="module" defer integrity="sha384-OeDn4XE77tdHo8pGtE1apMPmAipjoxUQ++eeJa6EtJCfHlvijigWiJpD7VDPWXV1"></script>



  
  
  
    
<script src="https://cdn.jsdelivr.net/npm/jquery-backstretch@2.1.18/jquery.backstretch.min.js"></script>

    <script type="text/javascript">
      $(function(){
        var imgs=["https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/001.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/002.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/003.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/004.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/005.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/006.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/012.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/016.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/019.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/025.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/033.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/034.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/035.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/038.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/039.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/042.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/046.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/051.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/052.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/054.jpg", "https://cdn.jsdelivr.net/gh/volantis-x/cdn-wallpaper-minimalist/2020/056.jpg"];
        if ('true' == 'true') {
          function shuffle(arr){
            /*From countercurrent-time*/
            var n = arr.length;
            while(n--) {
              var index = Math.floor(Math.random() * n);
              var temp = arr[index];
              arr[index] = arr[n];
              arr[n] = temp;
            }
          }
          shuffle(imgs);
        }
        if ('.cover') {
          $('.cover').backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        } else {
          $.backstretch(
            imgs,
          {
            duration: "20000",
            fade: "1500"
          });
        }
      });
    </script>
  



  <script>
    let APlayerController = new Object();
    APlayerController.id = '3175833810';  // 设定全局音乐播放ID
    APlayerController.volume = '0.7';
  </script>
  
    
<script src="https://cdn.jsdelivr.net/npm/aplayer@1.10/dist/APlayer.min.js"></script>

  
    
<script src="https://cdn.jsdelivr.net/npm/meting@2.0/dist/Meting.min.js"></script>

  
    
<script src="/js/aplayer.js"></script>

  




  <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script>
<script type="text/javascript">
  function pjax_gitalk() {
    let pageUrl = $.trim($('#pjax-comment-path').text()) === "none" ? 
      decodeURI(window.location.pathname) : $.trim($('#pjax-comment-path').text());
    
    let ALLPATH = '';
    if(ALLPATH != '') pageUrl = ALLPATH;

    if (document.getElementById('gitalk-container') != null) {
      var gitalk = new Gitalk({
        clientID: "a9f57bed080703426741",
        clientSecret: "03fe7aec06a7794dedfcc123b6475f0231f6a0ce",
        repo: "wmyskxz.github.io",
        owner: "wmyskxz",
        admin: "wmyskxz",
        id: pageUrl,
        distractionFreeMode: false  // Facebook-like distraction free mode
      });
      gitalk.render('gitalk-container');
    }
  }

  $(function () {
    pjax_gitalk();
  });
</script>




<!-- darkmodejs -->


<!-- 复制 -->

  <script src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js"></script>
<script>
    var clipboard = new ClipboardJS('.btn-copy', {
        target: function (trigger) {
            return trigger.nextElementSibling
        }
    });
    function wait(callback, seconds) {
        var timelag = null;
        timelag = window.setTimeout(callback, seconds)
    }
    function pjax_initCopyCode() {
        var copyHtml = '';
        copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
        copyHtml += '<i class="fas fa-copy"></i><span>COPY</span>';
        copyHtml += '</button>';
        $(".highlight .code pre").before(copyHtml);
        $(".article pre code").before(copyHtml);
        clipboard.off('success').on('success', function (e) {
            let $btn = $(e.trigger);
            $btn.addClass('copied');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-check-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPIED';
            wait(function () {
                $icon.removeClass('fa-check-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        });
        clipboard.off('error').on('error', function (e) {
            e.clearSelection();
            let $btn = $(e.trigger);
            $btn.addClass('copy-failed');
            let $icon = $($btn.find('i'));
            $icon.removeClass('fa-copy');
            $icon.addClass('fa-times-circle');
            let $span = $($btn.find('span'));
            $span[0].innerText = 'COPY FAILED';
            wait(function () {
                $icon.removeClass('fa-times-circle');
                $icon.addClass('fa-copy');
                $span[0].innerText = 'COPY'
            }, 2000)
        })
    }
    $(function () {
        pjax_initCopyCode()
    });
</script>


<!-- scrollreveal -->

  <script src="https://cdn.jsdelivr.net/npm/scrollreveal@4.0.6/dist/scrollreveal.min.js"></script>
  <script type="text/javascript">
    function pjax_scrollrebeal() {
      ScrollReveal().reveal('.l_main .reveal', {
        distance: '32px',
        duration: '800',
        interval: '20',
        scale: '1',
        easing: 'ease-out'
      });
    }

    $(function () {
      pjax_scrollrebeal();
    });
  </script>

<!-- ******************************** -->

<!-- fancybox -->
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>
<script>
  function pjax_fancybox() {
    $(".article-entry").find("img").not('.inline').not('a img').each(function () { //渲染 fancybox
      var element = document.createElement("a"); // a 标签
      $(element).attr("class", "fancybox");
      $(element).attr("pjax-fancybox", "");  // 过滤 pjax
      $(element).attr("href", $(this).attr("src"));
      if ($(this).attr("data-original")) {
        $(element).attr("href", $(this).attr("data-original"));
      }
      $(element).attr("data-fancybox", "images");
      var caption = "";   // 描述信息
      if ($(this).attr('alt')) {  // 判断当前页面是否存在描述信息
        $(element).attr('data-caption', $(this).attr('alt'));
        caption = $(this).attr('alt');
      }
      var div = document.createElement("div");
      $(div).addClass("fancybox");
      $(this).wrap(div); // 最外层套 div ，其实主要作用还是 class 样式
      var span = document.createElement("span");
      $(span).addClass("image-caption");
      $(span).text(caption); // 加描述
      $(this).after(span);  // 再套一层描述
      $(this).wrap(element);  // 最后套 a 标签
    })
    $(".article-entry").find("img").fancybox({
      selector: '[data-fancybox="images"]',
      hash: false,
      loop: false,
      closeClick: true,
      helpers: {
        overlay: {closeClick: true}
      },
      buttons: [
        "zoom",
        "close"
      ]
    });
  };
  $(function () {
    pjax_fancybox();
  });
</script>

<!-- ******************************** -->


  
<script src="/js/app.js"></script>




  
    
<script src="/js/search.js"></script>

  



  <script defer src="https://cdn.jsdelivr.net/gh/volantis-x/cdn-busuanzi@2.3/js/busuanzi.pure.mini.js" data-pjax></script>



  
<script src="https://cdn.jsdelivr.net/npm/node-waves@0.7.6/dist/waves.min.js"></script>

  <script type="text/javascript">
    $(function () {
      Waves.attach('.flat-btn', ['waves-button']);
      Waves.attach('.float-btn', ['waves-button', 'waves-float']);
      Waves.attach('.float-btn-light', ['waves-button', 'waves-float', 'waves-light']);
      Waves.attach('.flat-box', ['waves-block']);
      Waves.attach('.float-box', ['waves-block', 'waves-float']);
      Waves.attach('.waves-image');
      Waves.init();
    });
  </script>





  
    
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.18.1/build/highlight.min.js"></script>

    <script>hljs.initHighlightingOnLoad();</script>
  




    
      


<script src="https://cdn.jsdelivr.net/npm/pjax@0.2.8/pjax.min.js"></script>

<!-- 样式位于：source/css/_third-party/pjaxanimate.styl -->

<div class="pjax-animate">
  
    <script src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js"></script>
    <div id="loading-bar-wrapper"><script>NProgress.configure({parent:"#loading-bar-wrapper",trickleSpeed: 100})</script></div>
    <script>
      window.ShowLoading = function() {
        NProgress.start();
      };
      window.HideLoading = function() {
        NProgress.done();
      }
    </script>
  
</div>

<script>
    var pjax;
    document.addEventListener('DOMContentLoaded', function () {
      pjax = new Pjax({
        elements: 'a[href]:not([href^="#"]):not([href="javascript:void(0)"]):not([pjax-fancybox])',
        selectors: [
          "title",
          "#pjax-container",
          "#pjax-header-nav-list"
        ],
        cacheBust: false,   // url 地址追加时间戳，用以避免浏览器缓存
        timeout: 5000
      });
    });

    document.addEventListener('pjax:send', function (e) {
      window.stop(); // 相当于点击了浏览器的停止按钮

      try {
        var currentUrl = window.location.pathname;
        var targetUrl = e.triggerElement.href;
        var banUrl = [""];
        if (banUrl[0] != "") {
          banUrl.forEach(item => {
            if(currentUrl.indexOf(item) != -1 || targetUrl.indexOf(item) != -1) {
              window.location.href = targetUrl;
            }
          });
        }
      } catch (error) {}

      window.subData = null; // 移除标题（用于一二级导航栏切换处）
      $.fancybox.close();    // 关闭弹窗
      $('.l_header .switcher .s-search').removeClass('active'); // 关闭移动端激活的搜索框
      $('.l_header').removeClass('z_search-open'); // 关闭移动端激活的搜索框
      $('.wrapper').removeClass('sub'); // 跳转页面时关闭二级导航

      // 解绑事件 避免重复监听
      $('.s-top').unbind('click');
      $('.menu a').unbind('click');
      $(window).unbind('resize');
      $(window).unbind('scroll');
      $(document).unbind('scroll');
      $(document).unbind('click');
      $('body').unbind('click');
      window.ShowLoading();
    });

    document.addEventListener('pjax:complete', function () {
      // 关于百度统计对 SPA 页面的处理：
      // 方案一：百度统计>管理>单页应用设置中，打开开启按钮即可对SPA进行统计。 https://tongji.baidu.com/web/help/article?id=324
      // 方案二：取消注释下列代码。 https://tongji.baidu.com/web/help/article?id=235
      // 

      // 关于谷歌统计对 SPA 页面的处理：
      // 当应用以动态方式加载内容并更新地址栏中的网址时，也应该更新通过 gtag.js 存储的网页网址。
      // https://developers.google.cn/analytics/devguides/collection/gtagjs/single-page-applications?hl=zh-cn
      

      $('.nav-main').find('.list-v').not('.menu-phone').removeAttr("style",""); // 移除小尾巴的移除
      $('.menu-phone.list-v').removeAttr("style",""); // 移除小尾巴的移除
      $('script[data-pjax], .pjax-reload script').each(function () {
        $(this).parent().append($(this).remove());
      });

      try{
        pjax_fancybox();
        
          
          if ('.cover') {
            $('.cover').backstretch("resize");
          } else {
            $.backstretch("resize");
          }
        
        
        document.querySelectorAll('pre code').forEach((block) => {
          hljs.highlightBlock(block);
        });
        
        
          pjax_scrollrebeal();
        
        
          pjax_initCopyCode();
        
        
        
        
          pjax_gitalk();
        
        
        
      } catch (e) {
        console.log(e);
      }
      window.HideLoading();
    });

    document.addEventListener('pjax:error', function (e) {
      window.HideLoading();
      window.location.href = e.triggerElement.href;
    });
</script>

    
  </div>
</body>
</html>
